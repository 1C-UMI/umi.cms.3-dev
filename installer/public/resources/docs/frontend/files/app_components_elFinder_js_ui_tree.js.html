<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app\components\elFinder\js\ui\tree.js - umi-cms-3</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="umi-cms-3"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ApplicationRoute.html">ApplicationRoute</a></li>
            
                <li><a href="../classes/ComponentController.html">ComponentController</a></li>
            
                <li><a href="../classes/dialogelfinder - open elFinder in dialog window.html">dialogelfinder - open elFinder in dialog window</a></li>
            
                <li><a href="../classes/DS.ManyArray.html">DS.ManyArray</a></li>
            
                <li><a href="../classes/elFinder - file manager for web.html">elFinder - file manager for web</a></li>
            
                <li><a href="../classes/elFinder command &quot;archive&quot;
Archive selected files.html">elFinder command &quot;archive&quot;
Archive selected files</a></li>
            
                <li><a href="../classes/elFinder command &quot;back&quot;
Open last visited folder.html">elFinder command &quot;back&quot;
Open last visited folder</a></li>
            
                <li><a href="../classes/elFinder command &quot;copy&quot;.
Put files in filemanager clipboard..html">elFinder command &quot;copy&quot;.
Put files in filemanager clipboard.</a></li>
            
                <li><a href="../classes/elFinder command &quot;download&quot;. 
Download selected files.
Only for new api.html">elFinder command &quot;download&quot;. 
Download selected files.
Only for new api</a></li>
            
                <li><a href="../classes/elFinder command &quot;duplicate&quot;
Create file/folder copy with suffix &quot;copy Number&quot;.html">elFinder command &quot;duplicate&quot;
Create file/folder copy with suffix &quot;copy Number&quot;</a></li>
            
                <li><a href="../classes/elFinder command &quot;edit&quot;. 
Edit text file in dialog window.html">elFinder command &quot;edit&quot;. 
Edit text file in dialog window</a></li>
            
                <li><a href="../classes/elFinder command &quot;extract&quot;
Extract files from archive.html">elFinder command &quot;extract&quot;
Extract files from archive</a></li>
            
                <li><a href="../classes/elFinder command &quot;forward&quot;
Open next visited folder.html">elFinder command &quot;forward&quot;
Open next visited folder</a></li>
            
                <li><a href="../classes/elFinder command &quot;getfile&quot;. 
Return selected files info into outer callback.
For use elFinder with wysiwyg editors etc..html">elFinder command &quot;getfile&quot;. 
Return selected files info into outer callback.
For use elFinder with wysiwyg editors etc.</a></li>
            
                <li><a href="../classes/elFinder command &quot;help&quot;
&quot;About&quot; dialog.html">elFinder command &quot;help&quot;
&quot;About&quot; dialog</a></li>
            
                <li><a href="../classes/elFinder command &quot;info&quot;. 
Display dialog with file properties..html">elFinder command &quot;info&quot;. 
Display dialog with file properties.</a></li>
            
                <li><a href="../classes/elFinder command &quot;mkdir&quot;
Create new folder.html">elFinder command &quot;mkdir&quot;
Create new folder</a></li>
            
                <li><a href="../classes/elFinder command &quot;mkfile&quot;
Create new empty file.html">elFinder command &quot;mkfile&quot;
Create new empty file</a></li>
            
                <li><a href="../classes/elFinder command &quot;netmount&quot;
Mount network volume with user credentials..html">elFinder command &quot;netmount&quot;
Mount network volume with user credentials.</a></li>
            
                <li><a href="../classes/elFinder command &quot;open&quot;
Enter folder or open files in new windows.html">elFinder command &quot;open&quot;
Enter folder or open files in new windows</a></li>
            
                <li><a href="../classes/elFinder command &quot;paste&quot;
Paste filesfrom clipboard into directory.
If files pasted in its parent directory - files duplicates will created.html">elFinder command &quot;paste&quot;
Paste filesfrom clipboard into directory.
If files pasted in its parent directory - files duplicates will created</a></li>
            
                <li><a href="../classes/elFinder command &quot;quicklook&quot;
Fast preview for some files types.html">elFinder command &quot;quicklook&quot;
Fast preview for some files types</a></li>
            
                <li><a href="../classes/elFinder command &quot;reload&quot;
Sync files and folders.html">elFinder command &quot;reload&quot;
Sync files and folders</a></li>
            
                <li><a href="../classes/elFinder command &quot;rename&quot;. 
Rename selected file..html">elFinder command &quot;rename&quot;. 
Rename selected file.</a></li>
            
                <li><a href="../classes/elFinder command &quot;resize&quot;
Open dialog to resize image.html">elFinder command &quot;resize&quot;
Open dialog to resize image</a></li>
            
                <li><a href="../classes/elFinder command &quot;rm&quot;
Delete files.html">elFinder command &quot;rm&quot;
Delete files</a></li>
            
                <li><a href="../classes/elFinder command &quot;search&quot;
Find files.html">elFinder command &quot;search&quot;
Find files</a></li>
            
                <li><a href="../classes/elFinder command &quot;sort&quot;
Change sort files rule.html">elFinder command &quot;sort&quot;
Change sort files rule</a></li>
            
                <li><a href="../classes/elFinder command &quot;up&quot;
Go into parent directory.html">elFinder command &quot;up&quot;
Go into parent directory</a></li>
            
                <li><a href="../classes/elFinder command &quot;upload&quot;
Upload files using iframe or XMLHttpRequest &amp; FormData.
Dialog allow to send files using drag and drop.html">elFinder command &quot;upload&quot;
Upload files using iframe or XMLHttpRequest &amp; FormData.
Dialog allow to send files using drag and drop</a></li>
            
                <li><a href="../classes/elFinder command &quot;view&quot;
Change current directory view (icons/list).html">elFinder command &quot;view&quot;
Change current directory view (icons/list)</a></li>
            
                <li><a href="../classes/elFinder contextmenu.html">elFinder contextmenu</a></li>
            
                <li><a href="../classes/elFinder dialog.html">elFinder dialog</a></li>
            
                <li><a href="../classes/elFinder folders tree.html">elFinder folders tree</a></li>
            
                <li><a href="../classes/elFinder places/favorites ui.html">elFinder places/favorites ui</a></li>
            
                <li><a href="../classes/elFinder toolbar.html">elFinder toolbar</a></li>
            
                <li><a href="../classes/elFinder toolbar button menu with sort variants..html">elFinder toolbar button menu with sort variants.</a></li>
            
                <li><a href="../classes/elFinder toolbar button to switch current directory view..html">elFinder toolbar button to switch current directory view.</a></li>
            
                <li><a href="../classes/elFinder toolbar button widget.
If command has variants - create menu.html">elFinder toolbar button widget.
If command has variants - create menu</a></li>
            
                <li><a href="../classes/elFinder toolbar search button widget..html">elFinder toolbar search button widget.</a></li>
            
                <li><a href="../classes/elFinder toolbar&#x27;s button tor upload file.html">elFinder toolbar&#x27;s button tor upload file</a></li>
            
                <li><a href="../classes/elFinder ui
Display current folder path in statusbar.
Click on folder name in path - open folder.html">elFinder ui
Display current folder path in statusbar.
Click on folder name in path - open folder</a></li>
            
                <li><a href="../classes/elFinder ui
Display number of files/selected files and its size in statusbar.html">elFinder ui
Display number of files/selected files and its size in statusbar</a></li>
            
                <li><a href="../classes/elFinder.history
Store visited folders
and provide &quot;back&quot; and &quot;forward&quot; methods.html">elFinder.history
Store visited folders
and provide &quot;back&quot; and &quot;forward&quot; methods</a></li>
            
                <li><a href="../classes/elfindernav - elFinder container for diretories tree and places.html">elfindernav - elFinder container for diretories tree and places</a></li>
            
                <li><a href="../classes/elfinderworkzone - elFinder container for nav and current directory.html">elfinderworkzone - elFinder container for nav and current directory</a></li>
            
                <li><a href="../classes/IndexRoute.html">IndexRoute</a></li>
            
                <li><a href="../classes/Inflector.inflector.html">Inflector.inflector</a></li>
            
                <li><a href="../classes/map.html">map</a></li>
            
                <li><a href="../classes/UmiRESTAdapter.html">UmiRESTAdapter</a></li>
            
                <li><a href="../classes/Utils.html">Utils</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Router.html">Router</a></li>
            
                <li><a href="../modules/UMI.html">UMI</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app\components\elFinder\js\ui\tree.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;
/**
 * @class  elFinder folders tree
 *
 * @author Dmitry (dio) Levashov
 **/
$.fn.elfindertree = function(fm, opts) {
	var treeclass = fm.res(&#x27;class&#x27;, &#x27;tree&#x27;);
	
	this.not(&#x27;.&#x27;+treeclass).each(function() {

		var c = &#x27;class&#x27;,
			
			/**
			 * Root directory class name
			 *
			 * @type String
			 */
			root      = fm.res(c, &#x27;treeroot&#x27;),

			/**
			 * Open root dir if not opened yet
			 *
			 * @type Boolean
			 */
			openRoot  = opts.openRootOnLoad,

			/**
			 * Subtree class name
			 *
			 * @type String
			 */
			subtree   = fm.res(c, &#x27;navsubtree&#x27;),
			
			/**
			 * Directory class name
			 *
			 * @type String
			 */
			navdir    = fm.res(c, &#x27;treedir&#x27;),
			
			/**
			 * Collapsed arrow class name
			 *
			 * @type String
			 */
			collapsed = fm.res(c, &#x27;navcollapse&#x27;),
			
			/**
			 * Expanded arrow class name
			 *
			 * @type String
			 */
			expanded  = fm.res(c, &#x27;navexpand&#x27;),
			
			/**
			 * Class name to mark arrow for directory with already loaded children
			 *
			 * @type String
			 */
			loaded    = &#x27;elfinder-subtree-loaded&#x27;,
			
			/**
			 * Arraw class name
			 *
			 * @type String
			 */
			arrow = fm.res(c, &#x27;navarrow&#x27;),
			
			/**
			 * Current directory class name
			 *
			 * @type String
			 */
			active    = fm.res(c, &#x27;active&#x27;),
			
			/**
			 * Droppable dirs dropover class
			 *
			 * @type String
			 */
			dropover = fm.res(c, &#x27;adroppable&#x27;),
			
			/**
			 * Hover class name
			 *
			 * @type String
			 */
			hover    = fm.res(c, &#x27;hover&#x27;),
			
			/**
			 * Disabled dir class name
			 *
			 * @type String
			 */
			disabled = fm.res(c, &#x27;disabled&#x27;),
			
			/**
			 * Draggable dir class name
			 *
			 * @type String
			 */
			draggable = fm.res(c, &#x27;draggable&#x27;),
			
			/**
			 * Droppable dir  class name
			 *
			 * @type String
			 */
			droppable = fm.res(c, &#x27;droppable&#x27;),
			
			insideNavbar = function(x) {
				var left = navbar.offset().left;
					
				return left &lt;= x &amp;&amp; x &lt;= left + navbar.width();
			},
			
			drop = fm.droppable.drop,
			
			/**
			 * Droppable options
			 *
			 * @type Object
			 */
			droppableopts = $.extend(true, {}, fm.droppable, {
				// show subfolders on dropover
				over : function(e) { 
					var link = $(this),
						cl   = hover+&#x27; &#x27;+dropover;

					if (insideNavbar(e.clientX)) {
						link.addClass(cl)
						if (link.is(&#x27;.&#x27;+collapsed+&#x27;:not(.&#x27;+expanded+&#x27;)&#x27;)) {
							setTimeout(function() {
								link.is(&#x27;.&#x27;+dropover) &amp;&amp; link.children(&#x27;.&#x27;+arrow).click();
							}, 500);
						}
					} else {
						link.removeClass(cl);
					}
				},
				out : function() { $(this).removeClass(hover+&#x27; &#x27;+dropover); },
				drop : function(e, ui) { insideNavbar(e.clientX) &amp;&amp; drop.call(this, e, ui); }
			}),
			
			spinner = $(fm.res(&#x27;tpl&#x27;, &#x27;navspinner&#x27;)),
			
			/**
			 * Directory html template
			 *
			 * @type String
			 */
			tpl = fm.res(&#x27;tpl&#x27;, &#x27;navdir&#x27;),
			
			/**
			 * Permissions marker html template
			 *
			 * @type String
			 */
			ptpl = fm.res(&#x27;tpl&#x27;, &#x27;perms&#x27;),
			
			/**
			 * Symlink marker html template
			 *
			 * @type String
			 */
			stpl = fm.res(&#x27;tpl&#x27;, &#x27;symlink&#x27;),
			
			/**
			 * Html template replacement methods
			 *
			 * @type Object
			 */
			replace = {
				id          : function(dir) { return fm.navHash2Id(dir.hash) },
				cssclass    : function(dir) { return (dir.phash ? &#x27;&#x27; : root)+&#x27; &#x27;+navdir+&#x27; &#x27;+fm.perms2class(dir)+&#x27; &#x27;+(dir.dirs &amp;&amp; !dir.link ? collapsed : &#x27;&#x27;); },
				permissions : function(dir) { return !dir.read || !dir.write ? ptpl : &#x27;&#x27;; },
				symlink     : function(dir) { return dir.alias ? stpl : &#x27;&#x27;; }
			},
			
			/**
			 * Return html for given dir
			 *
			 * @param  Object  directory
			 * @return String
			 */
			itemhtml = function(dir) {
				dir.name = fm.escape(dir.i18 || dir.name);
				
				return tpl.replace(/(?:\{([a-z]+)\})/ig, function(m, key) {
					return dir[key] || (replace[key] ? replace[key](dir) : &#x27;&#x27;);
				});
			},
			
			/**
			 * Return only dirs from files list
			 *
			 * @param  Array  files list
			 * @return Array
			 */
			filter = function(files) {
				return $.map(files||[], function(f) { return f.mime == &#x27;directory&#x27; ? f : null });
			},
			
			/**
			 * Find parent subtree for required directory
			 *
			 * @param  String  dir hash
			 * @return jQuery
			 */
			findSubtree = function(hash) {
				return hash ? tree.find(&#x27;#&#x27;+fm.navHash2Id(hash)).next(&#x27;.&#x27;+subtree) : tree;
			},
			
			/**
			 * Find directory (wrapper) in required node
			 * before which we can insert new directory
			 *
			 * @param  jQuery  parent directory
			 * @param  Object  new directory
			 * @return jQuery
			 */
			findSibling = function(subtree, dir) {
				var node = subtree.children(&#x27;:first&#x27;),
					info;

				while (node.length) {
					info = fm.file(fm.navId2Hash(node.children(&#x27;[id]&#x27;).attr(&#x27;id&#x27;)));
					
					if ((info = fm.file(fm.navId2Hash(node.children(&#x27;[id]&#x27;).attr(&#x27;id&#x27;)))) 
					&amp;&amp; dir.name.toLowerCase().localeCompare(info.name.toLowerCase()) &lt; 0) {
						return node;
					}
					node = node.next();
				}
				return $(&#x27;&#x27;);
			},
			
			/**
			 * Add new dirs in tree
			 *
			 * @param  Array  dirs list
			 * @return void
			 */
			updateTree = function(dirs) {
				var length  = dirs.length,
					orphans = [],
					i = dirs.length, 
					dir, html, parent, sibling;

				var firstVol = true; // check for netmount volume
				while (i--) {
					dir = dirs[i];

					if (tree.find(&#x27;#&#x27;+fm.navHash2Id(dir.hash)).length) {
						continue;
					}
					
					if ((parent = findSubtree(dir.phash)).length) {
						html = itemhtml(dir);
						if (dir.phash &amp;&amp; (sibling = findSibling(parent, dir)).length) {
							sibling.before(html);
						} else {
							parent[firstVol || dir.phash ? &#x27;append&#x27; : &#x27;prepend&#x27;](html);
							firstVol = false;
						}
					} else {
						orphans.push(dir);
					}
				}

				if (orphans.length &amp;&amp; orphans.length &lt; length) {
					return updateTree(orphans);
				} 
				
				setTimeout(function() {
					updateDroppable();
				}, 10);
				
			},
			
			/**
			 * Mark current directory as active
			 * If current directory is not in tree - load it and its parents
			 *
			 * @param {Boolean} do not recursive call
			 * @return void
			 */
			sync = function(stopRec) {
				var cwd     = fm.cwd().hash,
					current = tree.find(&#x27;#&#x27;+fm.navHash2Id(cwd)), 
					rootNode, dir;
				
				if (openRoot) {
					rootNode = tree.find(&#x27;#&#x27;+fm.navHash2Id(fm.root()));
					rootNode.is(&#x27;.&#x27;+loaded) &amp;&amp; rootNode.addClass(expanded).next(&#x27;.&#x27;+subtree).show();
					openRoot = false;
				}
				
				if (!current.is(&#x27;.&#x27;+active)) {
					tree.find(&#x27;.&#x27;+navdir+&#x27;.&#x27;+active).removeClass(active);
					current.addClass(active);
				}

				if (opts.syncTree) {
					if (current.length) {
						return current.parentsUntil(&#x27;.&#x27;+root).filter(&#x27;.&#x27;+subtree).show().prev(&#x27;.&#x27;+navdir).addClass(expanded);
					}
					if (fm.newAPI) {
						dir = fm.file(cwd);
						if (dir &amp;&amp; dir.phash &amp;&amp; tree.find(&#x27;#&#x27;+fm.navHash2Id(dir.phash)).length) {
							updateTree([dir]);
							return sync();
						}
						fm.request({
							data : {cmd : &#x27;parents&#x27;, target : cwd},
							preventFail : true
						})
						.done(function(data) {
							var dirs = filter(data.tree);
							updateTree(dirs);
							updateArrows(dirs, loaded);
							cwd == fm.cwd().hash &amp;&amp; sync(true);
						})
						;
					}
					
				}
			},
			
			/**
			 * Make writable and not root dirs droppable
			 *
			 * @return void
			 */
			updateDroppable = function() {
				tree.find(&#x27;.&#x27;+navdir+&#x27;:not(.&#x27;+droppable+&#x27;,.elfinder-ro,.elfinder-na)&#x27;).droppable(droppableopts);
			},
			
			/**
			 * Check required folders for subfolders and update arrow classes
			 *
			 * @param  Array  folders to check
			 * @param  String css class 
			 * @return void
			 */
			updateArrows = function(dirs, cls) {
				var sel = cls == loaded
						? &#x27;.&#x27;+collapsed+&#x27;:not(.&#x27;+loaded+&#x27;)&#x27;
						: &#x27;:not(.&#x27;+collapsed+&#x27;)&#x27;;
				
						
				//tree.find(&#x27;.&#x27;+subtree+&#x27;:has(*)&#x27;).prev(&#x27;:not(.&#x27;+collapsed+&#x27;)&#x27;).addClass(collapsed)

				$.each(dirs, function(i, dir) {
					tree.find(&#x27;#&#x27;+fm.navHash2Id(dir.phash)+sel)
						.filter(function() { return $(this).next(&#x27;.&#x27;+subtree).children().length &gt; 0 })
						.addClass(cls);
				})
			},
			
			
			
			/**
			 * Navigation tree
			 *
			 * @type JQuery
			 */
			tree = $(this).addClass(treeclass)
				// make dirs draggable and toggle hover class
				.delegate(&#x27;.&#x27;+navdir, &#x27;hover&#x27;, function(e) {
					var link  = $(this), 
						enter = e.type == &#x27;mouseenter&#x27;;
					
					if (!link.is(&#x27;.&#x27;+dropover+&#x27; ,.&#x27;+disabled)) {
						enter &amp;&amp; !link.is(&#x27;.&#x27;+root+&#x27;,.&#x27;+draggable+&#x27;,.elfinder-na,.elfinder-wo&#x27;) &amp;&amp; link.draggable(fm.draggable);
						link.toggleClass(hover, enter);
					}
				})
				// add/remove dropover css class
				.delegate(&#x27;.&#x27;+navdir, &#x27;dropover dropout drop&#x27;, function(e) {
					$(this)[e.type == &#x27;dropover&#x27; ? &#x27;addClass&#x27; : &#x27;removeClass&#x27;](dropover+&#x27; &#x27;+hover);
				})
				// open dir or open subfolders in tree
				.delegate(&#x27;.&#x27;+navdir, &#x27;click&#x27;, function(e) {
					var link = $(this),
						hash = fm.navId2Hash(link.attr(&#x27;id&#x27;)),
						file = fm.file(hash);
				
					fm.trigger(&#x27;searchend&#x27;);
				
					if (hash != fm.cwd().hash &amp;&amp; !link.is(&#x27;.&#x27;+disabled)) {
						fm.exec(&#x27;open&#x27;, file.thash || hash);
					} else if (link.is(&#x27;.&#x27;+collapsed)) {
						link.children(&#x27;.&#x27;+arrow).click();
					}
				})
				// toggle subfolders in tree
				.delegate(&#x27;.&#x27;+navdir+&#x27;.&#x27;+collapsed+&#x27; .&#x27;+arrow, &#x27;click&#x27;, function(e) {
					var arrow = $(this),
						link  = arrow.parent(&#x27;.&#x27;+navdir),
						stree = link.next(&#x27;.&#x27;+subtree);

					e.stopPropagation();

					if (link.is(&#x27;.&#x27;+loaded)) {
						link.toggleClass(expanded);
						stree.slideToggle()
					} else {
						spinner.insertBefore(arrow);
						link.removeClass(collapsed);

						fm.request({cmd : &#x27;tree&#x27;, target : fm.navId2Hash(link.attr(&#x27;id&#x27;))})
							.done(function(data) { 
								updateTree(filter(data.tree)); 
								
								if (stree.children().length) {
									link.addClass(collapsed+&#x27; &#x27;+expanded);
									stree.slideDown();
								} 
								sync();
							})
							.always(function(data) {
								spinner.remove();
								link.addClass(loaded);
							});
					}
				})
				.delegate(&#x27;.&#x27;+navdir, &#x27;contextmenu&#x27;, function(e) {
					e.preventDefault();

					fm.trigger(&#x27;contextmenu&#x27;, {
						&#x27;type&#x27;    : &#x27;navbar&#x27;,
						&#x27;targets&#x27; : [fm.navId2Hash($(this).attr(&#x27;id&#x27;))],
						&#x27;x&#x27;       : e.clientX,
						&#x27;y&#x27;       : e.clientY
					});
				}),
			// move tree into navbar
			navbar = fm.getUI(&#x27;navbar&#x27;).append(tree).show()
				
			;

		fm.open(function(e) {
			var data = e.data,
				dirs = filter(data.files);

			data.init &amp;&amp; tree.empty();

			if (dirs.length) {
				updateTree(dirs);
				updateArrows(dirs, loaded);
			} 
			sync();
		})
		// add new dirs
		.add(function(e) {
			var dirs = filter(e.data.added);

			if (dirs.length) {
				updateTree(dirs);
				updateArrows(dirs, collapsed);
			}
		})
		// update changed dirs
		.change(function(e) {
			var dirs = filter(e.data.changed),
				l    = dirs.length,
				dir, node, tmp, realParent, reqParent, realSibling, reqSibling, isExpanded, isLoaded;
			
			while (l--) {
				dir = dirs[l];
				if ((node = tree.find(&#x27;#&#x27;+fm.navHash2Id(dir.hash))).length) {
					if (dir.phash) {
						realParent  = node.closest(&#x27;.&#x27;+subtree);
						reqParent   = findSubtree(dir.phash);
						realSibling = node.parent().next();
						reqSibling  = findSibling(reqParent, dir);
						
						if (!reqParent.length) {
							continue;
						}
						
						if (reqParent[0] !== realParent[0] || realSibling.get(0) !== reqSibling.get(0)) {
							reqSibling.length ? reqSibling.before(node) : reqParent.append(node);
						}
					}
					isExpanded = node.is(&#x27;.&#x27;+expanded);
					isLoaded   = node.is(&#x27;.&#x27;+loaded);
					tmp        = $(itemhtml(dir));
					node.replaceWith(tmp.children(&#x27;.&#x27;+navdir));
					
					if (dir.dirs 
					&amp;&amp; (isExpanded || isLoaded) 
					&amp;&amp; (node = tree.find(&#x27;#&#x27;+fm.navHash2Id(dir.hash))) 
					&amp;&amp; node.next(&#x27;.&#x27;+subtree).children().length) {
						isExpanded &amp;&amp; node.addClass(expanded);
						isLoaded &amp;&amp; node.addClass(loaded);
					}
				}
			}

			sync();
			updateDroppable();
		})
		// remove dirs
		.remove(function(e) {
			var dirs = e.data.removed,
				l    = dirs.length,
				node, stree;
			
			while (l--) {
				if ((node = tree.find(&#x27;#&#x27;+fm.navHash2Id(dirs[l]))).length) {
					stree = node.closest(&#x27;.&#x27;+subtree);
					node.parent().detach();
					if (!stree.children().length) {
						stree.hide().prev(&#x27;.&#x27;+navdir).removeClass(collapsed+&#x27; &#x27;+expanded+&#x27; &#x27;+loaded);
					}
				}
			}
		})
		// add/remove active class for current dir
		.bind(&#x27;search searchend&#x27;, function(e) {
			tree.find(&#x27;#&#x27;+fm.navHash2Id(fm.cwd().hash))[e.type == &#x27;search&#x27; ? &#x27;removeClass&#x27; : &#x27;addClass&#x27;](active);
		})
		// lock/unlock dirs while moving
		.bind(&#x27;lockfiles unlockfiles&#x27;, function(e) {
			var lock = e.type == &#x27;lockfiles&#x27;,
				act  = lock ? &#x27;disable&#x27; : &#x27;enable&#x27;,
				dirs = $.map(e.data.files||[], function(h) {  
					var dir = fm.file(h);
					return dir &amp;&amp; dir.mime == &#x27;directory&#x27; ? h : null;
				})
				
			$.each(dirs, function(i, hash) {
				var dir = tree.find(&#x27;#&#x27;+fm.navHash2Id(hash));
				
				if (dir.length) {
					dir.is(&#x27;.&#x27;+draggable) &amp;&amp; dir.draggable(act);
					dir.is(&#x27;.&#x27;+droppable) &amp;&amp; dir.droppable(active);
					dir[lock ? &#x27;addClass&#x27; : &#x27;removeClass&#x27;](disabled);
				}
			});
		})

	});
	
	return this;
}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
