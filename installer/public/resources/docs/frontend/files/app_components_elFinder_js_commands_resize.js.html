<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app\components\elFinder\js\commands\resize.js - umi-cms-3</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="umi-cms-3"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ApplicationRoute.html">ApplicationRoute</a></li>
            
                <li><a href="../classes/ComponentController.html">ComponentController</a></li>
            
                <li><a href="../classes/dialogelfinder - open elFinder in dialog window.html">dialogelfinder - open elFinder in dialog window</a></li>
            
                <li><a href="../classes/DS.ManyArray.html">DS.ManyArray</a></li>
            
                <li><a href="../classes/elFinder - file manager for web.html">elFinder - file manager for web</a></li>
            
                <li><a href="../classes/elFinder command &quot;archive&quot;
Archive selected files.html">elFinder command &quot;archive&quot;
Archive selected files</a></li>
            
                <li><a href="../classes/elFinder command &quot;back&quot;
Open last visited folder.html">elFinder command &quot;back&quot;
Open last visited folder</a></li>
            
                <li><a href="../classes/elFinder command &quot;copy&quot;.
Put files in filemanager clipboard..html">elFinder command &quot;copy&quot;.
Put files in filemanager clipboard.</a></li>
            
                <li><a href="../classes/elFinder command &quot;download&quot;. 
Download selected files.
Only for new api.html">elFinder command &quot;download&quot;. 
Download selected files.
Only for new api</a></li>
            
                <li><a href="../classes/elFinder command &quot;duplicate&quot;
Create file/folder copy with suffix &quot;copy Number&quot;.html">elFinder command &quot;duplicate&quot;
Create file/folder copy with suffix &quot;copy Number&quot;</a></li>
            
                <li><a href="../classes/elFinder command &quot;edit&quot;. 
Edit text file in dialog window.html">elFinder command &quot;edit&quot;. 
Edit text file in dialog window</a></li>
            
                <li><a href="../classes/elFinder command &quot;extract&quot;
Extract files from archive.html">elFinder command &quot;extract&quot;
Extract files from archive</a></li>
            
                <li><a href="../classes/elFinder command &quot;forward&quot;
Open next visited folder.html">elFinder command &quot;forward&quot;
Open next visited folder</a></li>
            
                <li><a href="../classes/elFinder command &quot;getfile&quot;. 
Return selected files info into outer callback.
For use elFinder with wysiwyg editors etc..html">elFinder command &quot;getfile&quot;. 
Return selected files info into outer callback.
For use elFinder with wysiwyg editors etc.</a></li>
            
                <li><a href="../classes/elFinder command &quot;help&quot;
&quot;About&quot; dialog.html">elFinder command &quot;help&quot;
&quot;About&quot; dialog</a></li>
            
                <li><a href="../classes/elFinder command &quot;info&quot;. 
Display dialog with file properties..html">elFinder command &quot;info&quot;. 
Display dialog with file properties.</a></li>
            
                <li><a href="../classes/elFinder command &quot;mkdir&quot;
Create new folder.html">elFinder command &quot;mkdir&quot;
Create new folder</a></li>
            
                <li><a href="../classes/elFinder command &quot;mkfile&quot;
Create new empty file.html">elFinder command &quot;mkfile&quot;
Create new empty file</a></li>
            
                <li><a href="../classes/elFinder command &quot;netmount&quot;
Mount network volume with user credentials..html">elFinder command &quot;netmount&quot;
Mount network volume with user credentials.</a></li>
            
                <li><a href="../classes/elFinder command &quot;open&quot;
Enter folder or open files in new windows.html">elFinder command &quot;open&quot;
Enter folder or open files in new windows</a></li>
            
                <li><a href="../classes/elFinder command &quot;paste&quot;
Paste filesfrom clipboard into directory.
If files pasted in its parent directory - files duplicates will created.html">elFinder command &quot;paste&quot;
Paste filesfrom clipboard into directory.
If files pasted in its parent directory - files duplicates will created</a></li>
            
                <li><a href="../classes/elFinder command &quot;quicklook&quot;
Fast preview for some files types.html">elFinder command &quot;quicklook&quot;
Fast preview for some files types</a></li>
            
                <li><a href="../classes/elFinder command &quot;reload&quot;
Sync files and folders.html">elFinder command &quot;reload&quot;
Sync files and folders</a></li>
            
                <li><a href="../classes/elFinder command &quot;rename&quot;. 
Rename selected file..html">elFinder command &quot;rename&quot;. 
Rename selected file.</a></li>
            
                <li><a href="../classes/elFinder command &quot;resize&quot;
Open dialog to resize image.html">elFinder command &quot;resize&quot;
Open dialog to resize image</a></li>
            
                <li><a href="../classes/elFinder command &quot;rm&quot;
Delete files.html">elFinder command &quot;rm&quot;
Delete files</a></li>
            
                <li><a href="../classes/elFinder command &quot;search&quot;
Find files.html">elFinder command &quot;search&quot;
Find files</a></li>
            
                <li><a href="../classes/elFinder command &quot;sort&quot;
Change sort files rule.html">elFinder command &quot;sort&quot;
Change sort files rule</a></li>
            
                <li><a href="../classes/elFinder command &quot;up&quot;
Go into parent directory.html">elFinder command &quot;up&quot;
Go into parent directory</a></li>
            
                <li><a href="../classes/elFinder command &quot;upload&quot;
Upload files using iframe or XMLHttpRequest &amp; FormData.
Dialog allow to send files using drag and drop.html">elFinder command &quot;upload&quot;
Upload files using iframe or XMLHttpRequest &amp; FormData.
Dialog allow to send files using drag and drop</a></li>
            
                <li><a href="../classes/elFinder command &quot;view&quot;
Change current directory view (icons/list).html">elFinder command &quot;view&quot;
Change current directory view (icons/list)</a></li>
            
                <li><a href="../classes/elFinder contextmenu.html">elFinder contextmenu</a></li>
            
                <li><a href="../classes/elFinder dialog.html">elFinder dialog</a></li>
            
                <li><a href="../classes/elFinder folders tree.html">elFinder folders tree</a></li>
            
                <li><a href="../classes/elFinder places/favorites ui.html">elFinder places/favorites ui</a></li>
            
                <li><a href="../classes/elFinder toolbar.html">elFinder toolbar</a></li>
            
                <li><a href="../classes/elFinder toolbar button menu with sort variants..html">elFinder toolbar button menu with sort variants.</a></li>
            
                <li><a href="../classes/elFinder toolbar button to switch current directory view..html">elFinder toolbar button to switch current directory view.</a></li>
            
                <li><a href="../classes/elFinder toolbar button widget.
If command has variants - create menu.html">elFinder toolbar button widget.
If command has variants - create menu</a></li>
            
                <li><a href="../classes/elFinder toolbar search button widget..html">elFinder toolbar search button widget.</a></li>
            
                <li><a href="../classes/elFinder toolbar&#x27;s button tor upload file.html">elFinder toolbar&#x27;s button tor upload file</a></li>
            
                <li><a href="../classes/elFinder ui
Display current folder path in statusbar.
Click on folder name in path - open folder.html">elFinder ui
Display current folder path in statusbar.
Click on folder name in path - open folder</a></li>
            
                <li><a href="../classes/elFinder ui
Display number of files/selected files and its size in statusbar.html">elFinder ui
Display number of files/selected files and its size in statusbar</a></li>
            
                <li><a href="../classes/elFinder.history
Store visited folders
and provide &quot;back&quot; and &quot;forward&quot; methods.html">elFinder.history
Store visited folders
and provide &quot;back&quot; and &quot;forward&quot; methods</a></li>
            
                <li><a href="../classes/elfindernav - elFinder container for diretories tree and places.html">elfindernav - elFinder container for diretories tree and places</a></li>
            
                <li><a href="../classes/elfinderworkzone - elFinder container for nav and current directory.html">elfinderworkzone - elFinder container for nav and current directory</a></li>
            
                <li><a href="../classes/IndexRoute.html">IndexRoute</a></li>
            
                <li><a href="../classes/Inflector.inflector.html">Inflector.inflector</a></li>
            
                <li><a href="../classes/map.html">map</a></li>
            
                <li><a href="../classes/UmiRESTAdapter.html">UmiRESTAdapter</a></li>
            
                <li><a href="../classes/Utils.html">Utils</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Router.html">Router</a></li>
            
                <li><a href="../modules/UMI.html">UMI</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app\components\elFinder\js\commands\resize.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;
/**
 * @class  elFinder command &quot;resize&quot;
 * Open dialog to resize image
 *
 * @author Dmitry (dio) Levashov
 * @author Alexey Sukhotin
 * @author Naoki Sawada
 * @author Sergio Jovani
 **/
elFinder.prototype.commands.resize = function() {

	this.updateOnSelect = false;
	
	this.getstate = function() {
		var sel = this.fm.selectedFiles();
		return !this._disabled &amp;&amp; sel.length == 1 &amp;&amp; sel[0].read &amp;&amp; sel[0].write &amp;&amp; sel[0].mime.indexOf(&#x27;image/&#x27;) !== -1 ? 0 : -1;
	};
	
	this.exec = function(hashes) {
		var fm    = this.fm,
			files = this.files(hashes),
			dfrd  = $.Deferred(),
			
			open = function(file, id) {
				var dialog   = $(&#x27;&lt;div class=&quot;elfinder-dialog-resize&quot;/&gt;&#x27;),
					input    = &#x27;&lt;input type=&quot;text&quot; size=&quot;5&quot;/&gt;&#x27;,
					row      = &#x27;&lt;div class=&quot;elfinder-resize-row&quot;/&gt;&#x27;,
					label    = &#x27;&lt;div class=&quot;elfinder-resize-label&quot;/&gt;&#x27;,
					control  = $(&#x27;&lt;div class=&quot;elfinder-resize-control&quot;/&gt;&#x27;),
					preview  = $(&#x27;&lt;div class=&quot;elfinder-resize-preview&quot;/&gt;&#x27;),
					spinner  = $(&#x27;&lt;div class=&quot;elfinder-resize-spinner&quot;&gt;&#x27;+fm.i18n(&#x27;ntfloadimg&#x27;)+&#x27;&lt;/div&gt;&#x27;),
					rhandle  = $(&#x27;&lt;div class=&quot;elfinder-resize-handle&quot;/&gt;&#x27;),
					rhandlec = $(&#x27;&lt;div class=&quot;elfinder-resize-handle&quot;/&gt;&#x27;),
					uiresize = $(&#x27;&lt;div class=&quot;elfinder-resize-uiresize&quot;/&gt;&#x27;),
					uicrop   = $(&#x27;&lt;div class=&quot;elfinder-resize-uicrop&quot;/&gt;&#x27;),
					uibuttonset = &#x27;&lt;div class=&quot;ui-widget-content ui-corner-all elfinder-buttonset&quot;/&gt;&#x27;,
					uibutton    = &#x27;&lt;div class=&quot;ui-state-default elfinder-button&quot;/&gt;&#x27;,
					uiseparator = &#x27;&lt;span class=&quot;ui-widget-content elfinder-toolbar-button-separator&quot;/&gt;&#x27;,
					uirotate    = $(&#x27;&lt;div class=&quot;elfinder-resize-rotate&quot;/&gt;&#x27;),
					uideg270    = $(uibutton).attr(&#x27;title&#x27;,fm.i18n(&#x27;rotate-cw&#x27;)).append($(&#x27;&lt;span class=&quot;elfinder-button-icon elfinder-button-icon-rotate-l&quot;/&gt;&#x27;)
						.click(function(){
							rdegree = rdegree - 90;
							rotate.update(rdegree);
						})),
					uideg90     = $(uibutton).attr(&#x27;title&#x27;,fm.i18n(&#x27;rotate-ccw&#x27;)).append($(&#x27;&lt;span class=&quot;elfinder-button-icon elfinder-button-icon-rotate-r&quot;/&gt;&#x27;)
						.click(function(){
							rdegree = rdegree + 90;
							rotate.update(rdegree);
						})),
					uiprop   = $(&#x27;&lt;span /&gt;&#x27;),
					reset    = $(&#x27;&lt;div class=&quot;ui-state-default ui-corner-all elfinder-resize-reset&quot;&gt;&lt;span class=&quot;ui-icon ui-icon-arrowreturnthick-1-w&quot;/&gt;&lt;/div&gt;&#x27;),
					uitype   = $(&#x27;&lt;div class=&quot;elfinder-resize-type&quot;/&gt;&#x27;)
						.append(&#x27;&lt;input type=&quot;radio&quot; name=&quot;type&quot; id=&quot;&#x27;+id+&#x27;-resize&quot; value=&quot;resize&quot; checked=&quot;checked&quot; /&gt;&lt;label for=&quot;&#x27;+id+&#x27;-resize&quot;&gt;&#x27;+fm.i18n(&#x27;resize&#x27;)+&#x27;&lt;/label&gt;&#x27;)
						.append(&#x27;&lt;input type=&quot;radio&quot; name=&quot;type&quot; id=&quot;&#x27;+id+&#x27;-crop&quot; value=&quot;crop&quot; /&gt;&lt;label for=&quot;&#x27;+id+&#x27;-crop&quot;&gt;&#x27;+fm.i18n(&#x27;crop&#x27;)+&#x27;&lt;/label&gt;&#x27;)
						.append(&#x27;&lt;input type=&quot;radio&quot; name=&quot;type&quot; id=&quot;&#x27;+id+&#x27;-rotate&quot; value=&quot;rotate&quot; /&gt;&lt;label for=&quot;&#x27;+id+&#x27;-rotate&quot;&gt;&#x27;+fm.i18n(&#x27;rotate&#x27;)+&#x27;&lt;/label&gt;&#x27;),
					type     = $(&#x27;input&#x27;, uitype).attr(&#x27;disabled&#x27;, &#x27;disabled&#x27;)
						.change(function() {
							var val = $(&#x27;input:checked&#x27;, uitype).val();
							
							resetView();
							resizable(true);
							croppable(true);
							rotateable(true);
							
							if (val == &#x27;resize&#x27;) {
								uiresize.show();
								uirotate.hide();
								uicrop.hide();
								resizable();
							}
							else if (val == &#x27;crop&#x27;) {
								uirotate.hide();
								uiresize.hide();
								uicrop.show();
								croppable();
							} else if (val == &#x27;rotate&#x27;) {
								uiresize.hide();
								uicrop.hide();
								uirotate.show();
								rotateable();
							}
						}),
					constr  = $(&#x27;&lt;input type=&quot;checkbox&quot; checked=&quot;checked&quot;/&gt;&#x27;)
						.change(function() {
							cratio = !!constr.prop(&#x27;checked&#x27;);
							resize.fixHeight();
							resizable(true);
							resizable();
						}),
					width   = $(input)
						.change(function() {
							var w = parseInt(width.val()),
								h = parseInt(cratio ? Math.round(w/ratio) : height.val());

							if (w &gt; 0 &amp;&amp; h &gt; 0) {
								resize.updateView(w, h);
								height.val(h);
							}
						}),
					height  = $(input)
						.change(function() {
							var h = parseInt(height.val()),
								w = parseInt(cratio ? Math.round(h*ratio) : width.val());

							if (w &gt; 0 &amp;&amp; h &gt; 0) {
								resize.updateView(w, h);
								width.val(w);
							}
						}),
					pointX  = $(input).change(function(){crop.updateView();}),
					pointY  = $(input).change(function(){crop.updateView();}),
					offsetX = $(input).change(function(){crop.updateView();}),
					offsetY = $(input).change(function(){crop.updateView();}),
					degree = $(&#x27;&lt;input type=&quot;text&quot; size=&quot;3&quot; maxlength=&quot;3&quot; value=&quot;0&quot; /&gt;&#x27;)
						.change(function() {
							rotate.update();
						}),
					uidegslider = $(&#x27;&lt;div class=&quot;elfinder-resize-rotate-slider&quot;/&gt;&#x27;)
						.slider({
							min: 0,
							max: 359,
							value: degree.val(),
							animate: true,
							change: function(event, ui) {
								if (ui.value != uidegslider.slider(&#x27;value&#x27;)) {
									rotate.update(ui.value);
								}
							},
							slide: function(event, ui) {
								rotate.update(ui.value, false);
							}
						}),
					ratio   = 1,
					prop    = 1,
					owidth  = 0,
					oheight = 0,
					cratio  = true,
					pwidth  = 0,
					pheight = 0,
					rwidth  = 0,
					rheight = 0,
					rdegree = 0,
					img     = $(&#x27;&lt;img/&gt;&#x27;)
						.load(function() {
							spinner.remove();
							
							owidth  = img.width();
							oheight = img.height();
							ratio   = owidth/oheight;
							resize.updateView(owidth, oheight);

							rhandle.append(img.show()).show();
							width.val(owidth);
							height.val(oheight);
							
							var r_scale = Math.min(pwidth, pheight) / Math.sqrt(Math.pow(owidth, 2) + Math.pow(oheight, 2));
							rwidth = owidth * r_scale;
							rheight = oheight * r_scale;
							
							type.button(&#x27;enable&#x27;);
							control.find(&#x27;input,select&#x27;).removeAttr(&#x27;disabled&#x27;)
								.filter(&#x27;:text&#x27;).keydown(function(e) {
									var c = e.keyCode, i;

									e.stopPropagation();
								
									if ((c &gt;= 37 &amp;&amp; c &lt;= 40) 
									|| c == $.ui.keyCode.BACKSPACE 
									|| c == $.ui.keyCode.DELETE 
									|| (c == 65 &amp;&amp; (e.ctrlKey||e.metaKey))
									|| c == 27) {
										return;
									}
								
									if (c == 9) {
										i = $(this).parent()[e.shiftKey ? &#x27;prev&#x27; : &#x27;next&#x27;](&#x27;.elfinder-resize-row&#x27;).children(&#x27;:text&#x27;);

										if (i.length) {
											i.focus();
										} else {
											$(this).parent().parent().find(&#x27;:text:&#x27; + (e.shiftKey ? &#x27;last&#x27; : &#x27;first&#x27;)).focus();
										}
									}
								
									if (c == 13) {
										fm.confirm({
											title  : $(&#x27;input:checked&#x27;, uitype).val(),
											text   : &#x27;confirmReq&#x27;,
											accept : {
												label    : &#x27;btnApply&#x27;,
												callback : function() {  
													save();
												}
											},
											cancel : {
												label    : &#x27;btnCancel&#x27;,
												callback : function(){}
											}
										});
										return;
									}
								
									if (!((c &gt;= 48 &amp;&amp; c &lt;= 57) || (c &gt;= 96 &amp;&amp; c &lt;= 105))) {
										e.preventDefault();
									}
								})
								.filter(&#x27;:first&#x27;).focus();
								
							resizable();
							
							reset.hover(function() { reset.toggleClass(&#x27;ui-state-hover&#x27;); }).click(resetView);
							
						})
						.error(function() {
							spinner.text(&#x27;Unable to load image&#x27;).css(&#x27;background&#x27;, &#x27;transparent&#x27;);
						}),
					basec = $(&#x27;&lt;div/&gt;&#x27;),
					imgc = $(&#x27;&lt;img/&gt;&#x27;),
					coverc = $(&#x27;&lt;div/&gt;&#x27;),
					imgr = $(&#x27;&lt;img/&gt;&#x27;),
					resetView = function() {
						width.val(owidth);
						height.val(oheight);
						resize.updateView(owidth, oheight);
					},
					resize = {
						update : function() {
							width.val(Math.round(img.width()/prop));
							height.val(Math.round(img.height()/prop));
						},
						
						updateView : function(w, h) {
							if (w &gt; pwidth || h &gt; pheight) {
								if (w / pwidth &gt; h / pheight) {
									prop = pwidth / w;
									img.width(pwidth).height(Math.ceil(h*prop));
								} else {
									prop = pheight / h;
									img.height(pheight).width(Math.ceil(w*prop));
								}
							} else {
								img.width(w).height(h);
							}
							
							prop = img.width()/w;
							uiprop.text(&#x27;1 : &#x27;+(1/prop).toFixed(2));
							resize.updateHandle();
						},
						
						updateHandle : function() {
							rhandle.width(img.width()).height(img.height());
						},
						fixWidth : function() {
							var w, h;
							if (cratio) {
								h = height.val();
								h = Math.round(h*ratio);
								resize.updateView(w, h);
								width.val(w);
							}
						},
						fixHeight : function() {
							var w, h;
							if (cratio) {
								w = width.val();
								h = Math.round(w/ratio);
								resize.updateView(w, h);
								height.val(h);
							}
						}
					},
					crop = {
						update : function() {
							offsetX.val(Math.round((rhandlec.data(&#x27;w&#x27;)||rhandlec.width())/prop));
							offsetY.val(Math.round((rhandlec.data(&#x27;h&#x27;)||rhandlec.height())/prop));
							pointX.val(Math.round(((rhandlec.data(&#x27;x&#x27;)||rhandlec.offset().left)-imgc.offset().left)/prop));
							pointY.val(Math.round(((rhandlec.data(&#x27;y&#x27;)||rhandlec.offset().top)-imgc.offset().top)/prop));
						},
						updateView : function() {
							var x = parseInt(pointX.val()) * prop + imgc.offset().left;
							var y = parseInt(pointY.val()) * prop + imgc.offset().top;
							var w = offsetX.val() * prop;
							var h = offsetY.val() * prop;
							rhandlec.data({x: x, y: y, w: w, h: h});
							rhandlec.width(Math.round(w));
							rhandlec.height(Math.round(h));
							coverc.width(rhandlec.width());
							coverc.height(rhandlec.height());
							rhandlec.offset({left: Math.round(x), top: Math.round(y)});
						},
						resize_update : function() {
							rhandlec.data({w: null, h: null});
							crop.update();
							coverc.width(rhandlec.width());
							coverc.height(rhandlec.height());
						},
						drag_update : function() {
							rhandlec.data({x: null, y: null});
							crop.update();
						}
					},
					rotate = {
						mouseStartAngle : 0,
						imageStartAngle : 0,
						imageBeingRotated : false,
							
						update : function(value, animate) {
							if (typeof value == &#x27;undefined&#x27;) {
								rdegree = value = parseInt(degree.val());
							}
							if (typeof animate == &#x27;undefined&#x27;) {
								animate = true;
							}
							if (! animate || fm.UA.Opera || fm.UA.ltIE8) {
								imgr.rotate(value);
							} else {
								imgr.animate({rotate: value + &#x27;deg&#x27;});
							}
							value = value % 360;
							if (value &lt; 0) {
								value += 360;
							}
							degree.val(parseInt(value));

							uidegslider.slider(&#x27;value&#x27;, degree.val());
						},
						
						execute : function ( e ) {
							
							if ( !rotate.imageBeingRotated ) return;
							
							var imageCentre = rotate.getCenter( imgr );
							var mouseXFromCentre = e.pageX - imageCentre[0];
							var mouseYFromCentre = e.pageY - imageCentre[1];
							var mouseAngle = Math.atan2( mouseYFromCentre, mouseXFromCentre );
							
							var rotateAngle = mouseAngle - rotate.mouseStartAngle + rotate.imageStartAngle;
							rotateAngle = Math.round(parseFloat(rotateAngle) * 180 / Math.PI);
							
							if ( e.shiftKey ) {
								rotateAngle = Math.round((rotateAngle + 6)/15) * 15;
							}
							
							imgr.rotate(rotateAngle);
							
							rotateAngle = rotateAngle % 360;
							if (rotateAngle &lt; 0) {
								rotateAngle += 360;
							}
							degree.val(rotateAngle);

							uidegslider.slider(&#x27;value&#x27;, degree.val());
							
							return false;
						},
						
						start : function ( e ) {
							
							rotate.imageBeingRotated = true;
							
							var imageCentre = rotate.getCenter( imgr );
							var mouseStartXFromCentre = e.pageX - imageCentre[0];
							var mouseStartYFromCentre = e.pageY - imageCentre[1];
							rotate.mouseStartAngle = Math.atan2( mouseStartYFromCentre, mouseStartXFromCentre );
							
							rotate.imageStartAngle = parseFloat(imgr.rotate()) * Math.PI / 180.0;
							
							$(document).mousemove( rotate.execute );
							
							return false;
						},
							
						stop : function ( e ) {
							
							if ( !rotate.imageBeingRotated ) return;
							
							$(document).unbind( &#x27;mousemove&#x27; , rotate.execute);
							
							setTimeout( function() { rotate.imageBeingRotated = false; }, 10 );
							return false;
						},
						
						getCenter : function ( image ) {
							
							var currentRotation = imgr.rotate();
							imgr.rotate(0);
							
							var imageOffset = imgr.offset();
							var imageCentreX = imageOffset.left + imgr.width() / 2;
							var imageCentreY = imageOffset.top + imgr.height() / 2;
							
							imgr.rotate(currentRotation);
							
							return Array( imageCentreX, imageCentreY );
						}
					},
					resizable = function(destroy) {
						if ($.fn.resizable) {
							if (destroy) {
								rhandle.filter(&#x27;:ui-resizable&#x27;).resizable(&#x27;destroy&#x27;);
								rhandle.hide();
							}
							else {
								rhandle.show();
								rhandle.resizable({
									alsoResize  : img,
									aspectRatio : cratio,
									resize      : resize.update,
									stop        : resize.fixHeight
								});
							}
						}
					},
					croppable = function(destroy) {
						if ($.fn.draggable &amp;&amp; $.fn.resizable) {
							if (destroy) {
								rhandlec.filter(&#x27;:ui-resizable&#x27;).resizable(&#x27;destroy&#x27;);
								rhandlec.filter(&#x27;:ui-draggable&#x27;).draggable(&#x27;destroy&#x27;);
								basec.hide();
							}
							else {
								imgc
									.width(img.width())
									.height(img.height());
								
								coverc
									.width(img.width())
									.height(img.height());
								
								rhandlec
									.width(imgc.width())
									.height(imgc.height())
									.offset(imgc.offset())
									.resizable({
										containment : basec,
										resize      : crop.resize_update,
										handles     : &#x27;all&#x27;
									})
									.draggable({
										handle      : coverc,
										containment : imgc,
										drag        : crop.drag_update
									});
								
								basec.show()
									.width(img.width())
									.height(img.height());
								
								crop.update();
							}
						}
					},
					rotateable = function(destroy) {
						if ($.fn.draggable &amp;&amp; $.fn.resizable) {
							if (destroy) {
								imgr.hide();
							}
							else {
								imgr.show()
									.width(rwidth)
									.height(rheight)
									.css(&#x27;margin-top&#x27;, (pheight-rheight)/2 + &#x27;px&#x27;)
									.css(&#x27;margin-left&#x27;, (pwidth-rwidth)/2 + &#x27;px&#x27;);

							}
						}
					},
					save = function() {
						var w, h, x, y, d;
						var mode = $(&#x27;input:checked&#x27;, uitype).val();
						
						//width.add(height).change(); // may be unnecessary
						
						if (mode == &#x27;resize&#x27;) {
							w = parseInt(width.val()) || 0;
							h = parseInt(height.val()) || 0;
						} else if (mode == &#x27;crop&#x27;) {
							w = parseInt(offsetX.val()) || 0;
							h = parseInt(offsetY.val()) || 0;
							x = parseInt(pointX.val()) || 0;
							y = parseInt(pointY.val()) || 0;
						} else if (mode == &#x27;rotate&#x27;) {
							w = owidth;
							h = oheight;
							d = parseInt(degree.val()) || 0;
							if (d &lt; 0 || d &gt; 360) {
								return fm.error(&#x27;Invalid rotate degree&#x27;);
							}
							if (d == 0 || d == 360) {
								return fm.error(&#x27;Image dose not rotated&#x27;);
							}
						}
						
						if (mode != &#x27;rotate&#x27;) {

							if (w &lt;= 0 || h &lt;= 0) {
								return fm.error(&#x27;Invalid image size&#x27;);
							}
							
							if (w == owidth &amp;&amp; h == oheight) {
								return fm.error(&#x27;Image size not changed&#x27;);
							}

						}
						
						dialog.elfinderdialog(&#x27;close&#x27;);
						
						fm.request({
							data : {
								cmd    : &#x27;resize&#x27;,
								target : file.hash,
								width  : w,
								height : h,
								x      : x,
								y      : y,
								degree : d,
								mode   : mode
							},
							notify : {type : &#x27;resize&#x27;, cnt : 1}
						})
						.fail(function(error) {
							dfrd.reject(error);
						})
						.done(function() {
							dfrd.resolve();
						});
						
					},
					buttons = {},
					hline   = &#x27;elfinder-resize-handle-hline&#x27;,
					vline   = &#x27;elfinder-resize-handle-vline&#x27;,
					rpoint  = &#x27;elfinder-resize-handle-point&#x27;,
					src     = fm.url(file.hash)
					;
				
				imgr.mousedown( rotate.start );
				$(document).mouseup( rotate.stop );
					
				uiresize.append($(row).append($(label).text(fm.i18n(&#x27;width&#x27;))).append(width).append(reset))
					.append($(row).append($(label).text(fm.i18n(&#x27;height&#x27;))).append(height))
					.append($(row).append($(&#x27;&lt;label/&gt;&#x27;).text(fm.i18n(&#x27;aspectRatio&#x27;)).prepend(constr)))
					.append($(row).append(fm.i18n(&#x27;scale&#x27;)+&#x27; &#x27;).append(uiprop));
				
				uicrop.append($(row).append($(label).text(&#x27;X&#x27;)).append(pointX))
					.append($(row).append($(label).text(&#x27;Y&#x27;)).append(pointY))
					.append($(row).append($(label).text(fm.i18n(&#x27;width&#x27;))).append(offsetX))
					.append($(row).append($(label).text(fm.i18n(&#x27;height&#x27;))).append(offsetY));
				
				uirotate.append($(row)
					.append($(label).text(fm.i18n(&#x27;rotate&#x27;)))
					.append($(&#x27;&lt;div style=&quot;float:left; width: 130px;&quot;&gt;&#x27;)
						.append($(&#x27;&lt;div style=&quot;float:left;&quot;&gt;&#x27;)
							.append(degree)
							.append($(&#x27;&lt;span/&gt;&#x27;).text(fm.i18n(&#x27;degree&#x27;)))
						)
						.append($(uibuttonset).append(uideg270).append($(uiseparator)).append(uideg90))
					)
					.append(uidegslider)
				);

				
				dialog.append(uitype);

				control.append($(row))
					.append(uiresize)
					.append(uicrop.hide())
					.append(uirotate.hide())
					.find(&#x27;input,select&#x27;).attr(&#x27;disabled&#x27;, &#x27;disabled&#x27;);
				
				rhandle.append(&#x27;&lt;div class=&quot;&#x27;+hline+&#x27; &#x27;+hline+&#x27;-top&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+hline+&#x27; &#x27;+hline+&#x27;-bottom&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+vline+&#x27; &#x27;+vline+&#x27;-left&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+vline+&#x27; &#x27;+vline+&#x27;-right&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-e&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-se&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-s&quot;/&gt;&#x27;);
					
				preview.append(spinner).append(rhandle.hide()).append(img.hide());

				rhandlec.css(&#x27;position&#x27;, &#x27;absolute&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+hline+&#x27; &#x27;+hline+&#x27;-top&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+hline+&#x27; &#x27;+hline+&#x27;-bottom&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+vline+&#x27; &#x27;+vline+&#x27;-left&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+vline+&#x27; &#x27;+vline+&#x27;-right&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-n&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-e&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-s&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-w&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-ne&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-se&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-sw&quot;/&gt;&#x27;)
					.append(&#x27;&lt;div class=&quot;&#x27;+rpoint+&#x27; &#x27;+rpoint+&#x27;-nw&quot;/&gt;&#x27;);

				preview.append(basec.css(&#x27;position&#x27;, &#x27;absolute&#x27;).hide().append(imgc).append(rhandlec.append(coverc)));
				
				preview.append(imgr.hide());
				
				preview.css(&#x27;overflow&#x27;, &#x27;hidden&#x27;);
				
				dialog.append(preview).append(control);
				
				buttons[fm.i18n(&#x27;btnApply&#x27;)] = save;
				buttons[fm.i18n(&#x27;btnCancel&#x27;)] = function() { dialog.elfinderdialog(&#x27;close&#x27;); };
				
				fm.dialog(dialog, {
					title          : file.name,
					width          : 650,
					resizable      : false,
					destroyOnClose : true,
					buttons        : buttons,
					open           : function() { preview.zIndex(1+$(this).parent().zIndex()); }
				}).attr(&#x27;id&#x27;, id);
				
				// for IE &lt; 9 dialog mising at open second+ time.
				if (fm.UA.ltIE8) {
					$(&#x27;.elfinder-dialog&#x27;).css(&#x27;filter&#x27;, &#x27;&#x27;);
				}
				
				reset.css(&#x27;left&#x27;, width.position().left + width.width() + 12);
				
				coverc.css({ &#x27;opacity&#x27;: 0.2, &#x27;background-color&#x27;: &#x27;#fff&#x27;, &#x27;position&#x27;: &#x27;absolute&#x27;}),
				rhandlec.css(&#x27;cursor&#x27;, &#x27;move&#x27;);
				rhandlec.find(&#x27;.elfinder-resize-handle-point&#x27;).css({
					&#x27;background-color&#x27; : &#x27;#fff&#x27;,
					&#x27;opacity&#x27;: 0.5,
					&#x27;border-color&#x27;:&#x27;#000&#x27;
				});

				imgr.css(&#x27;cursor&#x27;, &#x27;pointer&#x27;);
				
				uitype.buttonset();
				
				pwidth  = preview.width()  - (rhandle.outerWidth()  - rhandle.width());
				pheight = preview.height() - (rhandle.outerHeight() - rhandle.height());
				
				img.attr(&#x27;src&#x27;, src + (src.indexOf(&#x27;?&#x27;) === -1 ? &#x27;?&#x27; : &#x27;&amp;&#x27;)+&#x27;_=&#x27;+Math.random());
				imgc.attr(&#x27;src&#x27;, img.attr(&#x27;src&#x27;));
				imgr.attr(&#x27;src&#x27;, img.attr(&#x27;src&#x27;));
				
			},
			
			id, dialog
			;
			

		if (!files.length || files[0].mime.indexOf(&#x27;image/&#x27;) === -1) {
			return dfrd.reject();
		}
		
		id = &#x27;resize-&#x27;+fm.namespace+&#x27;-&#x27;+files[0].hash;
		dialog = fm.getUI().find(&#x27;#&#x27;+id);
		
		if (dialog.length) {
			dialog.elfinderdialog(&#x27;toTop&#x27;);
			return dfrd.resolve();
		}
		
		open(files[0], id);
			
		return dfrd;
	};

};

(function ($) {
	
	var findProperty = function (styleObject, styleArgs) {
		var i = 0 ;
		for( i in styleArgs) {
	        if (typeof styleObject[styleArgs[i]] != &#x27;undefined&#x27;) 
	        	return styleArgs[i];
		}
		styleObject[styleArgs[i]] = &#x27;&#x27;;
	    return styleArgs[i];
	};
	
	$.cssHooks.rotate = {
		get: function(elem, computed, extra) {
			return $(elem).rotate();
		},
		set: function(elem, value) {
			$(elem).rotate(value);
			return value;
		}
	};
	$.cssHooks.transform = {
		get: function(elem, computed, extra) {
			var name = findProperty( elem.style , 
				[&#x27;WebkitTransform&#x27;, &#x27;MozTransform&#x27;, &#x27;OTransform&#x27; , &#x27;msTransform&#x27; , &#x27;transform&#x27;] );
			return elem.style[name];
		},
		set: function(elem, value) {
			var name = findProperty( elem.style , 
				[&#x27;WebkitTransform&#x27;, &#x27;MozTransform&#x27;, &#x27;OTransform&#x27; , &#x27;msTransform&#x27; , &#x27;transform&#x27;] );
			elem.style[name] = value;
			return value;
		}
	};
	
	$.fn.rotate = function(val) {
		if (typeof val == &#x27;undefined&#x27;) {
			if (!!window.opera) {
				var r = this.css(&#x27;transform&#x27;).match(/rotate\((.*?)\)/);
				return  ( r &amp;&amp; r[1])?
					Math.round(parseFloat(r[1]) * 180 / Math.PI) : 0;
			} else {
				var r = this.css(&#x27;transform&#x27;).match(/rotate\((.*?)\)/);
				return  ( r &amp;&amp; r[1])? parseInt(r[1]) : 0;
			}
		}
		this.css(&#x27;transform&#x27;, 
			this.css(&#x27;transform&#x27;).replace(/none|rotate\(.*?\)/, &#x27;&#x27;) + &#x27;rotate(&#x27; + parseInt(val) + &#x27;deg)&#x27;);
		return this;
	};

	$.fx.step.rotate  = function(fx) {
		if ( fx.state == 0 ) {
			fx.start = $(fx.elem).rotate();
			fx.now = fx.start;
		}
		$(fx.elem).rotate(fx.now);
	};

	if (typeof window.addEventListener == &quot;undefined&quot; &amp;&amp; typeof document.getElementsByClassName == &quot;undefined&quot;) { // IE &amp; IE&lt;9
		var GetAbsoluteXY = function(element) {
			var pnode = element;
			var x = pnode.offsetLeft;
			var y = pnode.offsetTop;
			
			while ( pnode.offsetParent ) {
				pnode = pnode.offsetParent;
				if (pnode != document.body &amp;&amp; pnode.currentStyle[&#x27;position&#x27;] != &#x27;static&#x27;) {
					break;
				}
				if (pnode != document.body &amp;&amp; pnode != document.documentElement) {
					x -= pnode.scrollLeft;
					y -= pnode.scrollTop;
				}
				x += pnode.offsetLeft;
				y += pnode.offsetTop;
			}
			
			return { x: x, y: y };
		};
		
		var StaticToAbsolute = function (element) {
			if ( element.currentStyle[&#x27;position&#x27;] != &#x27;static&#x27;) {
				return ;
			}

			var xy = GetAbsoluteXY(element);
			element.style.position = &#x27;absolute&#x27; ;
			element.style.left = xy.x + &#x27;px&#x27;;
			element.style.top = xy.y + &#x27;px&#x27;;
		};

		var IETransform = function(element,transform){

			var r;
			var m11 = 1;
			var m12 = 1;
			var m21 = 1;
			var m22 = 1;

			if (typeof element.style[&#x27;msTransform&#x27;] != &#x27;undefined&#x27;){
				return true;
			}

			StaticToAbsolute(element);

			r = transform.match(/rotate\((.*?)\)/);
			var rotate =  ( r &amp;&amp; r[1])	?	parseInt(r[1])	:	0;

			rotate = rotate % 360;
			if (rotate &lt; 0) rotate = 360 + rotate;

			var radian= rotate * Math.PI / 180;
			var cosX =Math.cos(radian);
			var sinY =Math.sin(radian);

			m11 *= cosX;
			m12 *= -sinY;
			m21 *= sinY;
			m22 *= cosX;

			element.style.filter =  (element.style.filter || &#x27;&#x27;).replace(/progid:DXImageTransform\.Microsoft\.Matrix\([^)]*\)/, &quot;&quot; ) +
				(&quot;progid:DXImageTransform.Microsoft.Matrix(&quot; + 
					 &quot;M11=&quot; + m11 + 
					&quot;,M12=&quot; + m12 + 
					&quot;,M21=&quot; + m21 + 
					&quot;,M22=&quot; + m22 + 
					&quot;,FilterType=&#x27;bilinear&#x27;,sizingMethod=&#x27;auto expand&#x27;)&quot;) 
				;

	  		var ow = parseInt(element.style.width || element.width || 0 );
	  		var oh = parseInt(element.style.height || element.height || 0 );

			var radian = rotate * Math.PI / 180;
			var absCosX =Math.abs(Math.cos(radian));
			var absSinY =Math.abs(Math.sin(radian));

			var dx = (ow - (ow * absCosX + oh * absSinY)) / 2;
			var dy = (oh - (ow * absSinY + oh * absCosX)) / 2;

			element.style.marginLeft = Math.floor(dx) + &quot;px&quot;;
			element.style.marginTop  = Math.floor(dy) + &quot;px&quot;;

			return(true);
		};
		
		var transform_set = $.cssHooks.transform.set;
		$.cssHooks.transform.set = function(elem, value) {
			transform_set.apply(this, [elem, value] );
			IETransform(elem,value);
			return value;
		};
	}

})(jQuery);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
