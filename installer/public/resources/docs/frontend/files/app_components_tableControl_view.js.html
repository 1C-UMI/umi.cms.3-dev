<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app\components\tableControl\view.js - umi-cms-3</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="umi-cms-3"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ApplicationRoute.html">ApplicationRoute</a></li>
            
                <li><a href="../classes/ComponentController.html">ComponentController</a></li>
            
                <li><a href="../classes/dialogelfinder - open elFinder in dialog window.html">dialogelfinder - open elFinder in dialog window</a></li>
            
                <li><a href="../classes/DS.ManyArray.html">DS.ManyArray</a></li>
            
                <li><a href="../classes/elFinder - file manager for web.html">elFinder - file manager for web</a></li>
            
                <li><a href="../classes/elFinder command &quot;archive&quot;
Archive selected files.html">elFinder command &quot;archive&quot;
Archive selected files</a></li>
            
                <li><a href="../classes/elFinder command &quot;back&quot;
Open last visited folder.html">elFinder command &quot;back&quot;
Open last visited folder</a></li>
            
                <li><a href="../classes/elFinder command &quot;copy&quot;.
Put files in filemanager clipboard..html">elFinder command &quot;copy&quot;.
Put files in filemanager clipboard.</a></li>
            
                <li><a href="../classes/elFinder command &quot;download&quot;. 
Download selected files.
Only for new api.html">elFinder command &quot;download&quot;. 
Download selected files.
Only for new api</a></li>
            
                <li><a href="../classes/elFinder command &quot;duplicate&quot;
Create file/folder copy with suffix &quot;copy Number&quot;.html">elFinder command &quot;duplicate&quot;
Create file/folder copy with suffix &quot;copy Number&quot;</a></li>
            
                <li><a href="../classes/elFinder command &quot;edit&quot;. 
Edit text file in dialog window.html">elFinder command &quot;edit&quot;. 
Edit text file in dialog window</a></li>
            
                <li><a href="../classes/elFinder command &quot;extract&quot;
Extract files from archive.html">elFinder command &quot;extract&quot;
Extract files from archive</a></li>
            
                <li><a href="../classes/elFinder command &quot;forward&quot;
Open next visited folder.html">elFinder command &quot;forward&quot;
Open next visited folder</a></li>
            
                <li><a href="../classes/elFinder command &quot;getfile&quot;. 
Return selected files info into outer callback.
For use elFinder with wysiwyg editors etc..html">elFinder command &quot;getfile&quot;. 
Return selected files info into outer callback.
For use elFinder with wysiwyg editors etc.</a></li>
            
                <li><a href="../classes/elFinder command &quot;help&quot;
&quot;About&quot; dialog.html">elFinder command &quot;help&quot;
&quot;About&quot; dialog</a></li>
            
                <li><a href="../classes/elFinder command &quot;info&quot;. 
Display dialog with file properties..html">elFinder command &quot;info&quot;. 
Display dialog with file properties.</a></li>
            
                <li><a href="../classes/elFinder command &quot;mkdir&quot;
Create new folder.html">elFinder command &quot;mkdir&quot;
Create new folder</a></li>
            
                <li><a href="../classes/elFinder command &quot;mkfile&quot;
Create new empty file.html">elFinder command &quot;mkfile&quot;
Create new empty file</a></li>
            
                <li><a href="../classes/elFinder command &quot;netmount&quot;
Mount network volume with user credentials..html">elFinder command &quot;netmount&quot;
Mount network volume with user credentials.</a></li>
            
                <li><a href="../classes/elFinder command &quot;open&quot;
Enter folder or open files in new windows.html">elFinder command &quot;open&quot;
Enter folder or open files in new windows</a></li>
            
                <li><a href="../classes/elFinder command &quot;paste&quot;
Paste filesfrom clipboard into directory.
If files pasted in its parent directory - files duplicates will created.html">elFinder command &quot;paste&quot;
Paste filesfrom clipboard into directory.
If files pasted in its parent directory - files duplicates will created</a></li>
            
                <li><a href="../classes/elFinder command &quot;quicklook&quot;
Fast preview for some files types.html">elFinder command &quot;quicklook&quot;
Fast preview for some files types</a></li>
            
                <li><a href="../classes/elFinder command &quot;reload&quot;
Sync files and folders.html">elFinder command &quot;reload&quot;
Sync files and folders</a></li>
            
                <li><a href="../classes/elFinder command &quot;rename&quot;. 
Rename selected file..html">elFinder command &quot;rename&quot;. 
Rename selected file.</a></li>
            
                <li><a href="../classes/elFinder command &quot;resize&quot;
Open dialog to resize image.html">elFinder command &quot;resize&quot;
Open dialog to resize image</a></li>
            
                <li><a href="../classes/elFinder command &quot;rm&quot;
Delete files.html">elFinder command &quot;rm&quot;
Delete files</a></li>
            
                <li><a href="../classes/elFinder command &quot;search&quot;
Find files.html">elFinder command &quot;search&quot;
Find files</a></li>
            
                <li><a href="../classes/elFinder command &quot;sort&quot;
Change sort files rule.html">elFinder command &quot;sort&quot;
Change sort files rule</a></li>
            
                <li><a href="../classes/elFinder command &quot;up&quot;
Go into parent directory.html">elFinder command &quot;up&quot;
Go into parent directory</a></li>
            
                <li><a href="../classes/elFinder command &quot;upload&quot;
Upload files using iframe or XMLHttpRequest &amp; FormData.
Dialog allow to send files using drag and drop.html">elFinder command &quot;upload&quot;
Upload files using iframe or XMLHttpRequest &amp; FormData.
Dialog allow to send files using drag and drop</a></li>
            
                <li><a href="../classes/elFinder command &quot;view&quot;
Change current directory view (icons/list).html">elFinder command &quot;view&quot;
Change current directory view (icons/list)</a></li>
            
                <li><a href="../classes/elFinder contextmenu.html">elFinder contextmenu</a></li>
            
                <li><a href="../classes/elFinder dialog.html">elFinder dialog</a></li>
            
                <li><a href="../classes/elFinder folders tree.html">elFinder folders tree</a></li>
            
                <li><a href="../classes/elFinder places/favorites ui.html">elFinder places/favorites ui</a></li>
            
                <li><a href="../classes/elFinder toolbar.html">elFinder toolbar</a></li>
            
                <li><a href="../classes/elFinder toolbar button menu with sort variants..html">elFinder toolbar button menu with sort variants.</a></li>
            
                <li><a href="../classes/elFinder toolbar button to switch current directory view..html">elFinder toolbar button to switch current directory view.</a></li>
            
                <li><a href="../classes/elFinder toolbar button widget.
If command has variants - create menu.html">elFinder toolbar button widget.
If command has variants - create menu</a></li>
            
                <li><a href="../classes/elFinder toolbar search button widget..html">elFinder toolbar search button widget.</a></li>
            
                <li><a href="../classes/elFinder toolbar&#x27;s button tor upload file.html">elFinder toolbar&#x27;s button tor upload file</a></li>
            
                <li><a href="../classes/elFinder ui
Display current folder path in statusbar.
Click on folder name in path - open folder.html">elFinder ui
Display current folder path in statusbar.
Click on folder name in path - open folder</a></li>
            
                <li><a href="../classes/elFinder ui
Display number of files/selected files and its size in statusbar.html">elFinder ui
Display number of files/selected files and its size in statusbar</a></li>
            
                <li><a href="../classes/elFinder.history
Store visited folders
and provide &quot;back&quot; and &quot;forward&quot; methods.html">elFinder.history
Store visited folders
and provide &quot;back&quot; and &quot;forward&quot; methods</a></li>
            
                <li><a href="../classes/elfindernav - elFinder container for diretories tree and places.html">elfindernav - elFinder container for diretories tree and places</a></li>
            
                <li><a href="../classes/elfinderworkzone - elFinder container for nav and current directory.html">elfinderworkzone - elFinder container for nav and current directory</a></li>
            
                <li><a href="../classes/IndexRoute.html">IndexRoute</a></li>
            
                <li><a href="../classes/Inflector.inflector.html">Inflector.inflector</a></li>
            
                <li><a href="../classes/map.html">map</a></li>
            
                <li><a href="../classes/UmiRESTAdapter.html">UmiRESTAdapter</a></li>
            
                <li><a href="../classes/Utils.html">Utils</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Router.html">Router</a></li>
            
                <li><a href="../modules/UMI.html">UMI</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: app\components\tableControl\view.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define([&#x27;App&#x27;], function(UMI){
    &#x27;use strict&#x27;;
    return function(){
        UMI.TableControlView = Ember.View.extend({
            actions: {
                removeRecord: function(){
                    console.log(&#x27;removeRecord&#x27;);
//                    var objectId = this.$();
//                    console.log(objectId);
                },

                removeRecords: function(){
                    console.log(&#x27;removeRecords&#x27;);
                },

                sortDirection: function(){
                    console.log(&#x27;sortDirection&#x27;);
                }
            },

            templateName: &#x27;tableControl&#x27;,
            classNames: [&#x27;umi-table-control&#x27;],
            columnsWidth: function(){
                var meta = this.get(&#x27;controller&#x27;).get(&#x27;content&#x27;).viewSettings;
                var columnsWidthArray = [];
                if(!meta){
                    throw new Error(&#x27;Нет метаданных для таблицы.&#x27;);
                } else{
                    for(var i = 0; i &lt; meta.columns.length; i++){
                        columnsWidthArray.push(meta.columns[i].width);
                    }
                }
                return columnsWidthArray;
            }.property(),

            willInsertElement: function(){
                /**
                 * Секретный хак.
                 *
                 * Ширина колонок таблицы задаётся через JS. При загрузке происходит отрисовка таблицы, а потом повторная перерисовка после присвоения ширины колонкам.
                 * Чтобы предотвратить двойную отрисовку, перед отрисовкой таблицы генерируем необходимые стили и вставляем их в body, а потом отрисовываем таблицу.
                 *
                 */
                var that = this;
                $(&#x27;body&#x27;).append(function(){
                    var result = &#x27;&#x27;;
                    //nth-of-type начинает отсчёт не с нуля, а с единицы
                    //TODO Оптимизировать селекторы
                    var columnsWidth = that.get(&#x27;columnsWidth&#x27;);
                    for(var i = 1; i &lt; columnsWidth.length + 1; i++){
                        result = result + &#x27;.umi-table-titles .umi-table-header-column:nth-of-type(&#x27; + i + &#x27;) .umi-table-title-div, .umi-table-filters td:nth-of-type(&#x27; + i + &#x27;)&gt;div{width: &#x27; + columnsWidth[i - 1] + &#x27;px} &#x27;; //.umi-filters td:nth-of-type(&#x27; + i + &#x27;)&gt;div,
                        var colWidth = columnsWidth[i - 1];
                        result = result + &#x27;.umi-table tr:first-of-type td:nth-of-type(&#x27; + i + &#x27;) div{width: &#x27; + colWidth + &#x27;px} &#x27;;
                    }
                    result = &#x27;&lt;style id=&quot;tableControlWidthStyles&quot;&gt;&#x27; + result + &#x27;&lt;/style&gt;&#x27;;
                    return result;
                });
            },

            didInsertElement: function(){
                window.RAF = (function(){
                    return window.requestAnimationFrame || //                        window.webkitRequestAnimationFrame ||
                        //                        window.mozRequestAnimationFrame    ||
                        //                        window.oRequestAnimationFrame      ||
                        //                        window.msRequestAnimationFrame     ||
                        function(callback){
                            window.setTimeout(callback, 16.666666666666668);
                        };
                })();

                var columnsWidth = this.get(&#x27;columnsWidth&#x27;);
                var cols = columnsWidth.length - 1;

                // Установка ширины колонок при загрузке.
                // Дублирут по функционалу сгенериванный CSS в willInsertElement.
                // Устраняет проблему связанную с тем, что сгенерированный CSS перечисляет колонки подряд по nth-of-type.
                // При перестановке колонок выставляется ширина колонки в соответствии со сгенерированным CSS, вместо собственной ширины колонки
                var setColumnsSize = function(){
                    var headersCache = document.querySelector(&#x27;.umi-table-titles&#x27;).querySelectorAll(&#x27;.umi-table-title-div&#x27;);
                    var filtersCache = document.querySelector(&#x27;.umi-table-filters&#x27;).querySelectorAll(&#x27;.umi-table-filter-div&#x27;);
                    //TODO В этой строке возникает баг при отсутвии записей в таблице
                    if(document.querySelector(&#x27;.umi-table-cell-div&#x27;)){
                        var rowsLengthNotNull = true;
                        var colsCache = document.querySelector(&#x27;.umi-table&#x27;).querySelector(&#x27;.umi-table-tr&#x27;).querySelectorAll(&#x27;.umi-table-cell-div&#x27;);
                    }

                    for(var i = 0; i &lt; cols + 1; i++){
                        headersCache[i].style.width = columnsWidth[i] + &#x27;px&#x27;;
                        filtersCache[i].style.width = columnsWidth[i] + &#x27;px&#x27;;
                        if(rowsLengthNotNull){
                            colsCache[i].style.width = columnsWidth[i] + &#x27;px&#x27;;
                        }
                    }
                };

                //Функция вызывается после выполнения всего didInsertelement
                var tableControlScroll;
                setTimeout(function(){
                    setColumnsSize();
                    tableControlScroll = new IScroll(&#x27;.umi-table-control-content-center&#x27;, {
                        scrollX: true,
                        probeType: 3,
                        mouseWheel: true,
                        scrollbars: true,
                        bounce: false,
                        click: true,
                        freeScroll: false,
                        keyBindings: true,
                        interactiveScrollbars: true
                    });

                    var umiTableHeader = document.querySelector(&#x27;.umi-table-header&#x27;);
                    var umiTableLeft = document.querySelector(&#x27;.umi-table-left&#x27;);
                    tableControlScroll.on(&#x27;scroll&#x27;, function(){
                        umiTableLeft.style.marginTop = this.y + &#x27;px&#x27;;
                        umiTableHeader.style.marginLeft = this.x + &#x27;px&#x27;;
                    });
                }, 0);

                //------------------------------------------------------------------------------------------------------

                var dragColumn = function(){
                    var currentColumn;
                    var currentColumnWidth;
                    var detachHeaderCell = null;
                    var detachHeaderTitleCells = [];
                    var detachHeaderFilterCells = [];
                    var detachTableCell = null;
                    var detachTableCells = [];

                    $(&#x27;.umi-table-header-column&#x27;).not(&#x27;.umi-table-header-column-fixed&#x27;).on(&#x27;mousedown&#x27;, function(event){
                        if(event.button === 0){ //Проверка на нажатие левой кнопки мыши

                            //Удаляем хак-стили для ширины, чтобы небыло бага ширины столбцов при перестановке
                            $(&#x27;#tableControlWidthStyles&#x27;).remove();

                            $(&#x27;html&#x27;).addClass(&#x27;s-unselectable&#x27;);

                            currentColumnWidth = $(this).find(&#x27;.umi-table-title-div&#x27;).width();
                            currentColumn = $(this).index(&#x27;.umi-table-header-column&#x27;);


                            //Удаление столбца с сохранением его содержимого
                            var detachHeaderCellsGhost = &#x27;&#x27;;
                            var detachTableCellsGhost = &#x27;&#x27;;
                            //TODO Сделать код универсальным - перебор строк, а не для кажой по-отдельности
                            detachHeaderCell = document.querySelector(&#x27;.umi-table-titles&#x27;).querySelectorAll(&#x27;td&#x27;)[currentColumn];
                            detachHeaderTitleCells.push(detachHeaderCell); //Массив ссылок на ячейки колонки
                            //Оптимизация. Сохранение всех элементов в единую строку для вставки всех данных без дополнительного цикла и одним обращением к DOM
                            detachHeaderCellsGhost = detachHeaderCellsGhost + &#x27;&lt;tr&gt;&lt;td&gt;&#x27; + detachHeaderCell.innerHTML + &#x27;&lt;/td&gt;&lt;/tr&gt;&#x27;; //Содержимое с тегами
                            detachHeaderCell.remove();


                            detachHeaderCell = document.querySelector(&#x27;.umi-table-filters&#x27;).querySelectorAll(&#x27;td&#x27;)[currentColumn];
                            detachHeaderFilterCells.push(detachHeaderCell); //Массив ссылок на ячейки колонки
                            //Оптимизация. Сохранение всех элементов в единую строку для вставки всех данных без дополнительного цикла и одним обращением к DOM
                            detachHeaderCellsGhost = detachHeaderCellsGhost + &#x27;&lt;tr&gt;&lt;td&gt;&#x27; + detachHeaderCell.innerHTML + &#x27;&lt;/td&gt;&lt;/tr&gt;&#x27;; //Содержимое с тегами
                            //TODO IE не работает
                            detachHeaderCell.remove();


                            $(&#x27;.umi-table&#x27;).find(&#x27;.umi-table-tr&#x27;).each(function(index, element){
                                detachTableCell = element.querySelectorAll(&#x27;td&#x27;)[currentColumn];
                                detachTableCells.push(detachTableCell); //Массив ссылок на ячейки колонки
                                //Оптимизация. Сохранение всех элементов в единую строку для вставки всех данных без дополнительного цикла и одним обращением к DOM
                                detachTableCellsGhost = detachTableCellsGhost + &#x27;&lt;tr class=&quot;ghost-tr&quot;&gt;&lt;td&gt;&lt;div class=&quot;ghost-div&quot;&gt;&#x27; + detachTableCell.querySelector(&#x27;div&#x27;).textContent + &#x27;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&#x27;; //Содержимое с тегами
                                detachTableCell.remove();
                            });


                            //Вставка колонки
                            var columnInsert = function(currentColumn){
                                //Вставляем элемент перед выбранной колонкой
                                //TODO Сделать код универсальным - перебор строк, а не для кажой по-отдельности
                                $(&#x27;.umi-table-header-column&#x27;).before(function(){
                                    if($(this).index(&#x27;.umi-table-header-column&#x27;) === currentColumn){
                                        return detachHeaderTitleCells.shift();
                                    }
                                });

                                $(&#x27;.umi-table-filter-column&#x27;).before(function(){
                                    if($(this).index(&#x27;.umi-table-filter-column&#x27;) === currentColumn){
                                        return detachHeaderFilterCells.shift();
                                    }
                                });

                                $(&#x27;.umi-table&#x27;).find(&#x27;.umi-table-tr&#x27;).each(function(){
                                    $(this).find(&#x27;.umi-table-cell-td&#x27;).eq(currentColumn).before(function(){
                                        return detachTableCells.shift();
                                    });
                                });
                            };


                            //Добавление плавающего призрака
                            var addGhost = function(){
                                $(&#x27;body&#x27;).append(function(){
                                     return &#x27;&lt;div class=&quot;ghost&quot;&gt;&lt;table class=&quot;umi-table-ghost-header&quot;&gt;&#x27; + detachHeaderCellsGhost + &#x27;&lt;/table&gt;&lt;table class=&quot;umi-table-ghost-content&quot;&gt;&#x27; + detachTableCellsGhost + &#x27;&lt;/table&gt;&lt;/div&gt;&#x27;;
                                });
                                document.querySelectorAll(&#x27;.ghost div&#x27;)[0].style.width = currentColumnWidth + &#x27;px&#x27;;
                                document.querySelector(&#x27;.ghost&#x27;).style.width = currentColumnWidth + 20 + &#x27;px&#x27;;
                            };


                            //Устанавливаем позицию призрака при первоначальной вставке в DOM
                            var ghostPosition = function(event){
                                window.RAF(function(){
                                    var x = event.pageX - $(&#x27;.ghost&#x27;).width() / 2 + &#x27;px&#x27;;
                                    var y = event.pageY - 15 + &#x27;px&#x27;;
                                    var ghost = document.querySelector(&#x27;.ghost&#x27;).style; //TODO в консоли периодически вылезает ошибка о попытке прочесть style у несуществующего элемента
                                    ghost.top = y;
                                    ghost.left = x;
                                });
                            };

                            addGhost();
                            ghostPosition(event);


                            //Удаление/Добавление колонки-призрака
                            var addGhostColumn = function(currentColumn){
                                window.RAF(function(){
                                    $(&#x27;.tableGhost&#x27;).remove();
                                    var umiHeader = document.querySelector(&#x27;.umi-table-titles&#x27;);
                                    var headerCell = umiHeader.insertCell(0);
                                    headerCell.innerHTML = &#x27;&lt;div&gt;&lt;/div&gt;&#x27;;
                                    headerCell.className = &#x27;tableGhost&#x27;;
                                    headerCell.querySelector(&#x27;div&#x27;).style.width = currentColumnWidth - 2 + 20 + &#x27;px&#x27;;
                                    var nextHeaderSibling = umiHeader.querySelectorAll(&#x27;td&#x27;)[currentColumn + 1];

                                    var umiFilter = document.querySelector(&#x27;.umi-table-filters&#x27;);
                                    var filterCell = umiFilter.insertCell(0);
                                    filterCell.innerHTML = &#x27;&lt;div&gt;&lt;/div&gt;&#x27;;
                                    filterCell.className = &#x27;tableGhost&#x27;;
                                    filterCell.querySelector(&#x27;div&#x27;).style.width = currentColumnWidth - 2 + 20 + &#x27;px&#x27;;
                                    var nextFilterSibling = umiFilter.querySelectorAll(&#x27;td&#x27;)[currentColumn + 1];


                                    var umiTable = document.querySelector(&#x27;.umi-table .umi-table-tr&#x27;);
                                    var cell = umiTable.insertCell(0);
                                    cell.innerHTML = &#x27;&lt;div&gt;&lt;/div&gt;&#x27;;
                                    cell.className = &#x27;tableGhost&#x27;;
                                    cell.setAttribute(&#x27;rowspan&#x27;, 100);
                                    cell.querySelector(&#x27;div&#x27;).style.width = currentColumnWidth + 20 + &#x27;px&#x27;;
                                    var nextSibling = umiTable.querySelectorAll(&#x27;td&#x27;)[currentColumn + 1];

                                    umiHeader.insertBefore(headerCell, nextHeaderSibling);
                                    umiFilter.insertBefore(filterCell, nextFilterSibling);
                                    umiTable.insertBefore(cell, nextSibling);
                                });
                            };

                            addGhostColumn(currentColumn);

                            var arrSum = function(array, elem){
                                var result = 0;
                                for(var i = 0; i &lt; elem; i++){
                                    result = result + array[i];
                                }
                                return result;
                            };


                            var umiTableControl = $(&#x27;.umi-table-control&#x27;);
                            $(document).on(&#x27;mousemove&#x27;, &#x27;body, .ghost&#x27;, function(event){
                                ghostPosition(event);

                                //Позиция курсора относительно таблицы
                                var tableCursorX = event.pageX - umiTableControl.offset().left;
                                //TODO Подправить формулу определения местонахождения ghostColumn при перетаскивании
                                //Находим координаты в который будет вызываться перестановка tableGhostColumn
                                var leftColumnCenter = arrSum(columnsWidth, currentColumn) - columnsWidth[currentColumn - 1] / 2; //Сумма всех ширин колонок до текущей - половина ширины предыдущей
                                var rightColumnCenter = arrSum(columnsWidth, currentColumn) + columnsWidth[currentColumn] + columnsWidth[currentColumn + 1] / 2; //Сумма всех ширин колонок до текущей + ширина текущей + половина ширины следующей

                                //Рассчёт позиции вставки колонки
                                //                                var columnTargetRight = arrSum(columnsWidth, currentColumn + 1);
                                //                                var columnTargetLeft = arrSum(columnsWidth, currentColumn);


                                //                                console.log(&#x27;tableCursorX: &#x27; + tableCursorX);
                                //                                console.log(&#x27;leftColumnCenter: &#x27; + leftColumnCenter);
                                //                                console.log(&#x27;rightColumnCenter: &#x27; + rightColumnCenter);

                                if(columnsWidth.length &gt; currentColumn &gt; 0){
                                    if(tableCursorX &lt; leftColumnCenter){
                                        currentColumn = currentColumn - 1;
                                        addGhostColumn(currentColumn);
                                    }

                                    if(tableCursorX &gt; rightColumnCenter){
                                        currentColumn = currentColumn + 1;
                                        addGhostColumn(currentColumn);
                                    }
                                }
                            });


                            //Удаление призрака, вставка столбца
                            $(document).on(&#x27;mouseup&#x27;, function(){
                                $(document).off(&#x27;mousemove&#x27;);
                                $(&#x27;.ghost&#x27;).remove();
                                $(&#x27;.tableGhost&#x27;).remove();

                                columnInsert(currentColumn);

                                $(&#x27;html&#x27;).removeClass(&#x27;s-unselectable&#x27;);
                            });
                        }
                    });
                };
                dragColumn();

                //Подсветка строки при наведении курсора мыши
                $(&#x27;.umi-table&#x27;).filter(&#x27;.umi-table-tr&#x27;).on(&#x27;mouseenter&#x27;, function(){
                    var row = $(this);
                    var trBackground = row.css(&#x27;background&#x27;);
                    row.css({&#x27;background&#x27;: &#x27;#BFE0F8&#x27;});
                    row.mouseleave(function(){
                        row.css({&#x27;background&#x27;: trBackground});
                    });
                });


                //Изменение ширины колонок
                var self = this;
                $(&#x27;.umi-table-column-resizer&#x27;).on(&#x27;mousedown&#x27;, function(event){
                    event.stopPropagation();
                    $(&#x27;html&#x27;).addClass(&#x27;s-unselectable&#x27;);

                    $(this).css({&#x27;background&#x27;: &#x27;#444444&#x27;});
                    var columnNumber = $(this).index(&#x27;.umi-table-column-resizer&#x27;);
                    var columnWidth;
                    var parentLeft = $(this).parent().offset().left;

                    var rows = document.querySelectorAll(&#x27;.umi-table tr&#x27;).length;

                    $(&#x27;body&#x27;).on(&#x27;mousemove&#x27;, this, function(event){
                        columnWidth = event.pageX - parentLeft - 20; // -20 - компенсация padding
                        if(columnWidth &gt; 59){
                            window.RAF(function(){
                                document.querySelector(&#x27;.umi-table-titles&#x27;).querySelectorAll(&#x27;.umi-table-title-div&#x27;)[columnNumber].style.width = columnWidth + &#x27;px&#x27;;
                                document.querySelector(&#x27;.umi-table-filters&#x27;).querySelectorAll(&#x27;.umi-table-filter-div&#x27;)[columnNumber].style.width = columnWidth + &#x27;px&#x27;;
                                for(var i = 0; i &lt; rows; i++){
                                    document.querySelector(&#x27;.umi-table&#x27;).querySelectorAll(&#x27;.umi-table-tr&#x27;)[i].querySelectorAll(&#x27;.umi-table-cell-div&#x27;)[columnNumber].style.width = columnWidth + &#x27;px&#x27;;
                                }
                            });
                        }
                        //Сохраняем новую ширину колонки в массив ширин колонок
//                        self.get(&#x27;controller&#x27;).get(&#x27;content&#x27;).meta.columns[columnNumber].width = columnWidth;
                        //TODO допилить API для добавления возможности сохранения
                        //self.get(&#x27;controller&#x27;).get(&#x27;model&#x27;).save();
                    });

                    var that = this;
                    $(&#x27;body&#x27;).on(&#x27;mouseup&#x27;, function(){
                        $(&#x27;body&#x27;).off(&#x27;mousemove&#x27;);

                        $(that).css({&#x27;background&#x27;: &#x27;none&#x27;});
                        $(&#x27;html&#x27;).removeClass(&#x27;s-unselectable&#x27;);
                        tableControlScroll.refresh();
                    });
                });


                //Закрепление колонки
                //					$(&#x27;.umi-table-pin-column&#x27;).click(function(){
                //						var currentColumn = $(this).index(&#x27;.umi-table-pin-column&#x27;);
                //						var columnWidth;
                //						var copyHeaderCell;
                //						var copyHeaderCells = [];
                //						var copyTableCell;
                //						var copyTableCells = [];
                //
                //						$(&#x27;.umi-table-header tr&#x27;).each(function(index, element){
                //							columnWidth = $(this).find(&#x27;div&#x27;).width();
                //							copyHeaderCell = element.querySelectorAll(&#x27;td&#x27;)[currentColumn].innerHTML;
                //							copyHeaderCells.push(copyHeaderCell); //Содержимое в ячейках
                //						});
                //
                //						$(&#x27;.umi-table-control-header-center&#x27;).css({&#x27;left&#x27;: columnWidth});
                //
                //						$(&#x27;.umi-table-header-left-tr&#x27;).each(function(){
                //							$(this).find(&#x27;td&#x27;).after(function(){
                //								return &#x27;&lt;td&gt;&#x27; + copyHeaderCells.shift() + &#x27;&lt;/td&gt;&#x27;;
                //							});
                //							$(this).find(&#x27;div:nth-of-type(2)&#x27;).width(columnWidth);
                //						});
                //
                //
                //
                //						$(&#x27;.umi-table&#x27;).find(&#x27;.umi-table-tr&#x27;).each(function(index, element){
                //							copyTableCell = element.querySelectorAll(&#x27;td&#x27;)[currentColumn].innerHTML;
                //							copyTableCells.push(copyTableCell); //Содержимое в ячейках
                //						});
                //
                //						$(&#x27;.umi-table-control-content-center&#x27;).css({&#x27;left&#x27;: columnWidth});
                //
                //						$(&#x27;.umi-table-left-tr&#x27;).each(function(){
                //							$(this).find(&#x27;td&#x27;).after(function(){
                //								return &#x27;&lt;td&gt;&#x27; + copyTableCells.shift() + &#x27;&lt;/td&gt;&#x27;;
                //							});
                //							$(this).find(&#x27;div:nth-of-type(2)&#x27;).width(columnWidth);
                //						});
                //
                //						$(this).toggleClass(&#x27;icon-left-thin icon-right-thin&#x27;);
                //					});


                //Переключение кнопки сортировки вверх-вниз
                $(&#x27;.umi-table-sort-column&#x27;).mousedown(function(){
                    $(this).toggleClass(&#x27;icon-bottom-thin icon-top-thin&#x27;);

                });

                //Выделение всех checkbox
                $(&#x27;.umi-table-title-div-left input&#x27;).click(function(){
                    var $that = $(this);
                    $(&#x27;.umi-table-left&#x27;).find(&#x27;input&#x27;).prop(&quot;checked&quot;, function(){
                        return $that.prop(&quot;checked&quot;);
                    });
                });

                //Переход по клику в строке на форму редактирования объекта
                var that = this;
                $(&#x27;.umi-table&#x27;).on(&#x27;click&#x27;, &#x27;.umi-table-tr&#x27;, function(){
                    var objectId = $(this).data(&#x27;object-id&#x27;);
                    that.get(&#x27;controller&#x27;).transitionToRoute(&#x27;context&#x27;, objectId);
                });

                      //Удаление записи
//                    //TODO После вынесения столбца с кнопками удаления в отдельную колонку, изменить селектор на .umi-table-control-content-right
//                    $(&#x27;.umi-table-control-content-right&#x27;).on(&#x27;click&#x27;, &#x27;.icon-delete&#x27;, function(){
//                        console.log(&#x27;remove button&#x27;);
//                        var objectId = $(this).data(&#x27;object-id&#x27;);
//                        var object = that.get(&#x27;controller&#x27;).get(&#x27;content&#x27;).removeObject();
//                        console.log(object);
//                    });
//
                      //Определение выделенных объектов
//                    $(&#x27;.umi-table-left&#x27;).on(&#x27;click&#x27;, &#x27;input[type=&quot;checkbox&quot;]&#x27;, function(){
//                        var objectId = $(this).parent().parent().parent().data(&#x27;object-id&#x27;);
//                        console.log(objectId);
//                    });

                //Подсветка выделенной строки
                //					$(&#x27;.umi-table-left&#x27;).find(&#x27;input&#x27;).click(function(){
                //						var backgroundColor;
                //						var elemIndex = $(this).parent().parent().parent().index(&#x27;.umi-table-left tr&#x27;);
                //						if($(this).prop(&quot;checked&quot;)){
                //							backgroundColor = $(this).parent().parent().css(&quot;background&quot;);
                ////                        $(this).parent().parent().css({&quot;background&quot;:&quot;#A4DCF7&quot;, &quot;border-bottom&quot;:&quot;1px solid #E3E4E5&quot;, &quot;height&quot;:&quot;30px&quot;});
                //							$(&#x27;.umi-table tr&#x27;).eq(elemIndex).find(&#x27;td&#x27;).css({&quot;background&quot;:&quot;#A4DCF7&quot;, &quot;border-bottom&quot;:&quot;1px solid #E3E4E5&quot;});
                //							$(&#x27;.umi-table tr&#x27;).eq(elemIndex).find(&#x27;div&#x27;).css({&quot;height&quot;:&quot;33px&quot;});
                //						}else{
                ////                        $(this).parent().parent().css({&quot;background&quot;:&quot;none&quot;, &quot;border-bottom&quot;:&quot;none&quot;, &quot;height&quot;:&quot;32px&quot;});
                //							$(&#x27;.umi-table tr&#x27;).eq(elemIndex).find(&#x27;td&#x27;).css({&quot;background&quot;:&quot;none&quot;, &quot;border-bottom&quot;:&quot;none&quot;});
                //							$(&#x27;.umi-table tr&#x27;).eq(elemIndex).find(&#x27;div&#x27;).css({&quot;height&quot;:&quot;34px&quot;});
                //						}
                //					});
            }
        });


        UMI.TableCellView = Ember.View.extend({
            classNames: [&#x27;umi-table-cell-div&#x27;],
//            edit: false,
//            editToggle: function(){
//                this.set(&#x27;edit&#x27;, !this.get(&#x27;edit&#x27;));
//            },
            template: function(){
                var meta = this.get(&#x27;meta&#x27;);
                var object = this.get(&#x27;object&#x27;);
                var template;
                //					if(editMode){
                //						switch(meta.type){
                //							case &#x27;string&#x27;:
                //								template = Ember.Handlebars.compile(&#x27;{{input type=&quot;text&quot; value=object.&#x27; + meta.name + &#x27;}}&#x27;);
                //								break;
                //							case &#x27;text&#x27;:
                //								template = Ember.Handlebars.compile(&#x27;{{textarea value=object.&#x27; + meta.name + &#x27;}}&#x27;);
                //								break;
                //							case &#x27;html&#x27;:
                //								template = Ember.Handlebars.compile(&#x27;{{textarea data-type=&quot;ckeditor&quot; value=object.&#x27; + meta.name + &#x27;}}&#x27;);
                //								break;
                //							case &#x27;date&#x27;:
                //								template = Ember.Handlebars.compile(&#x27;{{input type=&quot;date&quot; value=object.&#x27; + meta.name + &#x27;}}&#x27;);
                //								break;
                //							case &#x27;number&#x27;:
                //								template = Ember.Handlebars.compile(&#x27;{{input type=&quot;number&quot; value=object.&#x27; + meta.name + &#x27;}}&#x27;);
                //								break;
                //						}
                //
                //					}else{
//                template = Ember.Handlebars.compile(&#x27;&lt;div {{bind-attr class=&quot;:icon-inside-hover view.edit:hide&quot;}}&gt;&#x27; + object.get(meta.name) + &#x27;&lt;i class=&quot;icon icon-write&quot; {{action &quot;editToggle&quot; target=&quot;view&quot;}}&gt;&lt;/i&gt;&lt;/div&gt;{{input type=&quot;text&quot; value=object.&#x27; + meta.name +&#x27; class=view.edit }}&#x27;);
                template = Ember.Handlebars.compile(object.get(meta.name) + &#x27;&amp;nbsp;&#x27;);
                //					}
                return template;
            }.property(&#x27;object&#x27;, &#x27;meta&#x27;)
        });
    };
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
