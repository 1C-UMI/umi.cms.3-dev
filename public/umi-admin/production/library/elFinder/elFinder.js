"use strict";window.elFinder=function(a,b){this.time("load");var c,d,e,f=this,a=$(a),g=$("<div/>").append(a.contents()),h=a.attr("style"),i=a.attr("id")||"",j="elfinder-"+(i||Math.random().toString().substr(2,7)),k="mousedown."+j,l="keydown."+j,m="keypress."+j,n=!0,o=!0,p="",q={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:!0,uploadMaxSize:0,tmb:!1},r={},s=[],t={},u={},v=[],w=[],x=[],y=new f.command(f),z="auto",A=400,B=$(document.createElement("audio")).hide().appendTo("body")[0],C=function(a){if(a.init)r={};else for(var b in r)r.hasOwnProperty(b)&&"directory"!=r[b].mime&&r[b].phash==p&&-1===$.inArray(b,w)&&delete r[b];p=a.cwd.hash,D(a.files),r[p]||D([a.cwd]),f.lastDir(p)},D=function(a){for(var b,c=a.length;c--;)if(b=a[c],b.name&&b.hash&&b.mime){if(!b.phash){var d="volume_"+b.name,e=f.i18n(d);d!=e&&(b.i18=e)}r[b.hash]=b}},E=function(a){var b=a.keyCode,c=!(!a.ctrlKey&&!a.metaKey);n&&($.each(u,function(d,e){e.type==a.type&&e.keyCode==b&&e.shiftKey==a.shiftKey&&e.ctrlKey==c&&e.altKey==a.altKey&&(a.preventDefault(),a.stopPropagation(),e.callback(a,f),f.debug("shortcut-exec",d+" : "+e.description))}),9!=b||$(a.target).is(":input")||a.preventDefault())},F=new Date;return this.api=null,this.newAPI=!1,this.oldAPI=!1,this.OS=-1!==navigator.userAgent.indexOf("Mac")?"mac":-1!==navigator.userAgent.indexOf("Win")?"win":"other",this.UA=function(){var a=!document.uniqueID&&!window.opera&&!window.sidebar&&window.localStorage&&"undefined"==typeof window.orientation;return{ltIE6:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.documentElement.style.maxHeight,ltIE7:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.querySelectorAll,ltIE8:"undefined"==typeof window.addEventListener&&"undefined"==typeof document.getElementsByClassName,IE:document.uniqueID,Firefox:window.sidebar,Opera:window.opera,Webkit:a,Chrome:a&&window.chrome,Safari:a&&!window.chrome,Mobile:"undefined"!=typeof window.orientation}}(),this.options=$.extend(!0,{},this._options,b||{}),b.ui&&(this.options.ui=b.ui),b.commands&&(this.options.commands=b.commands),b.uiOptions&&b.uiOptions.toolbar&&(this.options.uiOptions.toolbar=b.uiOptions.toolbar),$.extend(this.options.contextmenu,b.contextmenu),this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get",this.customData=$.isPlainObject(this.options.customData)?this.options.customData:{},this.customHeaders=$.isPlainObject(this.options.customHeaders)?this.options.customHeaders:{},this.xhrFields=$.isPlainObject(this.options.xhrFields)?this.options.xhrFields:{},this.id=i,this.uploadURL=b.urlUpload||b.url,this.namespace=j,this.lang=this.i18[this.options.lang]&&this.i18[this.options.lang].messages?this.options.lang:"en",e="en"==this.lang?this.i18.en:$.extend(!0,{},this.i18.en,this.i18[this.lang]),this.direction=e.direction,this.messages=e.messages,this.dateFormat=this.options.dateFormat||e.dateFormat,this.fancyFormat=this.options.fancyDateFormat||e.fancyDateFormat,this.today=new Date(F.getFullYear(),F.getMonth(),F.getDate()).getTime()/1e3,this.yesterday=this.today-86400,d=this.options.UTCDate?"UTC":"",this.getHours="get"+d+"Hours",this.getMinutes="get"+d+"Minutes",this.getSeconds="get"+d+"Seconds",this.getDate="get"+d+"Date",this.getDay="get"+d+"Day",this.getMonth="get"+d+"Month",this.getFullYear="get"+d+"FullYear",this.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+("rtl"==this.direction?"rtl":"ltr")+" "+this.options.cssClass,this.storage=function(){try{return"localStorage"in window&&null!==window.localStorage?f.localStorage:f.cookie}catch(a){return f.cookie}}(),this.viewType=this.storage("view")||this.options.defaultView||"icons",this.sortType=this.storage("sortType")||this.options.sortType||"name",this.sortOrder=this.storage("sortOrder")||this.options.sortOrder||"asc",this.sortStickFolders=this.storage("sortStickFolders"),this.sortStickFolders=null===this.sortStickFolders?!!this.options.sortStickFolders:!!this.sortStickFolders,this.sortRules=$.extend(!0,{},this._sortRules,this.options.sortsRules),$.each(this.sortRules,function(a,b){"function"!=typeof b&&delete f.sortRules[a]}),this.compare=$.proxy(this.compare,this),this.notifyDelay=this.options.notifyDelay>0?parseInt(this.options.notifyDelay):500,this.draggable={appendTo:"body",addClasses:!0,delay:30,distance:8,revert:!0,refreshPositions:!0,cursor:"move",cursorAt:{left:50,top:47},drag:function(a,b){b.helper.data("locked")||b.helper.toggleClass("elfinder-drag-helper-plus",a.shiftKey||a.ctrlKey||a.metaKey)},start:function(a,b){var c,d,e=$.map(b.helper.data("files")||[],function(a){return a||null});for(c=e.length;c--;)if(d=e[c],r[d].locked){b.helper.addClass("elfinder-drag-helper-plus").data("locked",!0);break}},stop:function(){f.trigger("focus").trigger("dragstop")},helper:function(a){var b,c,d=this.id?$(this):$(this).parents("[id]:first"),e=$('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-plus"/></div>'),g=function(a){return'<div class="elfinder-cwd-icon '+f.mime2class(a)+' ui-corner-all"/>'};return f.trigger("dragstart",{target:d[0],originalEvent:a}),b=d.is("."+f.res("class","cwdfile"))?f.selected():[f.navId2Hash(d.attr("id"))],e.append(g(r[b[0]].mime)).data("files",b).data("locked",!1),(c=b.length)>1&&e.append(g(r[b[c-1]].mime)+'<span class="elfinder-drag-num">'+c+"</span>"),e}},this.droppable={tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file",hoverClass:this.res("class","adroppable"),drop:function(a,b){var c,d,e,g=$(this),h=$.map(b.helper.data("files")||[],function(a){return a||null}),i=[],j="class";for(g.is("."+f.res(j,"cwd"))?d=p:g.is("."+f.res(j,"cwdfile"))?d=g.attr("id"):g.is("."+f.res(j,"navdir"))&&(d=f.navId2Hash(g.attr("id"))),c=h.length;c--;)e=h[c],e!=d&&r[e].phash!=d&&i.push(e);i.length&&(b.helper.hide(),f.clipboard(i,!(a.ctrlKey||a.shiftKey||a.metaKey||b.helper.data("locked"))),f.exec("paste",d),f.trigger("drop",{files:h}))}},this.enabled=function(){return a.is(":visible")&&n},this.visible=function(){return a.is(":visible")},this.root=function(a){for(var b,c=r[a||p];c&&c.phash;)c=r[c.phash];if(c)return c.hash;for(;b in r&&r.hasOwnProperty(b);)if(c=r[b],!c.phash&&"directory"==!c.mime&&c.read)return c.hash;return""},this.cwd=function(){return r[p]||{}},this.option=function(a){return q[a]||""},this.file=function(a){return r[a]},this.files=function(){return $.extend(!0,{},r)},this.parents=function(a){for(var b,c=[];b=this.file(a);)c.unshift(b.hash),a=b.phash;return c},this.path2array=function(a,b){for(var c,d=[];a&&(c=r[a])&&c.hash;)d.unshift(b&&c.i18?c.i18:c.name),a=c.phash;return d},this.path=function(a,b){return r[a]&&r[a].path?r[a].path:this.path2array(a,b).join(q.separator)},this.url=function(a){var b=r[a];if(!b||!b.read)return"";if(b.url)return b.url;if(q.url)return q.url+$.map(this.path2array(a),function(a){return encodeURIComponent(a)}).slice(1).join("/");var c=$.extend({},this.customData,{cmd:"file",target:b.hash});return this.oldAPI&&(c.cmd="open",c.current=b.phash),this.options.url+(-1===this.options.url.indexOf("?")?"?":"&")+$.param(c,!0)},this.tmb=function(a){var b=r[a],c=b&&b.tmb&&1!=b.tmb?q.tmbUrl+b.tmb:"";return c&&(this.UA.Opera||this.UA.IE)&&(c+="?_="+(new Date).getTime()),c},this.selected=function(){return s.slice(0)},this.selectedFiles=function(){return $.map(s,function(a){return r[a]?$.extend({},r[a]):null})},this.fileByName=function(a,b){var c;for(c in r)if(r.hasOwnProperty(c)&&r[c].phash==b&&r[c].name==a)return r[c]},this.validResponse=function(a,b){return b.error||this.rules[this.rules[a]?a:"defaults"](b)},this.returnBytes=function(a){if("-1"==a&&(a=0),a){a=a.replace(/b$/i,"");var b=a.charAt(a.length-1).toLowerCase();a=a.replace(/[gmk]$/i,""),"g"==b?a=1024*a*1024*1024:"m"==b?a=1024*a*1024:"k"==b&&(a=1024*a)}return a},this.request=function(a){var b,c,d,e=this,f=this.options,g=$.Deferred(),h=$.extend({},f.customData,{mimes:f.onlyMimes},a.data||a),i=h.cmd,j=!(a.preventDefault||a.preventFail),k=!(a.preventDefault||a.preventDone),l=$.extend({},a.notify),m=!!a.raw,n=a.syncOnFail,a=$.extend({url:f.url,async:!0,type:this.requestType,dataType:"json",cache:!1,data:h,headers:this.customHeaders,xhrFields:this.xhrFields},a.options||{}),o=function(a){a.warning&&e.error(a.warning),"open"==i&&C($.extend(!0,{},a)),a.removed&&a.removed.length&&e.remove(a),a.added&&a.added.length&&e.add(a),a.changed&&a.changed.length&&e.change(a),e.trigger(i,a),a.sync&&e.sync()},p=function(a,b){var c;switch(b){case"abort":c=a.quiet?"":["errConnect","errAbort"];break;case"timeout":c=["errConnect","errTimeout"];break;case"parsererror":c=["errResponse","errDataNotJSON"];break;default:c=403==a.status?["errConnect","errAccess"]:404==a.status?["errConnect","errNotFound"]:"errConnect"}g.reject(c,a,b)},r=function(a){return m?g.resolve(a):a?$.isPlainObject(a)?a.error?g.reject(a.error,c):e.validResponse(i,a)?(a=e.normalize(a),e.api||(e.api=a.api||1,e.newAPI=e.api>=2,e.oldAPI=!e.newAPI),a.options&&(q=$.extend({},q,a.options)),a.netDrivers&&(e.netDrivers=a.netDrivers),"open"==i&&h.init&&(e.uplMaxSize=e.returnBytes(a.uplMaxSize),e.uplMaxFile=a.uplMaxFile?parseInt(a.uplMaxFile):20),g.resolve(a),void(a.debug&&e.debug("backend-debug",a.debug))):g.reject("errResponse",c):g.reject(["errResponse","errDataNotJSON"],c):g.reject(["errResponse","errDataEmpty"],c)};if(k&&g.done(o),g.fail(function(a){a&&(j?e.error(a):e.debug("error",e.i18n(a)))}),!i)return g.reject("errCmdReq");if(n&&g.fail(function(a){a&&e.sync()}),l.type&&l.cnt&&(b=setTimeout(function(){e.notify(l),g.always(function(){l.cnt=-(parseInt(l.cnt)||0),e.notify(l)})},e.notifyDelay),g.always(function(){clearTimeout(b)})),"open"==i)for(;d=x.pop();)"pending"==d.state()&&(d.quiet=!0,d.abort());return delete a.preventFail,c=this.transport.send(a).fail(p).done(r),"open"==i&&(x.unshift(c),g.always(function(){var a=$.inArray(c,x);-1!==a&&x.splice(a,1)})),g},this.diff=function(a){var b={},c=[],d=[],e=[],f=function(a){for(var b=e.length;b--;)if(e[b].hash==a)return!0};return $.each(a,function(a,c){b[c.hash]=c}),$.each(r,function(a){!b[a]&&d.push(a)}),$.each(b,function(a,b){var d=r[a];d?$.each(b,function(a){return b[a]!=d[a]?(e.push(b),!1):void 0}):c.push(b)}),$.each(d,function(a,c){var g=r[c],h=g.phash;h&&"directory"==g.mime&&-1===$.inArray(h,d)&&b[h]&&!f(h)&&e.push(b[h])}),{added:c,removed:d,changed:e}},this.sync=function(){var a=this,b=$.Deferred().done(function(){a.trigger("sync")}),c={data:{cmd:"open",init:1,target:p,tree:this.ui.tree?1:0},preventDefault:!0},d={data:{cmd:"tree",target:p==this.root()?p:this.file(p).phash},preventDefault:!0};return $.when(this.request(c),this.request(d)).fail(function(c){b.reject(c),c&&a.request({data:{cmd:"open",target:a.lastDir(""),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:!0},preventDefault:!0})}).done(function(c,d){var e=a.diff(c.files.concat(d&&d.tree?d.tree:[]));return e.added.push(c.cwd),e.removed.length&&a.remove(e),e.added.length&&a.add(e),e.changed.length&&a.change(e),b.resolve(e)}),b},this.upload=function(a){return this.transport.upload(a,this)},this.bind=function(a,b){var c;if("function"==typeof b)for(a=(""+a).toLowerCase().split(/\s+/),c=0;c<a.length;c++)void 0===t[a[c]]&&(t[a[c]]=[]),t[a[c]].push(b);return this},this.unbind=function(a,b){var c=t[(""+a).toLowerCase()]||[],d=c.indexOf(b);return d>-1&&c.splice(d,1),b=null,this},this.trigger=function(a,b){var c,a=a.toLowerCase(),d=t[a]||[];if(this.debug("event-"+a,b),d.length)for(a=$.Event(a),c=0;c<d.length;c++){a.data=$.extend(!0,{},b);try{if(d[c](a,this)===!1||a.isDefaultPrevented()){this.debug("event-stoped",a.type);break}}catch(e){window.console&&window.console.log&&window.console.log(e)}}return this},this.shortcut=function(a){var b,c,d,e,f;if(this.options.allowShortcuts&&a.pattern&&$.isFunction(a.callback))for(b=a.pattern.toUpperCase().split(/\s+/),e=0;e<b.length;e++)c=b[e],f=c.split("+"),d=1==(d=f.pop()).length?d>0?d:d.charCodeAt(0):$.ui.keyCode[d],d&&!u[c]&&(u[c]={keyCode:d,altKey:-1!=$.inArray("ALT",f),ctrlKey:-1!=$.inArray("CTRL",f),shiftKey:-1!=$.inArray("SHIFT",f),type:a.type||"keydown",callback:a.callback,description:a.description,pattern:c});return this},this.shortcuts=function(){var a=[];return $.each(u,function(b,c){a.push([c.pattern,f.i18n(c.description)])}),a},this.clipboard=function(a,b){var c=function(){return $.map(v,function(a){return a.hash})};return void 0!==a&&(v.length&&this.trigger("unlockfiles",{files:c()}),w=[],v=$.map(a||[],function(a){var c=r[a];return c?(w.push(a),{hash:a,phash:c.phash,name:c.name,mime:c.mime,read:c.read,locked:c.locked,cut:!!b}):null}),this.trigger("changeclipboard",{clipboard:v.slice(0,v.length)}),b&&this.trigger("lockfiles",{files:c()})),v.slice(0,v.length)},this.isCommandEnabled=function(a){return this._commands[a]?-1===$.inArray(a,q.disabled):!1},this.exec=function(a,b,c){return this._commands[a]&&this.isCommandEnabled(a)?this._commands[a].exec(b,c):$.Deferred().reject("No such command")},this.dialog=function(b,c){return $("<div/>").append(b).appendTo(a).elfinderdialog(c)},this.getUI=function(b){return this.ui[b]||a},this.command=function(a){return void 0===a?this._commands:this._commands[a]},this.resize=function(b,c){a.css("width",b).height(c).trigger("resize"),this.trigger("resize",{width:a.width(),height:a.height()})},this.restoreSize=function(){this.resize(z,A)},this.show=function(){a.show(),this.enable().trigger("show")},this.hide=function(){this.disable().trigger("hide"),a.hide()},this.destroy=function(){a&&a[0].elfinder&&(this.trigger("destroy").disable(),t={},u={},$(document).add(a).unbind("."+this.namespace),f.trigger=function(){},a.children().remove(),a.append(g.contents()).removeClass(this.cssClass).attr("style",h),a[0].elfinder=null,c&&clearInterval(c))},$.fn.selectable&&$.fn.draggable&&$.fn.droppable?a.length?this.options.url?($.extend($.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120}),this.dragUpload=!1,this.xhrUpload=("undefined"!=typeof XMLHttpRequestUpload||"undefined"!=typeof XMLHttpRequestEventTarget)&&"undefined"!=typeof File&&"undefined"!=typeof FormData,this.transport={},"object"==typeof this.options.transport&&(this.transport=this.options.transport,"function"==typeof this.transport.init&&this.transport.init(this)),"function"!=typeof this.transport.send&&(this.transport.send=function(a){return $.ajax(a)}),"iframe"==this.transport.upload?this.transport.upload=$.proxy(this.uploads.iframe,this):"function"==typeof this.transport.upload?this.dragUpload=!!this.options.dragUploadAllow:this.xhrUpload&&this.options.dragUploadAllow?(this.transport.upload=$.proxy(this.uploads.xhr,this),this.dragUpload=!0):this.transport.upload=$.proxy(this.uploads.iframe,this),this.error=function(){var a=arguments[0];return 1==arguments.length&&"function"==typeof a?f.bind("error",a):f.trigger("error",{error:a})},$.each(["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","dragstart","dragstop","search","searchend","viewchange"],function(a,b){f[b]=function(){var a=arguments[0];return 1==arguments.length&&"function"==typeof a?f.bind(b,a):f.trigger(b,$.isPlainObject(a)?a:{})}}),this.enable(function(){!n&&f.visible()&&f.ui.overlay.is(":hidden")&&(n=!0,$("texarea:focus,input:focus,button").blur(),a.removeClass("elfinder-disabled"))}).disable(function(){o=n,n=!1,a.addClass("elfinder-disabled")}).open(function(){s=[]}).select(function(a){s=$.map(a.data.selected||a.data.value||[],function(a){return r[a]?a:null})}).error(function(a){var b={cssClass:"elfinder-dialog-error",title:f.i18n(f.i18n("error")),resizable:!1,destroyOnClose:!0,buttons:{}};b.buttons[f.i18n(f.i18n("btnClose"))]=function(){$(this).elfinderdialog("close")},f.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+f.i18n(a.data.error),b)}).bind("tree parents",function(a){D(a.data.tree||[])}).bind("tmb",function(a){$.each(a.data.images||[],function(a,b){r[a]&&(r[a].tmb=b)})}).add(function(a){D(a.data.added||[])}).change(function(a){$.each(a.data.changed||[],function(a,b){var c=b.hash;(r[c].width&&!b.width||r[c].height&&!b.height)&&(r[c].width=void 0,r[c].height=void 0),r[c]=r[c]?$.extend(r[c],b):b})}).remove(function(a){for(var b=a.data.removed||[],c=b.length,d=function(a){var b=r[a];b&&("directory"==b.mime&&b.dirs&&$.each(r,function(b,c){c.phash==a&&d(b)}),delete r[a])};c--;)d(b[c])}).bind("search",function(a){D(a.data.files)}).bind("rm",function(){var a=B.canPlayType&&B.canPlayType('audio/wav; codecs="1"');a&&""!=a&&"no"!=a&&$(B).html('<source src="./sounds/rm.wav" type="audio/wav">')[0].play()}),$.each(this.options.handlers,function(a,b){f.bind(a,b)}),this.history=new this.history(this),"function"==typeof this.options.getFileCallback&&this.commands.getfile&&(this.bind("dblclick",function(a){a.preventDefault(),f.exec("getfile").fail(function(){f.exec("open")})}),this.shortcut({pattern:"enter",description:this.i18n("cmdgetfile"),callback:function(){f.exec("getfile").fail(function(){f.exec("mac"==f.OS?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:this.i18n("mac"==this.OS?"cmdrename":"cmdopen"),callback:function(){f.exec("mac"==f.OS?"rename":"open")}})),this._commands={},$.isArray(this.options.commands)||(this.options.commands=[]),$.each(["open","reload","back","forward","up","home","info","quicklook","getfile","help"],function(a,b){-1===$.inArray(b,f.options.commands)&&f.options.commands.push(b)}),$.each(this.options.commands,function(a,b){var c=f.commands[b];$.isFunction(c)&&!f._commands[b]&&(c.prototype=y,f._commands[b]=new c,f._commands[b].setup(b,f.options.commandsOptions[b]||{}))}),a.addClass(this.cssClass).bind(k,function(){!n&&f.enable()}),this.ui={workzone:$("<div/>").appendTo(a).elfinderworkzone(this),navbar:$("<div/>").appendTo(a).elfindernavbar(this,this.options.uiOptions.navbar||{}),contextmenu:$("<div/>").appendTo(a).elfindercontextmenu(this),overlay:$("<div/>").appendTo(a).elfinderoverlay({show:function(){f.disable()},hide:function(){o&&f.enable()}}),cwd:$("<div/>").appendTo(a).elfindercwd(this,this.options.uiOptions.cwd||{}),notify:this.dialog("",{cssClass:"elfinder-dialog-notify",position:{top:"12px",right:"12px"},resizable:!1,autoOpen:!1,title:"&nbsp;",width:280}),statusbar:$('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').hide().appendTo(a)},$.each(this.options.ui||[],function(b,c){var d="elfinder"+c,e=f.options.uiOptions[c]||{};!f.ui[c]&&$.fn[d]&&(f.ui[c]=$("<"+(e.tag||"div")+"/>").appendTo(a)[d](f,e))}),a[0].elfinder=this,this.options.resizable&&$.fn.resizable&&a.resizable({handles:"se",minWidth:300,minHeight:200}),this.options.width&&(z=this.options.width),this.options.height&&(A=parseInt(this.options.height)),f.resize(z,A),$(document).bind("click."+this.namespace,function(b){n&&!$(b.target).closest(a).length&&f.disable()}).bind(l+" "+m,E),f.options.useBrowserHistory&&$(window).on("popstate",function(a){var b=a.originalEvent.state&&a.originalEvent.state.thash;b&&!$.isEmptyObject(f.files())&&f.request({data:{cmd:"open",target:b,onhistory:1},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0})}),this.trigger("init").request({data:{cmd:"open",target:f.startDir(),init:1,tree:this.ui.tree?1:0},preventDone:!0,notify:{type:"open",cnt:1,hideCnt:!0},freeze:!0}).fail(function(){f.trigger("fail").disable().lastDir(""),t={},u={},$(document).add(a).unbind("."+this.namespace),f.trigger=function(){}}).done(function(a){f.load().debug("api",f.api),a=$.extend(!0,{},a),C(a),f.trigger("open",a)}),void this.one("load",function(){a.trigger("resize"),f.options.sync>1e3&&(c=setInterval(function(){f.sync()},f.options.sync))})):alert(this.i18n("errURL")):alert(this.i18n("errNode")):alert(this.i18n("errJqui"))},elFinder.prototype={res:function(a,b){return this.resources[a]&&this.resources[a][b]},i18:{en:{translator:"",language:"English",direction:"ltr",dateFormat:"d.m.Y H:i",fancyDateFormat:"$1 H:i",messages:{}},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},kinds:{unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO","application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},rules:{defaults:function(a){return!a||a.added&&!$.isArray(a.added)||a.removed&&!$.isArray(a.removed)||a.changed&&!$.isArray(a.changed)?!1:!0},open:function(a){return a&&a.cwd&&a.files&&$.isPlainObject(a.cwd)&&$.isArray(a.files)},tree:function(a){return a&&a.tree&&$.isArray(a.tree)},parents:function(a){return a&&a.tree&&$.isArray(a.tree)},tmb:function(a){return a&&a.images&&($.isPlainObject(a.images)||$.isArray(a.images))},upload:function(a){return a&&($.isPlainObject(a.added)||$.isArray(a.added))},search:function(a){return a&&a.files&&$.isArray(a.files)}},commands:{},parseUploadData:function(a){var b;if(!$.trim(a))return{error:["errResponse","errDataEmpty"]};try{b=$.parseJSON(a)}catch(c){return{error:["errResponse","errDataNotJSON"]}}return this.validResponse("upload",b)?(b=this.normalize(b),b.removed=$.map(b.added||[],function(a){return a.hash}),b):{error:["errResponse"]}},iframeCnt:0,uploads:{checkFile:function(a,b){if(a.checked||"files"==a.type)return a.files;if("data"==a.type){var c=$.Deferred(),d=[],e=[],f=[],g=[],h=0,i=function(a){var c=function(a){return Array.prototype.slice.call(a||[])},j=function(a){var b=$.Deferred();return"undefined"==typeof a?b.reject("empty"):a.isFile?a.file(function(a){b.resolve(a)},function(){b.reject()}):b.reject("dirctory"),b.promise()};a.readEntries(function(k){if(k.length)g=g.concat(c(k)),i(a);else{var l=g.length-1,m=function(a){j(g[a]).done(function(c){"win"==b.OS&&c.name.match(/^(?:desktop\.ini|thumbs\.db)$/i)||"mac"==b.OS&&c.name.match(/^\.ds_store$/i)||(e.push(g[a].fullPath),d.push(c))}).fail(function(b){"dirctory"==b&&f.push(g[a])}).always(function(){h--,l>a&&(h++,m(++a))})};h++,m(0),h--}})},j=function(b,c){var j,k;g=[];for(var l=b.length,m=0;l>m;m++)k=c?b[m]:b[m].getAsEntry?b[m].getAsEntry():b[m].webkitGetAsEntry(),k&&(k.isFile?(e.push(""),d.push(a.files.items[m].getAsFile())):k.isDirectory&&(h>0?f.push(k):(h=0,j=k.createReader(),h++,i(j))))};return j(a.files.items),setTimeout(function q(){h>0?setTimeout(q,10):f.length>0?(j([f.shift()],!0),setTimeout(q,10)):c.resolve([d,e])},10),c.promise()}var k,l=[],m=a.files[0];if("html"==a.type){k=/<img[^>]+src=["']?([^"'> ]+)/gi;for(var n,o=[],p="";o=k.exec(m);)p=o[1].replace(/&amp;/g,"&"),p.match(/^http|data:/)&&-1==$.inArray(p,l)&&l.push(p);n=m.match(/<\/a>/i),n&&1==n.length&&(k=/<a[^>]+href=["']?([^"'> ]+)((?:.|\s)+)<\/a>/i,(o=k.exec(m))&&(o[2].match(/<img/i)||(p=o[1].replace(/&amp;/g,"&"),p.match(/^http/)&&-1==$.inArray(p,l)&&l.push(p))))}else for(k=/(http[^<>"{}|\\^\[\]`\s]+)/gi;o=k.exec(m);)p=o[1].replace(/&amp;/g,"&"),-1==$.inArray(p,l)&&l.push(p);return l},iframe:function(a,b){var c,d,e,f,g=b?b:this,h=a.input?a.input:!1,i=h?!1:g.uploads.checkFile(a,g),j=$.Deferred().fail(function(a){a&&g.error(a)}).done(function(a){a.warning&&g.error(a.warning),a.removed&&g.remove(a),a.added&&g.add(a),a.changed&&g.change(a),g.trigger("upload",a),a.sync&&g.sync()}),k="iframe-"+g.namespace+ ++g.iframeCnt,l=$('<form action="'+g.uploadURL+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+k+'" style="display:none"><input type="hidden" name="cmd" value="upload" /></form>'),m=this.UA.IE,n=function(){f&&clearTimeout(f),e&&clearTimeout(e),d&&g.notify({type:"upload",cnt:-c}),setTimeout(function(){m&&$('<iframe src="javascript:false;"/>').appendTo(l),l.remove(),o.remove()},100)},o=$('<iframe src="'+(m?"javascript:false;":"about:blank")+'" name="'+k+'" style="position:absolute;left:-1000px;top:-1000px" />').bind("load",function(){o.unbind("load").bind("load",function(){var a=g.parseUploadData(o.contents().text());n(),a.error?j.reject(a.error):j.resolve(a)}),e=setTimeout(function(){d=!0,g.notify({type:"upload",cnt:c})},g.options.notifyDelay),g.options.iframeTimeout>0&&(f=setTimeout(function(){n(),j.reject([errors.connect,errors.timeout])},g.options.iframeTimeout)),l.submit()});if(i&&i.length)$.each(i,function(a,b){l.append('<input type="hidden" name="upload[]" value="'+b+'"/>')}),c=1;else{if(!(h&&$(h).is(":file")&&$(h).val()))return j.reject();l.append(h),c=h.files?h.files.length:1}return l.append('<input type="hidden" name="'+(g.newAPI?"target":"current")+'" value="'+g.cwd().hash+'"/>').append('<input type="hidden" name="html" value="1"/>').append($(h).attr("name","upload[]")),$.each(g.options.onlyMimes||[],function(a,b){l.append('<input type="hidden" name="mimes[]" value="'+b+'"/>')}),$.each(g.options.customData,function(a,b){l.append('<input type="hidden" name="'+a+'" value="'+b+'"/>')}),l.appendTo("body"),o.appendTo("body"),j},xhr:function(a,b){var c,d,e=b?b:this,f=$.Deferred().fail(function(a){a&&e.error(a)}).done(function(a){a.warning&&e.error(a.warning),a.removed&&e.remove(a),a.added&&e.add(a),a.changed&&e.change(a),e.trigger("upload",a),a.sync&&e.sync()}).always(function(){c&&clearTimeout(c),!a.checked&&m&&e.notify({type:"upload",cnt:-k,progress:100*k})}),g=new XMLHttpRequest,h=new FormData,i="data"==a.type,j=a.input?a.input.files:e.uploads.checkFile(a,e),k=a.checked&&i?j[0].length:j.length,l=5,m=!1,n=function(){return setTimeout(function(){m=!0,e.notify({type:"upload",cnt:k,progress:l*k})},e.options.notifyDelay)};if(!i&&!k)return f.reject();g.addEventListener("error",function(){f.reject("errConnect")},!1),g.addEventListener("abort",function(){f.reject(["errConnect","errAbort"])},!1),g.addEventListener("load",function(){var a,b=g.status;return b>500?f.reject("errResponse"):200!=b?f.reject("errConnect"):4!=g.readyState?f.reject(["errConnect","errTimeout"]):g.responseText?(a=e.parseUploadData(g.responseText),void(a.error?f.reject(a.error):f.resolve(a))):f.reject(["errResponse","errDataEmpty"])},!1),g.upload.addEventListener("progress",function(b){var d,f=l;b.lengthComputable&&(d=parseInt(100*b.loaded/b.total),!a.checked&&d>0&&!c&&(c=n()),d-f>4&&(l=d,(a.checked||m)&&e.notify({type:"upload",cnt:0,progress:(l-f)*k})))},!1);var o=function(d,j){var l,o=0,p=1,q=[],r=0,s=k;if(!a.checked){l=b.option("uploadMaxSize")?b.option("uploadMaxSize"):b.uplMaxSize;for(var t=0;t<d.length;t++)l&&d[t].size>=l?e.error(e.i18n("errUploadFile",d[t].name)+" "+e.i18n("errUploadFileSize")):((b.uplMaxSize&&o+d[t].size>=b.uplMaxSize||p>b.uplMaxFile)&&(o=0,p=1,r++),"undefined"==typeof q[r]&&(q[r]=[],i&&(q[r][0]=[],q[r][1]=[])),i?(q[r][0].push(d[t]),q[r][1].push(j[t])):q[r].push(d[t]),o+=d[t].size,p++);if(0==q.length)return a.checked=!0,!1;if(q.length>1){c=n();for(var t=0;t<q.length;t++)b.exec("upload",{type:a.type,files:q[t],checked:!0}).always(function(){if(m){var a=(i?this[0]:this).length;s-=a,1>s&&(c&&clearTimeout(c),e.notify({type:"upload",cnt:-k,progress:100*k}))}}.bind(q[t]));return!1}i?(d=q[0][0],j=q[0][1]):d=q[0]}g.open("POST",e.uploadURL,!0);try{var u=$.ajaxSettings.headers["X-Csrf-Token"];g.setRequestHeader("X-Csrf-Token",u)}catch(v){console.log("csrfToken for FileManager not available.")}return h.append("cmd","upload"),h.append(e.newAPI?"target":"current",e.cwd().hash),$.each(e.options.customData,function(a,b){h.append(a,b)}),$.each(e.options.onlyMimes,function(a,b){h.append("mimes["+a+"]",b)}),$.each(d,function(a,b){h.append("upload[]",b)}),i&&$.each(j,function(a,b){h.append("upload_path[]",b)}),g.onreadystatechange=function(){4==g.readyState&&0==g.status&&f.reject(["errConnect","errAbort"])},g.send(h),!0};return i?a.checked?o(j[0],j[1]):(d=setTimeout(function(){e.notify({type:"readdir",cnt:1,hideCnt:!0})},e.options.notifyDelay),j.done(function(a){d&&clearTimeout(d),e.notify({type:"readdir",cnt:-1}),k=a[0].length,o(a[0],a[1])
}).fail(function(){f.reject()})):o(j)||f.reject(),i||a.checked||this.UA.Safari&&a.files||(c=n()),f}},one:function(a,b){var c=this,d=$.proxy(b,function(a){return setTimeout(function(){c.unbind(a.type,d)},3),b.apply(this,arguments)});return this.bind(a,d)},localStorage:function(a,b){var c=window.localStorage;if(a="elfinder-"+a+this.id,null===b)return console.log("remove",a),c.removeItem(a);if(void 0!==b)try{c.setItem(a,b)}catch(d){c.clear(),c.setItem(a,b)}return c.getItem(a)},cookie:function(a,b){var c,d,e,f;if(a="elfinder-"+a+this.id,void 0===b){if(document.cookie&&""!=document.cookie)for(e=document.cookie.split(";"),a+="=",f=0;f<e.length;f++)if(e[f]=$.trim(e[f]),e[f].substring(0,a.length)==a)return decodeURIComponent(e[f].substring(a.length));return""}return d=$.extend({},this.options.cookie),null===b&&(b="",d.expires=-1),"number"==typeof d.expires&&(c=new Date,c.setTime(c.getTime()+864e5*d.expires),d.expires=c),document.cookie=a+"="+encodeURIComponent(b)+"; expires="+d.expires.toUTCString()+(d.path?"; path="+d.path:"")+(d.domain?"; domain="+d.domain:"")+(d.secure?"; secure":""),b},startDir:function(){var a=window.location.hash;return a&&a.match(/^#elf_/)?a.replace(/^#elf_/,""):this.lastDir()},lastDir:function(a){return this.options.rememberLastDir?this.storage("lastdir",a):""},_node:$("<span/>"),escape:function(a){return this._node.text(a).html()},normalize:function(a){var b=function(a){return a&&a.hash&&a.name&&a.mime?("application/x-empty"==a.mime&&(a.mime="text/plain"),a):null};return a.files&&(a.files=$.map(a.files,b)),a.tree&&(a.tree=$.map(a.tree,b)),a.added&&(a.added=$.map(a.added,b)),a.changed&&(a.changed=$.map(a.changed,b)),a.api&&(a.init=!0),a},setSort:function(a,b,c){this.storage("sortType",this.sortType=this.sortRules[a]?a:"name"),this.storage("sortOrder",this.sortOrder=/asc|desc/.test(b)?b:"asc"),this.storage("sortStickFolders",(this.sortStickFolders=!!c)?1:""),this.trigger("sortchange")},_sortRules:{name:function(a,b){return a.name.toLowerCase().localeCompare(b.name.toLowerCase())},size:function(a,b){var c=parseInt(a.size)||0,d=parseInt(b.size)||0;return c==d?0:c>d?1:-1},kind:function(a,b){return a.mime.localeCompare(b.mime)},date:function(a,b){var c=a.ts||a.date,d=b.ts||b.date;return c==d?0:c>d?1:-1}},compare:function(a,b){var c,d=this,e=d.sortType,f="asc"==d.sortOrder,g=d.sortStickFolders,h=d.sortRules,i=h[e],j="directory"==a.mime,k="directory"==b.mime;if(g){if(j&&!k)return-1;if(!j&&k)return 1}return c=f?i(a,b):i(b,a),"name"!=e&&0==c?c=f?h.name(a,b):h.name(b,a):c},sortFiles:function(a){return a.sort(this.compare)},notify:function(a){var b,c,d,e=a.type,f=this.i18n(this.messages["ntf"+e]?"ntf"+e:"ntfsmth"),g=this.ui.notify,h=g.children(".elfinder-notify-"+e),i='<div class="elfinder-notify elfinder-notify-{type}"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/></div></div>',j=a.cnt,k=a.progress>=0?a.progress:0;return e?(h.length||(h=$(i.replace(/\{type\}/g,e).replace(/\{msg\}/g,f)).appendTo(g).data("cnt",0),k&&h.data({progress:0,total:0})),b=j+parseInt(h.data("cnt")),b>0?(!a.hideCnt&&h.children(".elfinder-notify-cnt").text("("+b+")"),g.is(":hidden")&&g.elfinderdialog("open"),h.data("cnt",b),k&&(c=h.data("total"))>=0&&(d=h.data("progress"))>=0&&(c=j+parseInt(h.data("total")),d=k+d,k=parseInt(d/c),h.data({progress:d,total:c}),g.find(".elfinder-notify-progress").animate({width:(100>k?k:100)+"%"},20))):(h.remove(),!g.children().length&&g.elfinderdialog("close")),this):this},confirm:function(a){var b,c=!1,d={cssClass:"elfinder-dialog-confirm",modal:!0,resizable:!1,title:this.i18n(a.title||"confirmReq"),buttons:{},close:function(){!c&&a.cancel.callback(),$(this).elfinderdialog("destroy")}},e=this.i18n("apllyAll");return a.reject&&(d.buttons[this.i18n(a.reject.label)]=function(){a.reject.callback(!(!b||!b.prop("checked"))),c=!0,$(this).elfinderdialog("close")}),d.buttons[this.i18n(a.accept.label)]=function(){a.accept.callback(!(!b||!b.prop("checked"))),c=!0,$(this).elfinderdialog("close")},d.buttons[this.i18n(a.cancel.label)]=function(){$(this).elfinderdialog("close")},a.all&&(a.reject&&(d.width=370),d.create=function(){b=$('<input type="checkbox" />'),$(this).next().children().before($("<label>"+e+"</label>").prepend(b))},d.open=function(){var a=$(this).next(),b=parseInt(a.children(":first").outerWidth()+a.children(":last").outerWidth());b>parseInt(a.width())&&$(this).closest(".elfinder-dialog").width(b+30)}),this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>'+this.i18n(a.text),d)},uniqueName:function(a,b){var c,d,e=0,f="";if(a=this.i18n(a),b=b||this.cwd().hash,-1!=(c=a.indexOf(".txt"))&&(f=".txt",a=a.substr(0,c)),d=a+f,!this.fileByName(d,b))return d;for(;1e4>e;)if(d=a+" "+ ++e+f,!this.fileByName(d,b))return d;return a+Math.random()+f},i18n:function(){var a,b,c,d=this,e=this.messages,f=[],g=[],h=function(a){var b;return 0===a.indexOf("#")&&(b=d.file(a.substr(1)))?b.name:a};for(a=0;a<arguments.length;a++)if(c=arguments[a],"string"==typeof c)f.push(h(c));else if($.isArray(c))for(b=0;b<c.length;b++)"string"==typeof c[b]&&f.push(h(c[b]));for(a=0;a<f.length;a++)-1===$.inArray(a,g)&&(c=f[a],c=e[c]||c,c=c.replace(/\$(\d+)/g,function(b,c){return c=a+parseInt(c),c>0&&f[c]&&g.push(c),f[c]||""}),f[a]=c);return $.map(f,function(a,b){return-1===$.inArray(b,g)?a:null}).join("<br>")},mime2class:function(a){var b="elfinder-cwd-icon-";return a=a.split("/"),b+a[0]+("image"!=a[0]&&a[1]?" "+b+a[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(a){var b,c="object"==typeof a?a.mime:a;return b=a.alias?"Alias":this.kinds[c]?this.kinds[c]:0===c.indexOf("text")?"Text":0===c.indexOf("image")?"Image":0===c.indexOf("audio")?"Audio":0===c.indexOf("video")?"Video":0===c.indexOf("application")?"App":c,this.messages["kind"+b]?this.i18n("kind"+b):c;var c,b},formatDate:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=this,b=b||a.ts,o=n.i18;return n.options.clientFormatDate&&b>0?(c=new Date(1e3*b),j=c[n.getHours](),k=j>12?j-12:j,l=c[n.getMinutes](),m=c[n.getSeconds](),f=c[n.getDate](),g=c[n.getDay](),h=c[n.getMonth]()+1,i=c[n.getFullYear](),d=b>=this.yesterday?this.fancyFormat:this.dateFormat,e=d.replace(/[a-z]/gi,function(a){switch(a){case"d":return f>9?f:"0"+f;case"j":return f;case"D":return n.i18n(o.daysShort[g]);case"l":return n.i18n(o.days[g]);case"m":return h>9?h:"0"+h;case"n":return h;case"M":return n.i18n(o.monthsShort[h-1]);case"F":return n.i18n(o.months[h-1]);case"Y":return i;case"y":return(""+i).substr(2);case"H":return j>9?j:"0"+j;case"G":return j;case"g":return k;case"h":return k>9?k:"0"+k;case"a":return j>12?"pm":"am";case"A":return j>12?"PM":"AM";case"i":return l>9?l:"0"+l;case"s":return m>9?m:"0"+m}return a}),b>=this.yesterday?e.replace("$1",this.i18n(b>=this.today?"Today":"Yesterday")):e):a.date?a.date.replace(/([a-z]+)\s/i,function(a,b){return n.i18n(b)+" "}):n.i18n("dateUnknown")},perms2class:function(a){var b="";return a.read||a.write?a.read?a.write||(b="elfinder-ro"):b="elfinder-wo":b="elfinder-na",b},formatPermissions:function(a){var b=[];return a.read&&b.push(this.i18n("read")),a.write&&b.push(this.i18n("write")),b.length?b.join(" "+this.i18n("and")+" "):this.i18n("noaccess")},formatSize:function(a){var b=1,c="b";return"unknown"==a?this.i18n("unknown"):(a>1073741824?(b=1073741824,c="GB"):a>1048576?(b=1048576,c="MB"):a>1024&&(b=1024,c="KB"),a/=b,(a>0?b>=1048576?a.toFixed(2):Math.round(a):0)+" "+c)},navHash2Id:function(a){return"nav-"+a},navId2Hash:function(a){return"string"==typeof a?a.substr(4):!1},log:function(a){return window.console&&window.console.log&&window.console.log(a),this},debug:function(a,b){var c=this.options.debug;return("all"==c||c===!0||$.isArray(c)&&-1!=$.inArray(a,c))&&window.console&&window.console.log&&window.console.log("elfinder debug: ["+a+"] ["+this.id+"]",b),this},time:function(a){window.console&&window.console.time&&window.console.time(a)},timeEnd:function(a){window.console&&window.console.timeEnd&&window.console.timeEnd(a)}},$.fn.elfinder=function(a){return"instance"==a?this.getElFinder():this.each(function(){var b="string"==typeof a?a:"";switch(this.elfinder||new elFinder(this,"object"==typeof a?a:{}),b){case"close":case"hide":this.elfinder.hide();break;case"open":case"show":this.elfinder.show();break;case"destroy":this.elfinder.destroy()}})},$.fn.getElFinder=function(){var a;return this.each(function(){return this.elfinder?(a=this.elfinder,!1):void 0}),a},elFinder.prototype.resources={"class":{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search"},tpl:{perms:'<span class="elfinder-perms"/>',symlink:'<span class="elfinder-symlink"/>',navicon:'<span class="elfinder-nav-icon"/>',navspinner:'<span class="elfinder-navbar-spinner"/>',navdir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon"/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree"/></div>'},mimes:{text:["application/x-empty","application/javascript","application/xhtml+xml","audio/x-mp3-playlist","application/x-web-config","application/docbook+xml","application/x-php","application/x-perl","application/x-awk","application/x-config","application/x-csh","application/xml"]},mixin:{make:function(){var a=this.fm,b=this.name,c=a.getUI("cwd"),d=$.Deferred().fail(function(b){c.trigger("unselectall"),b&&a.error(b)}).always(function(){j.remove(),i.remove(),a.enable()}),e="tmp_"+parseInt(1e5*Math.random()),f=a.cwd().hash,g=new Date,h={hash:e,name:a.uniqueName(this.prefix),mime:this.mime,read:!0,write:!0,date:"Today "+g.getHours()+":"+g.getMinutes()},i=c.trigger("create."+a.namespace,h).find("#"+e),j=$('<input type="text"/>').keydown(function(a){a.stopImmediatePropagation(),a.keyCode==$.ui.keyCode.ESCAPE?d.reject():a.keyCode==$.ui.keyCode.ENTER&&j.blur()}).mousedown(function(a){a.stopPropagation()}).blur(function(){var c=$.trim(j.val()),g=j.parent();if(g.length){if(!c)return d.reject("errInvName");if(a.fileByName(c,f))return d.reject(["errExists",c]);g.html(a.escape(c)),a.lockfiles({files:[e]}),a.request({data:{cmd:b,name:c,target:f},notify:{type:b,cnt:1},preventFail:!0,syncOnFail:!0}).fail(function(a){d.reject(a)}).done(function(a){d.resolve(a)})}});return this.disabled()||!i.length?d.reject():(a.disable(),i.find(".elfinder-cwd-filename").empty("").append(j.val(h.name)),j.select().focus(),j[0].setSelectionRange&&j[0].setSelectionRange(0,h.name.replace(/\..+$/,"").length),d)}}},elFinder.prototype._options={url:"",requestType:"get",transport:{},urlUpload:"",dragUploadAllow:"auto",iframeTimeout:0,customData:{},handlers:{},customHeaders:{},xhrFields:{},lang:"en",cssClass:"",commands:["open","reload","home","up","back","forward","getfile","quicklook","download","rm","duplicate","rename","mkdir","mkfile","upload","copy","cut","paste","edit","extract","archive","search","info","view","help","resize","sort","netmount"],commandsOptions:{getfile:{onlyURL:!1,multiple:!1,folders:!1,oncomplete:""},upload:{ui:"uploadbutton"},quicklook:{autoplay:!0,jplayer:"extensions/jplayer"},edit:{mimes:[],editors:[]},info:{nullUrlDirLinkSelf:!0},help:{view:["about","shortcuts","help"]}},getFileCallback:null,defaultView:"icons",ui:["toolbar","tree","path","stat"],uiOptions:{toolbar:[["back","forward"],["netmount"],["mkdir","mkfile","upload"],["open","download","getfile"],["info"],["quicklook"],["copy","cut","paste"],["rm"],["duplicate","rename","edit","resize"],["extract","archive"],["search"],["view","sort"],["help"]],tree:{openRootOnLoad:!0,syncTree:!0},navbar:{minWidth:150,maxWidth:500},cwd:{oldSchool:!1}},onlyMimes:[],sortRules:{},sortType:"name",sortOrder:"asc",sortStickFolders:!0,clientFormatDate:!0,UTCDate:!1,dateFormat:"",fancyDateFormat:"",width:"auto",height:400,resizable:!0,notifyDelay:500,allowShortcuts:!0,rememberLastDir:!0,useBrowserHistory:!0,showFiles:30,showThreshold:50,validName:!1,sync:0,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:!1},contextmenu:{navbar:["open","|","copy","cut","paste","duplicate","|","rm","|","info"],cwd:["reload","back","|","upload","mkdir","mkfile","paste","|","sort","|","info"],files:["getfile","|","open","quicklook","|","download","|","copy","cut","paste","duplicate","|","rm","|","edit","rename","resize","|","archive","extract","|","info"]},debug:["error","warning","event-destroy"]},elFinder.prototype.history=function(a){var b,c=this,d=!0,e=[],f=function(){e=[a.cwd().hash],b=0,d=!0},g=a.options.useBrowserHistory&&window.history&&window.history.pushState?window.history:null,h=function(g){return g&&c.canForward()||!g&&c.canBack()?(d=!1,a.exec("open",e[g?++b:--b]).fail(f)):$.Deferred().reject()};this.canBack=function(){return b>0},this.canForward=function(){return b<e.length-1},this.back=h,this.forward=function(){return h(!0)},a.open(function(){var c=e.length,f=a.cwd().hash;d&&(b>=0&&c>b+1&&e.splice(b+1),e[e.length-1]!=f&&e.push(f),b=e.length-1),d=!0,g&&(g.state?g.state.thash!=f&&g.pushState({thash:f},null,location.pathname+location.search+"#elf_"+f):g.replaceState({thash:f},null,location.pathname+location.search+"#elf_"+f))}).reload(f)},elFinder.prototype.command=function(a){this.fm=a,this.name="",this.title="",this.state=-1,this.alwaysEnabled=!1,this._disabled=!1,this.disableOnSearch=!1,this.updateOnSelect=!0,this._handlers={enable:function(){this.update(void 0,this.value)},disable:function(){this.update(-1,this.value)},"open reload load":function(){this._disabled=!(this.alwaysEnabled||this.fm.isCommandEnabled(this.name)),this.update(void 0,this.value),this.change()}},this.handlers={},this.shortcuts=[],this.options={ui:"button"},this.setup=function(a,b){var c,d,e=this,f=this.fm;for(this.name=a,this.title=f.messages["cmd"+a]?f.i18n("cmd"+a):a,this.options=$.extend({},this.options,b),this.listeners=[],this.updateOnSelect&&(this._handlers.select=function(){this.update(void 0,this.value)}),$.each($.extend({},e._handlers,e.handlers),function(a,b){f.bind(a,$.proxy(b,e))}),c=0;c<this.shortcuts.length;c++)d=this.shortcuts[c],d.callback=$.proxy(d.callback||function(){this.exec()},this),!d.description&&(d.description=this.title),f.shortcut(d);this.disableOnSearch&&f.bind("search searchend",function(a){e._disabled="search"==a.type,e.update(void 0,e.value)}),this.init()},this.init=function(){},this.exec=function(){return $.Deferred().reject()},this.disabled=function(){return this.state<0},this.enabled=function(){return this.state>-1},this.active=function(){return this.state>0},this.getstate=function(){return-1},this.update=function(a,b){var c=this.state,d=this.value;this.state=this._disabled?-1:void 0!==a?a:this.getstate(),this.value=b,(c!=this.state||d!=this.value)&&this.change()},this.change=function(a){var b,c;if("function"==typeof a)this.listeners.push(a);else for(c=0;c<this.listeners.length;c++){b=this.listeners[c];try{b(this.state,this.value)}catch(d){this.fm.debug("error",d)}}return this},this.hashes=function(b){return b?$.map($.isArray(b)?b:[b],function(b){return a.file(b)?b:null}):a.selected()},this.files=function(a){var b=this.fm;return a?$.map($.isArray(a)?a:[a],function(a){return b.file(a)||null}):b.selectedFiles()}},$.fn.elfinderoverlay=function(a){if(this.filter(":not(.elfinder-overlay)").each(function(){a=$.extend({},a),$(this).addClass("ui-widget-overlay elfinder-overlay").hide().mousedown(function(a){a.preventDefault(),a.stopPropagation()}).data({cnt:0,show:"function"==typeof a.show?a.show:function(){},hide:"function"==typeof a.hide?a.hide:function(){}})}),"show"==a){var b=this.eq(0),c=b.data("cnt")+1,d=b.data("show");b.data("cnt",c),b.is(":hidden")&&(b.zIndex(b.parent().zIndex()+1),b.show(),d())}if("hide"==a){var b=this.eq(0),c=b.data("cnt")-1,e=b.data("hide");b.data("cnt",c),0==c&&b.is(":visible")&&(b.hide(),e())}return this},$.fn.elfinderworkzone=function(){var a="elfinder-workzone";return this.not("."+a).each(function(){var b=$(this).addClass(a),c=b.outerHeight(!0)-b.height(),d=b.parent();d.add(window).bind("resize",function(){var e=d.height();d.children(":visible:not(."+a+")").each(function(){var a=$(this);"absolute"!=a.css("position")&&(e-=a.outerHeight(!0))}),b.height(e-c)})}),this},$.fn.elfindernavbar=function(a,b){return this.not(".elfinder-navbar").each(function(){var c,d=$(this).addClass("ui-state-default elfinder-navbar"),e=d.parent().resize(function(){d.height(f.height()-g)}),f=e.children(".elfinder-workzone").append(d),g=d.outerHeight()-d.height(),h="ltr"==a.direction;$.fn.resizable&&(c=d.resizable({handles:h?"e":"w",minWidth:b.minWidth||150,maxWidth:b.maxWidth||500}).bind("resize scroll",function(){var b=a.UA.Opera&&d.scrollLeft()?20:2;c.css({top:parseInt(d.scrollTop())+"px",left:h?"auto":parseInt(d.scrollLeft()+b),right:h?-1*parseInt(d.scrollLeft()-b):"auto"})}).find(".ui-resizable-handle").zIndex(d.zIndex()+10),h||d.resize(function(){d.css("left",null).css("right",0)}),a.one("open",function(){setTimeout(function(){d.trigger("resize")},150)}))}),this},$.fn.elfinderdialog=function(a){var b;return"string"==typeof a&&(b=this.closest(".ui-dialog")).length&&("open"==a?"none"==b.css("display")&&b.fadeIn(120,function(){b.trigger("open")}):"close"==a?"none"!=b.css("display")&&b.hide().trigger("close"):"destroy"==a?b.hide().remove():"toTop"==a&&b.trigger("totop")),a=$.extend({},$.fn.elfinderdialog.defaults,a),this.filter(":not(.ui-dialog-content)").each(function(){var b,c=$(this).addClass("ui-dialog-content ui-widget-content"),d=c.parent(),e="elfinder-dialog-active",f="elfinder-dialog",g="elfinder-dialog-notify",h="ui-state-hover",i=parseInt(1e6*Math.random()),j=d.children(".elfinder-overlay"),k=$('<div class="ui-dialog-buttonset"/>'),l=$('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"/>').append(k),m=$('<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog  '+f+" "+a.cssClass+'"/>').hide().append(c).appendTo(d).draggable({handle:".ui-dialog-titlebar",containment:"document"}).css({width:a.width,height:a.height}).mousedown(function(a){a.stopPropagation(),$(document).mousedown(),m.is("."+e)||(d.find("."+f+":visible").removeClass(e),m.addClass(e).zIndex(n()+1))}).bind("open",function(){m.trigger("totop"),"function"==typeof a.open&&$.proxy(a.open,c[0])(),m.is("."+g)||d.find("."+f+":visible").not("."+g).each(function(){var a=$(this),b=parseInt(a.css("top")),c=parseInt(a.css("left")),d=parseInt(m.css("top")),e=parseInt(m.css("left"));a[0]==m[0]||b!=d&&c!=e||m.css({top:b+10+"px",left:c+10+"px"})})}).bind("close",function(){var b=d.find(".elfinder-dialog:visible"),e=n();$(this).data("modal")&&j.elfinderoverlay("hide"),b.length?b.each(function(){var a=$(this);return a.zIndex()>=e?(a.trigger("totop"),!1):void 0}):setTimeout(function(){d.mousedown().click()},10),"function"==typeof a.close?$.proxy(a.close,c[0])():a.destroyOnClose&&m.hide().remove()}).bind("totop",function(){$(this).mousedown().find(".ui-button:first").focus().end().find(":text:first").focus(),$(this).data("modal")&&j.elfinderoverlay("show"),j.zIndex($(this).zIndex())}).data({modal:a.modal}),n=function(){var a=d.zIndex()+10;return d.find("."+f+":visible").each(function(){var b;this!=m[0]&&(b=$(this).zIndex(),b>a&&(a=b))}),a};a.position||(b=parseInt((d.height()-m.outerHeight())/2-42),a.position={top:(b>0?b:0)+"px",left:parseInt((d.width()-m.outerWidth())/2)+"px"}),m.css(a.position),a.closeOnEscape&&$(document).bind("keyup."+i,function(a){a.keyCode==$.ui.keyCode.ESCAPE&&m.is("."+e)&&(c.elfinderdialog("close"),$(document).unbind("keyup."+i))}),m.prepend($('<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+a.title+"</div>").prepend($('<a href="#" class="ui-dialog-titlebar-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/></a>').mousedown(function(a){a.preventDefault(),c.elfinderdialog("close")}))),$.each(a.buttons,function(a,b){var d=$('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+a+"</span></button>").click($.proxy(b,c[0])).hover(function(a){$(this)["mouseenter"==a.type?"focus":"blur"]()}).focus(function(){$(this).addClass(h)}).blur(function(){$(this).removeClass(h)}).keydown(function(a){var b;a.keyCode==$.ui.keyCode.ENTER?$(this).click():a.keyCode==$.ui.keyCode.TAB&&(b=$(this).next(".ui-button"),b.length?b.focus():$(this).parent().children(".ui-button:first").focus())});k.append(d)}),k.children().length&&m.append(l),a.resizable&&$.fn.resizable&&m.resizable({minWidth:a.minWidth,minHeight:a.minHeight,alsoResize:this}),"function"==typeof a.create&&$.proxy(a.create,this)(),a.autoOpen&&c.elfinderdialog("open")}),this},$.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:!1,resizable:!0,autoOpen:!0,closeOnEscape:!0,destroyOnClose:!1,buttons:{},position:null,width:320,height:"auto",minWidth:200,minHeight:110},$.fn.elfindertree=function(a,b){var c=a.res("class","tree");return this.not("."+c).each(function(){var d,e,f="class",g=a.res(f,"treeroot"),h=b.openRootOnLoad,i=a.res(f,"navsubtree"),j=a.res(f,"treedir"),k=a.res(f,"navcollapse"),l=a.res(f,"navexpand"),m="elfinder-subtree-loaded",n=a.res(f,"navarrow"),o=a.res(f,"active"),p=a.res(f,"adroppable"),q=a.res(f,"hover"),r=a.res(f,"disabled"),s=a.res(f,"draggable"),t=a.res(f,"droppable"),u=function(a){var b=L.offset().left;return a>=b&&a<=b+L.width()},v=a.droppable.drop,w=$.extend(!0,{},a.droppable,{over:function(a){var b=$(this),c=q+" "+p;u(a.clientX)?(b.addClass(c),b.is("."+k+":not(."+l+")")&&setTimeout(function(){b.is("."+p)&&b.children("."+n).click()},500)):b.removeClass(c)},out:function(){$(this).removeClass(q+" "+p)},drop:function(a,b){u(a.clientX)&&v.call(this,a,b)}}),x=$(a.res("tpl","navspinner")),y=a.res("tpl","navdir"),z=a.res("tpl","perms"),A=a.res("tpl","symlink"),B={id:function(b){return a.navHash2Id(b.hash)},cssclass:function(b){return(b.phash?"":g)+" "+j+" "+a.perms2class(b)+" "+(b.dirs&&!b.link?k:"")},permissions:function(a){return a.read&&a.write?"":z},symlink:function(a){return a.alias?A:""}},C=function(b){return b.name=a.escape(b.i18||b.name),y.replace(/(?:\{([a-z]+)\})/gi,function(a,c){return b[c]||(B[c]?B[c](b):"")})},D=function(a){return $.map(a||[],function(a){return"directory"==a.mime?a:null})},E=function(b){return b?K.find("#"+a.navHash2Id(b)).next("."+i):K},F=function(b,c){for(var d,e=b.children(":first");e.length;){if(d=a.file(a.navId2Hash(e.children("[id]").attr("id"))),(d=a.file(a.navId2Hash(e.children("[id]").attr("id"))))&&c.name.toLowerCase().localeCompare(d.name.toLowerCase())<0)return e;e=e.next()}return $("")},G=function(b){for(var c,d,e,f,g=b.length,h=[],i=b.length,j=!0;i--;)c=b[i],K.find("#"+a.navHash2Id(c.hash)).length||((e=E(c.phash)).length?(d=C(c),c.phash&&(f=F(e,c)).length?f.before(d):(e[j||c.phash?"append":"prepend"](d),j=!1)):h.push(c));return h.length&&h.length<g?G(h):void setTimeout(function(){I()},10)},H=function(){var c,d,e=a.cwd().hash,f=K.find("#"+a.navHash2Id(e));if(h&&(c=K.find("#"+a.navHash2Id(a.root())),c.is("."+m)&&c.addClass(l).next("."+i).show(),h=!1),f.is("."+o)||(K.find("."+j+"."+o).removeClass(o),f.addClass(o)),b.syncTree){if(f.length)return f.parentsUntil("."+g).filter("."+i).show().prev("."+j).addClass(l);if(a.newAPI){if(d=a.file(e),d&&d.phash&&K.find("#"+a.navHash2Id(d.phash)).length)return G([d]),H();a.request({data:{cmd:"parents",target:e},preventFail:!0}).done(function(b){var c=D(b.tree);G(c),J(c,m),e==a.cwd().hash&&H(!0)})}}},I=function(){K.find("."+j+":not(."+t+",.elfinder-ro,.elfinder-na)").droppable(w)},J=function(b,c){var d=c==m?"."+k+":not(."+m+")":":not(."+k+")";$.each(b,function(b,e){K.find("#"+a.navHash2Id(e.phash)+d).filter(function(){return $(this).next("."+i).children().length>0}).addClass(c)})},K=$(this).addClass(c).delegate("."+j,"hover",function(b){var c=$(this),d="mouseenter"==b.type;c.is("."+p+" ,."+r)||(d&&!c.is("."+g+",."+s+",.elfinder-na,.elfinder-wo")&&c.draggable(a.draggable),c.toggleClass(q,d))}).delegate("."+j,"dropover dropout drop",function(a){$(this)["dropover"==a.type?"addClass":"removeClass"](p+" "+q)}).delegate("."+j,"click",function(){if(d)return!1;d=!0;var b=$(this),c=a.navId2Hash(b.attr("id")),f=a.file(c);a.trigger("searchend"),c==a.cwd().hash||b.is("."+r)?b.is("."+k)&&b.children("."+n).click():a.exec("open",f.thash||c),e=setTimeout(function(){d=!1},1e3)}).delegate("."+j+"."+k+" ."+n,"click",function(b){var c=$(this),d=c.parent("."+j),e=d.next("."+i);b.stopPropagation(),d.is("."+m)?(d.toggleClass(l),e.slideToggle()):(x.insertBefore(c),d.removeClass(k),a.request({cmd:"tree",target:a.navId2Hash(d.attr("id"))}).done(function(a){G(D(a.tree)),e.children().length&&(d.addClass(k+" "+l),e.slideDown()),H()}).always(function(){x.remove(),d.addClass(m)}))}).delegate("."+j,"contextmenu",function(b){b.preventDefault(),a.trigger("contextmenu",{type:"navbar",targets:[a.navId2Hash($(this).attr("id"))],x:b.clientX,y:b.clientY})}),L=a.getUI("navbar").append(K).show();a.open(function(a){var b=a.data,c=D(b.files);b.init&&K.empty(),c.length&&(G(c),J(c,m)),H()}).add(function(a){var b=D(a.data.added);b.length&&(G(b),J(b,k))}).change(function(b){for(var c,d,e,f,g,h,k,n,o,p=D(b.data.changed),q=p.length;q--;)if(c=p[q],(d=K.find("#"+a.navHash2Id(c.hash))).length){if(c.phash){if(f=d.closest("."+i),g=E(c.phash),h=d.parent().next(),k=F(g,c),!g.length)continue;(g[0]!==f[0]||h.get(0)!==k.get(0))&&(k.length?k.before(d):g.append(d))}n=d.is("."+l),o=d.is("."+m),e=$(C(c)),d.replaceWith(e.children("."+j)),c.dirs&&(n||o)&&(d=K.find("#"+a.navHash2Id(c.hash)))&&d.next("."+i).children().length&&(n&&d.addClass(l),o&&d.addClass(m))}H(),I()}).remove(function(b){for(var c,d,e=b.data.removed,f=e.length;f--;)(c=K.find("#"+a.navHash2Id(e[f]))).length&&(d=c.closest("."+i),c.parent().detach(),d.children().length||d.hide().prev("."+j).removeClass(k+" "+l+" "+m))}).bind("search searchend",function(b){K.find("#"+a.navHash2Id(a.cwd().hash))["search"==b.type?"removeClass":"addClass"](o)}).bind("lockfiles unlockfiles",function(b){var c="lockfiles"==b.type,d=c?"disable":"enable",e=$.map(b.data.files||[],function(b){var c=a.file(b);return c&&"directory"==c.mime?b:null});$.each(e,function(b,e){var f=K.find("#"+a.navHash2Id(e));f.length&&(f.is("."+s)&&f.draggable(d),f.is("."+t)&&f.droppable(o),f[c?"addClass":"removeClass"](r))})})}),this},$.fn.elfindercwd=function(a,b){return this.not(".elfinder-cwd").each(function(){var c="list"==a.viewType,d="select."+a.namespace,e="unselect."+a.namespace,f="disable."+a.namespace,g="enable."+a.namespace,h="class",i=a.res(h,"cwdfile"),j="."+i,k="ui-selected",l=a.res(h,"disabled"),m=a.res(h,"draggable"),n=a.res(h,"droppable"),o=a.res(h,"hover"),p=a.res(h,"adroppable"),q=i+"-tmp",r=a.options.loadTmbs>0?a.options.loadTmbs:5,s="",t=[],u={icon:'<div id="{hash}" class="'+i+' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on" {style}/>{marker}</div><div class="elfinder-cwd-filename" title="{name}">{name}</div></div>',row:'<tr id="{hash}" class="'+i+' {permsclass} {dirclass}" title="{tooltip}"><td><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"/>{marker}<span class="elfinder-cwd-filename">{name}</span></div></td><td>{perms}</td><td>{date}</td><td>{size}</td><td>{kind}</td></tr>'},v=a.res("tpl","perms"),w=a.res("tpl","symlink"),x={permsclass:function(b){return a.perms2class(b)},perms:function(b){return a.formatPermissions(b)},dirclass:function(a){return"directory"==a.mime?"directory":""},mime:function(b){return a.mime2class(b.mime)},size:function(b){return a.formatSize(b.size)},date:function(b){return a.formatDate(b)},kind:function(b){return a.mime2kind(b)},marker:function(a){return(a.alias||"symlink-broken"==a.mime?w:"")+(a.read&&a.write?"":v)},tooltip:function(b){var c=a.formatDate(b)+(b.size>0?" ("+a.formatSize(b.size)+")":"");return b.tooltip?a.escape(b.tooltip).replace(/"/g,"&quot;").replace(/\r/g,"&#13;")+"&#13;"+c:c}},y=function(b){return b.name=a.escape(b.name),u[c?"row":"icon"].replace(/\{([a-z]+)\}/g,function(a,c){return x[c]?x[c](b):b[c]?b[c]:""})},z=!1,A=function(a,b){function f(a,b){return a[b+"All"]("[id]:not(."+l+"):not(.elfinder-cwd-parent):first")}var g,h,i,j,m,n=$.ui.keyCode,o=a==n.LEFT||a==n.UP,p=T.find("[id]."+k);if(p.length)if(g=p.filter(o?":first":":last"),i=f(g,o?"prev":"next"),i.length)if(c||a==n.LEFT||a==n.RIGHT)h=i;else if(j=g.position().top,m=g.position().left,h=g,o){do h=h.prev("[id]");while(h.length&&!(h.position().top<j&&h.position().left<=m));h.is("."+l)&&(h=f(h,"next"))}else{do h=h.next("[id]");while(h.length&&!(h.position().top>j&&h.position().left>=m));h.is("."+l)&&(h=f(h,"prev")),h.length||(i=T.find("[id]:not(."+l+"):last"),i.position().top>j&&(h=i))}else h=g;else h=T.find("[id]:not(."+l+"):not(.elfinder-cwd-parent):"+(o?"last":"first"));h&&h.length&&!h.is(".elfinder-cwd-parent")&&(b?h=g.add(g[o?"prevUntil":"nextUntil"]("#"+h.attr("id"))).add(h):p.trigger(e),h.trigger(d),G(h.filter(o?":first":":last")),F())},B=[],C=function(a){T.find("#"+a).trigger(d)},D=function(){var b=a.cwd().hash;T.find("[id]:not(."+k+"):not(.elfinder-cwd-parent)").trigger(d),B=$.map(a.files(),function(a){return a.phash==b?a.hash:null}),F()},E=function(){B=[],T.find("[id]."+k).trigger(e),F()},F=function(){a.trigger("select",{selected:B})},G=function(a){var b=a.position().top,c=a.outerHeight(!0),d=U.scrollTop(),e=U.innerHeight();b+c>d+e?U.scrollTop(parseInt(b+c-e)):d>b&&U.scrollTop(b)},H=[],I=function(a){for(var b=H.length;b--;)if(H[b].hash==a)return b;return-1},J="scroll."+a.namespace,K=function(){var b,e=[],f=!1,g=[],h={},i=T.find("[id]:last"),j=!i.length,l=c?T.children("table").children("tbody"):T;if(!H.length)return U.unbind(J);for(;(!i.length||i.position().top<=U.height()+U.scrollTop()+a.options.showThreshold)&&(b=H.splice(0,a.options.showFiles)).length;)e=$.map(b,function(a){return a.hash&&a.name?("directory"==a.mime&&(f=!0),a.tmb&&(1===a.tmb?g.push(a.hash):h[a.hash]=a.tmb),y(a)):null}),l.append(e.join("")),i=T.find("[id]:last"),j&&T.scrollTop(0);N(h),g.length&&O(g),f&&M(),B.length&&l.find("[id]:not(."+k+"):not(.elfinder-cwd-parent)").each(function(){var a=this.id;-1!==$.inArray(a,B)&&$(this).trigger(d)})},L=$.extend({},a.droppable,{over:function(b,c){var d=a.cwd().hash;$.each(c.helper.data("files"),function(b,c){return a.file(c).phash==d?(T.removeClass(p),!1):void 0})}}),M=function(){setTimeout(function(){T.find(".directory:not(."+n+",.elfinder-na,.elfinder-ro)").droppable(a.droppable)},20)},N=function(b){var c,d=a.option("tmbUrl"),e=!0;return $.each(b,function(a,b){var f=T.find("#"+a);f.length?!function(a,b){$("<img/>").load(function(){a.find(".elfinder-cwd-icon").css("background","url('"+b+"') center center no-repeat")}).attr("src",b)}(f,d+b):(e=!1,-1!=(c=I(a))&&(H[c].tmb=b))}),e},O=function(b){var c=[];return a.oldAPI?void a.request({data:{cmd:"tmb",current:a.cwd().hash},preventFail:!0}).done(function(a){N(a.images||[])&&a.tmb&&O()}):(c=c=b.splice(0,r),void(c.length&&a.request({data:{cmd:"tmb",targets:c},preventFail:!0}).done(function(a){N(a.images||[])&&O(b)})))},P=function(b){for(var d,e,f,g,h=c?T.find("tbody"):T,i=b.length,j=[],k={},l=!1,m=function(b){for(var c,d=T.find("[id]:first");d.length;){if(c=a.file(d.attr("id")),!d.is(".elfinder-cwd-parent")&&c&&a.compare(b,c)<0)return d;d=d.next("[id]")}},n=function(b){var c,d=H.length;for(c=0;d>c;c++)if(a.compare(b,H[c])<0)return c;return d||-1};i--;)d=b[i],e=d.hash,T.find("#"+e).length||((f=m(d))&&f.length?f.before(y(d)):(g=n(d))>=0?H.splice(g,0,d):h.append(y(d)),T.find("#"+e).length&&("directory"==d.mime?l=!0:d.tmb&&(1===d.tmb?j.push(e):k[e]=d.tmb)));
N(k),j.length&&O(j),l&&M()},Q=function(b){for(var c,d,e,f=b.length;f--;)if(c=b[f],(d=T.find("#"+c)).length)try{d.detach()}catch(g){a.debug("error",g)}else-1!=(e=I(c))&&H.splice(e,1)},R={name:a.i18n("name"),perm:a.i18n("perms"),mod:a.i18n("modify"),size:a.i18n("size"),kind:a.i18n("kind")},S=function(d,e){var f=a.cwd().hash;E();try{T.children("table,"+j).remove()}catch(g){T.html("")}if(T.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(c?"list":"icons")),U[c?"addClass":"removeClass"]("elfinder-cwd-wrapper-list"),c&&T.html('<table><thead><tr class="ui-state-default"><td >'+R.name+"</td><td>"+R.perm+"</td><td>"+R.mod+"</td><td>"+R.size+"</td><td>"+R.kind+"</td></tr></thead><tbody/></table>"),H=$.map(d,function(a){return e||a.phash==f?a:null}),H=a.sortFiles(H),U.bind(J,K).trigger(J),f=a.cwd().phash,b.oldSchool&&f&&!s){var h=$.extend(!0,{},a.file(f),{name:"..",mime:"directory"});h=$(y(h)).addClass("elfinder-cwd-parent").bind("mousedown click mouseup touchstart touchmove touchend dblclick mouseenter",function(a){a.preventDefault(),a.stopPropagation()}).dblclick(function(){a.exec("open",this.id)}),(c?T.find("tbody"):T).prepend(h)}},T=$(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable","on").delegate(j,"click."+a.namespace,function(b){var c,f=this.id?$(this):$(this).parents("[id]:first"),g=f.prevAll("."+k+":first"),h=f.nextAll("."+k+":first"),i=g.length,j=h.length;b.stopImmediatePropagation(),b.shiftKey&&(i||j)?(c=i?f.prevUntil("#"+g.attr("id")):f.nextUntil("#"+h.attr("id")),c.add(f).trigger(d)):b.ctrlKey||b.metaKey?f.trigger(f.is("."+k)?e:d):$(this).data("touching")&&f.is("."+k)?($(this).data("touching",null),a.dblclick({file:this.id}),E()):(E(),f.trigger(d)),F()}).delegate(j,"dblclick."+a.namespace,function(){a.dblclick({file:this.id})}).delegate(j,"touchstart."+a.namespace,function(){$(this).data("touching",!0);var a=this.id?$(this):$(this).parents("[id]:first"),b=a.prevAll("."+k+":first").length+a.nextAll("."+k+":first").length;$(this).data("longtap",setTimeout(function(){a.trigger(a.is("."+k)?e:d),F(),0==b&&a.is("."+k)&&(a.trigger("click"),F())},500))}).delegate(j,"touchmove."+a.namespace+" touchend."+a.namespace,function(){clearTimeout($(this).data("longtap"))}).delegate(j,"mouseenter."+a.namespace,function(){var b=$(this),d=c?b:b.children();b.is("."+q)||d.is("."+m+",."+l)||d.draggable(a.draggable)}).delegate(j,d,function(){var a=$(this),b=a.attr("id");z||a.is("."+l)||(a.addClass(k).children().addClass(o),-1===$.inArray(b,B)&&B.push(b))}).delegate(j,e,function(){var a,b=$(this),c=b.attr("id");z||($(this).removeClass(k).children().removeClass(o),a=$.inArray(c,B),-1!==a&&B.splice(a,1))}).delegate(j,f,function(){var a=$(this).removeClass(k).addClass(l),b=(c?a:a.children()).removeClass(o);a.is("."+n)&&a.droppable("disable"),b.is("."+m)&&b.draggable("disable"),!c&&b.removeClass(l)}).delegate(j,g,function(){var a=$(this).removeClass(l),b=c?a:a.children();a.is("."+n)&&a.droppable("enable"),b.is("."+m)&&b.draggable("enable")}).delegate(j,"scrolltoview",function(){G($(this))}).delegate(j,"mouseenter."+a.namespace+" mouseleave."+a.namespace,function(b){a.trigger("hover",{hash:$(this).attr("id"),type:b.type}),$(this).toggleClass("ui-state-hover")}).bind("contextmenu."+a.namespace,function(b){var c=$(b.target).closest("."+i);c.length&&(b.stopPropagation(),b.preventDefault(),c.is("."+l)||(c.is("."+k)||(E(),c.trigger(d),F()),a.trigger("contextmenu",{type:"files",targets:a.selected(),x:b.clientX,y:b.clientY})))}).bind("click."+a.namespace,function(a){!a.shiftKey&&!a.ctrlKey&&!a.metaKey&&E()}).selectable({filter:j,stop:F,delay:250,selected:function(a,b){$(b.selected).trigger(d)},unselected:function(a,b){$(b.unselected).trigger(e)}}).droppable(L).bind("create."+a.namespace,function(a,b){var d=c?T.find("tbody"):T,e=d.find(".elfinder-cwd-parent"),b=$(y(b)).addClass(q);E(),e.length?e.after(b):d.prepend(b),T.scrollTop(0)}).bind("unselectall",E).bind("selectfile",function(a,b){T.find("#"+b).trigger(d),F()}),U=$('<div class="elfinder-cwd-wrapper"/>').bind("contextmenu",function(b){b.preventDefault(),a.trigger("contextmenu",{type:"cwd",targets:[a.cwd().hash],x:b.clientX,y:b.clientY})}),V=function(){var a=0;U.siblings(".elfinder-panel:visible").each(function(){a+=$(this).outerHeight(!0)}),U.height(X.height()-a)},W=$(this).parent().resize(V),X=W.children(".elfinder-workzone").append(U.append(this));a.dragUpload&&(U[0].addEventListener("dragenter",function(a){a.preventDefault(),a.stopPropagation(),U.addClass(p)},!1),U[0].addEventListener("dragleave",function(a){a.preventDefault(),a.stopPropagation(),a.target==T[0]&&U.removeClass(p)},!1),U[0].addEventListener("dragover",function(a){a.preventDefault(),a.stopPropagation()},!1),U[0].addEventListener("drop",function(b){b.preventDefault(),U.removeClass(p);var c=!1,d="",e=null;try{e=b.dataTransfer.getData("text/html")}catch(b){}e?(c=[e],d="html"):(e=b.dataTransfer.getData("text"))?(c=[e],d="text"):b.dataTransfer&&b.dataTransfer.items&&b.dataTransfer.items.length?(c=b.dataTransfer,d="data"):b.dataTransfer&&b.dataTransfer.files&&b.dataTransfer.files.length&&(c=b.dataTransfer.files,d="files"),c&&a.exec("upload",{files:c,type:d})},!1)),a.bind("open",function(a){S(a.data.files)}).bind("search",function(a){t=a.data.files,S(t,!0)}).bind("searchend",function(){t=[],s&&(s="",S(a.files()))}).bind("searchstart",function(a){s=a.data.query}).bind("sortchange",function(){S(s?t:a.files(),!!s)}).bind("viewchange",function(){var b=a.selected(),d="list"==a.storage("view");d!=c&&(c=d,S(a.files()),$.each(b,function(a,b){C(b)}),F()),V()}).add(function(b){var c=a.cwd().hash,d=s?$.map(b.data.added||[],function(a){return-1===a.name.indexOf(s)?null:a}):$.map(b.data.added||[],function(a){return a.phash==c?a:null});P(d)}).change(function(b){var c=a.cwd().hash,d=a.selected();s?$.each(b.data.changed||[],function(a,b){Q([b.hash]),-1!==b.name.indexOf(s)&&(P([b]),-1!==$.inArray(b.hash,d)&&C(b.hash))}):$.each($.map(b.data.changed||[],function(a){return a.phash==c?a:null}),function(a,b){Q([b.hash]),P([b]),-1!==$.inArray(b.hash,d)&&C(b.hash)}),F()}).remove(function(a){Q(a.data.removed||[]),F()}).bind("open add search searchend",function(){T.css("height","auto"),T.outerHeight(!0)<U.height()&&T.height(U.height()-(T.outerHeight(!0)-T.height())-2)}).dragstart(function(a){var b=$(a.data.target),c=a.data.originalEvent;b.is(j)&&(b.is("."+k)||(!(c.ctrlKey||c.metaKey||c.shiftKey)&&E(),b.trigger(d),F()),T.droppable("disable")),T.selectable("disable").removeClass(l),z=!0}).dragstop(function(){T.selectable("enable").droppable("enable"),z=!1}).bind("lockfiles unlockfiles",function(a){for(var b="lockfiles"==a.type?f:g,c=a.data.files||[],d=c.length;d--;)T.find("#"+c[d]).trigger(b);F()}).bind("mkdir mkfile duplicate upload rename archive extract",function(b){var c=a.cwd().hash;E(),$.each(b.data.added||[],function(a,b){b&&b.phash==c&&C(b.hash)}),F()}).shortcut({pattern:"ctrl+a",description:"selectall",callback:D}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"selectfiles",type:"keydown",callback:function(a){A(a.keyCode,a.shiftKey)}}).shortcut({pattern:"home",description:"selectffile",callback:function(){E(),G(T.find("[id]:first").trigger(d)),F()}}).shortcut({pattern:"end",description:"selectlfile",callback:function(){E(),G(T.find("[id]:last").trigger(d)),F()}})}),this},$.fn.elfindertoolbar=function(a,b){return this.not(".elfinder-toolbar").each(function(){var c,d,e,f,g=a._commands,h=$(this).addClass("ui-helper-clearfix ui-widget-header ui-corner-top elfinder-toolbar"),i=b||[],j=i.length;for(h.prev().length&&h.parent().prepend(this);j--;)if(i[j]){for(e=$('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>'),c=i[j].length;c--;)(d=g[i[j][c]])&&(f="elfinder"+d.options.ui,$.fn[f]&&e.prepend($("<div/>")[f](d)));e.children().length&&h.prepend(e),e.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"/>')}h.children().length&&h.show()}),this},$.fn.elfinderbutton=function(a){return this.each(function(){var b,c="class",d=a.fm,e=d.res(c,"disabled"),f=d.res(c,"active"),g=d.res(c,"hover"),h="elfinder-button-menu-item",i="elfinder-button-menu-item-selected",j=$(this).addClass("ui-state-default elfinder-button").attr("title",a.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+a.name+'"/>').hover(function(a){!j.is("."+e)&&j["mouseleave"==a.type?"removeClass":"addClass"](g)}).click(function(c){j.is("."+e)||(b&&a.variants.length>1?(b.is(":hidden")&&a.fm.getUI().click(),c.stopPropagation(),b.slideToggle(100)):a.exec())}),k=function(){b.hide()};$.isArray(a.variants)&&(j.addClass("elfinder-menubutton"),b=$('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(j).zIndex(12+j.zIndex()).delegate("."+h,"hover",function(){$(this).toggleClass(g)}).delegate("."+h,"click",function(b){b.preventDefault(),b.stopPropagation(),j.removeClass(g),a.exec(a.fm.selected(),$(this).data("value"))}),a.fm.bind("disable select",k).getUI().click(k),a.change(function(){b.html(""),$.each(a.variants,function(c,d){b.append($('<div class="'+h+'">'+d[1]+"</div>").data("value",d[0]).addClass(d[0]==a.value?i:""))})})),a.change(function(){a.disabled()?j.removeClass(f+" "+g).addClass(e):(j.removeClass(e),j[a.active()?"addClass":"removeClass"](f))}).change()})},$.fn.elfinderuploadbutton=function(a){return this.each(function(){var b=$(this).elfinderbutton(a).unbind("click"),c=$("<form/>").appendTo(b),d=$('<input type="file" multiple="true"/>').change(function(){var b=$(this);b.val()&&(a.exec({input:b.remove()[0]}),d.clone(!0).appendTo(c))});c.append(d.clone(!0)),a.change(function(){c[a.disabled()?"hide":"show"]()}).change()})},$.fn.elfinderviewbutton=function(a){return this.each(function(){var b=$(this).elfinderbutton(a),c=b.children(".elfinder-button-icon");a.change(function(){var d="icons"==a.value;c.toggleClass("elfinder-button-icon-view-list",d),b.attr("title",a.fm.i18n(d?"viewlist":"viewicons"))})})},$.fn.elfindersearchbutton=function(a){return this.each(function(){var b=!1,c=$(this).hide().addClass("ui-widget-content elfinder-button "+a.fm.res("class","searchbtn")),d=function(){var c=$.trim(f.val());c?a.exec(c).done(function(){b=!0,f.focus()}):a.fm.trigger("searchend")},e=function(){f.val(""),b&&(b=!1,a.fm.trigger("searchend"))},f=$('<input type="text" size="42"/>').appendTo(c).keypress(function(a){a.stopPropagation()}).keydown(function(a){a.stopPropagation(),13==a.keyCode&&d(),27==a.keyCode&&(a.preventDefault(),e())});$('<span class="ui-icon ui-icon-search" title="'+a.title+'"/>').appendTo(c).click(d),$('<span class="ui-icon ui-icon-close"/>').appendTo(c).click(e),setTimeout(function(){if(c.parent().detach(),a.fm.getUI("toolbar").prepend(c.show()),a.fm.UA.ltIE7){var b=c.children("ltr"==a.fm.direction?".ui-icon-close":".ui-icon-search");b.css({right:"",left:parseInt(c.width())-b.outerWidth(!0)})}},200),a.fm.error(function(){f.unbind("keydown")}).select(function(){f.blur()}).bind("searchend",function(){f.val("")}).viewchange(e).shortcut({pattern:"ctrl+f f3",description:a.title,callback:function(){f.select().focus()}})})},$.fn.elfindersortbutton=function(a){return this.each(function(){var b=a.fm,c=a.name,d="class",e=b.res(d,"disabled"),f=b.res(d,"hover"),g="elfinder-button-menu-item",h=g+"-selected",i=h+"-asc",j=h+"-desc",k=$(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-"+c).attr("title",a.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+c+'"/>').hover(function(){!k.is("."+e)&&k.toggleClass(f)}).click(function(b){k.is("."+e)||(b.stopPropagation(),l.is(":hidden")&&a.fm.getUI().click(),l.slideToggle(100))}),l=$('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(k).zIndex(12+k.zIndex()).delegate("."+g,"hover",function(){$(this).toggleClass(f)}).delegate("."+g,"click",function(a){a.preventDefault(),a.stopPropagation(),n()}),m=function(){l.children(":not(:last)").removeClass(h+" "+i+" "+j).filter('[rel="'+b.sortType+'"]').addClass(h+" "+("asc"==b.sortOrder?i:j)),l.children(":last").toggleClass(h,b.sortStickFolders)},n=function(){l.hide()};$.each(b.sortRules,function(a){l.append($('<div class="'+g+'" rel="'+a+'"><span class="ui-icon ui-icon-arrowthick-1-n"/><span class="ui-icon ui-icon-arrowthick-1-s"/>'+b.i18n("sort"+a)+"</div>").data("type",a))}),l.children().click(function(){var c=$(this).attr("rel");a.exec([],{type:c,order:c==b.sortType?"asc"==b.sortOrder?"desc":"asc":b.sortOrder,stick:b.sortStickFolders})}),$('<div class="'+g+" "+g+'-separated"><span class="ui-icon ui-icon-check"/>'+b.i18n("sortFoldersFirst")+"</div>").appendTo(l).click(function(){a.exec([],{type:b.sortType,order:b.sortOrder,stick:!b.sortStickFolders})}),b.bind("disable select",n).getUI().click(n),b.bind("sortchange",m),l.children().length>1?a.change(function(){k.toggleClass(e,a.disabled()),m()}).change():k.addClass(e)})},$.fn.elfinderpanel=function(a){return this.each(function(){var b=$(this).addClass("elfinder-panel ui-state-default ui-corner-all"),c="margin-"+("ltr"==a.direction?"left":"right");a.one("load",function(){var d=a.getUI("navbar");b.css(c,parseInt(d.outerWidth(!0))),d.bind("resize",function(){b.is(":visible")&&b.css(c,parseInt(d.outerWidth(!0)))})})})},$.fn.elfindercontextmenu=function(a){return this.each(function(){var b=$(this).addClass("ui-helper-reset ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+a.direction).hide().appendTo("body").delegate(".elfinder-contextmenu-item","mouseenter mouseleave",function(){$(this).toggleClass("ui-state-hover")}),c="ltr"==a.direction?"left":"right",d=$.extend({},a.options.contextmenu),e='<div class="elfinder-contextmenu-item"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"/><span>{label}</span></div>',f=function(a,b,c){return $(e.replace("{icon}",b?"elfinder-button-icon-"+b:"").replace("{label}",a)).click(function(a){a.stopPropagation(),a.stopPropagation(),c()})},g=function(d,e){var f=$(window),g=b.outerWidth(),h=b.outerHeight(),i=f.width(),j=f.height(),k=f.scrollTop(),l=f.scrollLeft(),m={top:(j>e+h?e:e-h>0?e-h:e)+k,left:(i>d+g?d:d-g)+l,"z-index":100+a.getUI("workzone").zIndex()};b.css(m).show(),m={"z-index":m["z-index"]+10},m[c]=parseInt(b.width()),b.find(".elfinder-contextmenu-sub").css(m)},h=function(){b.hide().empty()},i=function(c,e){var g=!1;$.each(d[c]||[],function(c,d){var i,j,k;if("|"==d&&g)return b.append('<div class="elfinder-contextmenu-separator"/>'),void(g=!1);if(i=a.command(d),i&&-1!=i.getstate(e)){if(i.variants){if(!i.variants.length)return;j=f(i.title,i.name,function(){}),k=$('<div class="ui-corner-all elfinder-contextmenu-sub"/>').appendTo(j.append('<span class="elfinder-contextmenu-arrow"/>')),j.addClass("elfinder-contextmenu-group").hover(function(){k.toggle()}),$.each(i.variants,function(a,b){k.append($('<div class="elfinder-contextmenu-item"><span>'+b[1]+"</span></div>").click(function(a){a.stopPropagation(),h(),i.exec(e,b[0])}))})}else j=f(i.title,i.name,function(){h(),i.exec(e)});b.append(j),g=!0}})},j=function(a){$.each(a,function(a,c){var d;c.label&&"function"==typeof c.callback&&(d=f(c.label,c.icon,function(){h(),c.callback()}),b.append(d))})};a.one("load",function(){a.bind("contextmenu",function(a){var c=a.data;h(),c.type&&c.targets?i(c.type,c.targets):c.raw&&j(c.raw),b.children().length&&g(c.x,c.y)}).one("destroy",function(){b.remove()}).bind("disable select",h).getUI().click(h)})})},$.fn.elfinderpath=function(a){return this.each(function(){var b=$(this).addClass("elfinder-path").html("&nbsp;").delegate("a","click",function(b){var c=$(this).attr("href").substr(1);b.preventDefault(),c!=a.cwd().hash&&a.exec("open",c)}).prependTo(a.getUI("statusbar").show());a.bind("open searchend",function(){var c=[];$.each(a.parents(a.cwd().hash),function(b,d){c.push('<a href="#'+d+'">'+a.escape(a.file(d).name)+"</a>")}),b.html(c.join(a.option("separator")))}).bind("search",function(){b.html(a.i18n("searcresult"))})})},$.fn.elfinderstat=function(a){return this.each(function(){var b=$(this).addClass("elfinder-stat-size"),c=$('<div class="elfinder-stat-selected"/>'),d=a.i18n("size").toLowerCase(),e=a.i18n("items").toLowerCase(),f=a.i18n("selected"),g=function(c,f){var g=0,h=0;$.each(c,function(a,b){f&&b.phash!=f||(g++,h+=parseInt(b.size)||0)}),b.html(e+": "+g+", "+d+": "+a.formatSize(h))};a.getUI("statusbar").prepend(b).append(c).show(),a.bind("open reload add remove change searchend",function(){g(a.files(),a.cwd().hash)}).search(function(a){g(a.data.files)}).select(function(){var b=0,e=0,g=a.selectedFiles();return 1==g.length?(b=g[0].size,void c.html(a.escape(g[0].name)+(b>0?", "+a.formatSize(b):""))):($.each(g,function(a,c){e++,b+=parseInt(c.size)||0}),void c.html(e?f+": "+e+", "+d+": "+a.formatSize(b):"&nbsp;"))})})},$.fn.elfinderplaces=function(a,b){return this.each(function(){var c=[],d="class",e=a.res(d,"navdir"),f=a.res(d,"navcollapse"),g=a.res(d,"navexpand"),h=(a.res(d,"hover"),a.res(d,"treeroot")),i=a.res("tpl","navdir"),j=a.res("tpl","perms"),k=$(a.res("tpl","navspinner")),l=function(a){return a.substr(6)},m=function(a){return"place-"+a},n=function(){a.storage("places",c.join(","))},o=function(b){return $(i.replace(/\{id\}/,m(b.hash)).replace(/\{name\}/,a.escape(b.name)).replace(/\{cssclass\}/,a.perms2class(b)).replace(/\{permissions\}/,b.read&&b.write?"":j).replace(/\{symlink\}/,""))},p=function(b){var d=o(b);t.children().length&&$.each(t.children(),function(){var a=$(this);return b.name.localeCompare(a.children("."+e).text())<0?!d.insertBefore(a):void 0}),c.push(b.hash),!d.parent().length&&t.append(d),s.addClass(f),d.draggable({appendTo:"body",revert:!1,helper:function(){var b=$(this);return b.children().removeClass("ui-state-hover"),$('<div class="elfinder-place-drag elfinder-'+a.direction+'"/>').append(b.clone()).data("hash",l(b.children(":first").attr("id")))},start:function(){$(this).hide()},stop:function(a,b){var c=u.offset().top,d=u.offset().left,e=u.width(),f=u.height(),g=a.clientX,h=a.clientY;g>d&&d+e>g&&h>c&&h+f>h?$(this).show():(q(b.helper.data("hash")),n())}})},q=function(a){var b=$.inArray(a,c);-1!==b&&(c.splice(b,1),t.find("#"+m(a)).parent().remove(),!t.children().length&&s.removeClass(f+" "+g))},r=o({hash:"root-"+a.namespace,name:a.i18n(b.name,"places"),read:!0,write:!0}),s=r.children("."+e).addClass(h).click(function(){s.is("."+f)&&(u.toggleClass(g),t.slideToggle(),a.storage("placesState",u.is("."+g)?1:0))}),t=r.children("."+a.res(d,"navsubtree")),u=$(this).addClass(a.res(d,"tree")+" elfinder-places ui-corner-all").hide().append(r).appendTo(a.getUI("navbar")).delegate("."+e,"hover",function(){$(this).toggleClass("ui-state-hover")}).delegate("."+e,"click",function(){a.exec("open",$(this).attr("id").substr(6))}).delegate("."+e+":not(."+h+")","contextmenu",function(b){var c=$(this).attr("id").substr(6);b.preventDefault(),a.trigger("contextmenu",{raw:[{label:a.i18n("rmFromPlaces"),icon:"rm",callback:function(){q(c),n()}}],x:b.clientX,y:b.clientY})}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:a.res("class","adroppable"),drop:function(b,d){var e=!0;$.each(d.helper.data("files"),function(b,d){var f=a.file(d);f&&"directory"==f.mime&&-1===$.inArray(f.hash,c)?p(f):e=!1}),n(),e&&d.helper.hide()}});a.one("load",function(){a.oldAPI||(u.show().parent().show(),c=$.map(a.storage("places").split(","),function(a){return a||null}),c.length&&(s.prepend(k),a.request({data:{cmd:"info",targets:c},preventDefault:!0}).done(function(b){c=[],$.each(b.files,function(a,b){"directory"==b.mime&&p(b)}),n(),a.storage("placesState")>0&&s.click()}).always(function(){k.remove()})),a.remove(function(a){$.each(a.data.removed,function(a,b){q(b)}),n()}).change(function(a){$.each(a.data.changed,function(a,b){-1!==$.inArray(b.hash,c)&&(q(b.hash),"directory"==b.mime&&p(b))}),n()}).bind("sync",function(){c.length&&(s.prepend(k),a.request({data:{cmd:"info",targets:c},preventDefault:!0}).done(function(a){$.each(a.files||[],function(a,b){-1===$.inArray(b.hash,c)&&q(b.hash)}),n()}).always(function(){k.remove()}))}))})})},elFinder.prototype.commands.archive=function(){var a=this,b=a.fm,c=[];this.variants=[],this.disableOnSearch=!0,b.bind("open reload",function(){a.variants=[],$.each(c=b.option("archivers").create||[],function(c,d){a.variants.push([d,b.mime2kind(d)])}),a.change()}),this.getstate=function(){return!this._disabled&&c.length&&b.selected().length&&b.cwd().write?0:-1},this.exec=function(a,d){var e,f=this.files(a),g=f.length,h=d||c[0],i=b.cwd(),j=["errArchive","errPerm","errCreatingTempDir","errFtpDownloadFile","errFtpUploadFile","errFtpMkdir","errArchiveExec","errExtractExec","errRm"],k=$.Deferred().fail(function(a){a&&b.error(a)});if(!(this.enabled()&&g&&c.length&&-1!==$.inArray(h,c)))return k.reject();if(!i.write)return k.reject(j);for(e=0;g>e;e++)if(!f[e].read)return k.reject(j);return b.request({data:{cmd:"archive",targets:this.hashes(a),type:h},notify:{type:"archive",cnt:1},syncOnFail:!0})}},elFinder.prototype.commands.back=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+left backspace"}],this.getstate=function(){return this.fm.history.canBack()?0:-1},this.exec=function(){return this.fm.history.back()}},elFinder.prototype.commands.copy=function(){this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}],this.getstate=function(a){var a=this.files(a),b=a.length;return b&&$.map(a,function(a){return a.phash&&a.read?a:null}).length==b?0:-1},this.exec=function(a){var b=this.fm,c=$.Deferred().fail(function(a){b.error(a)});return $.each(this.files(a),function(a,b){return b.read&&b.phash?void 0:!c.reject(["errCopy",b.name,"errPerm"])}),"rejected"==c.state()?c:c.resolve(b.clipboard(this.hashes(a)))}},elFinder.prototype.commands.cut=function(){this.shortcuts=[{pattern:"ctrl+x shift+insert"}],this.getstate=function(a){var a=this.files(a),b=a.length;return b&&$.map(a,function(a){return a.phash&&a.read&&!a.locked?a:null}).length==b?0:-1},this.exec=function(a){var b=this.fm,c=$.Deferred().fail(function(a){b.error(a)});return $.each(this.files(a),function(a,b){return b.read&&b.phash?b.locked?!c.reject(["errLocked",b.name]):void 0:!c.reject(["errCopy",b.name,"errPerm"])}),"rejected"==c.state()?c:c.resolve(b.clipboard(this.hashes(a),!0))}},elFinder.prototype.commands.download=function(){var a=this,b=this.fm,c=function(b){return $.map(a.files(b),function(a){return"directory"==a.mime?null:a})};this.shortcuts=[{pattern:"shift+enter"}],this.getstate=function(){var a=this.fm.selected(),d=a.length;return this._disabled||!d||b.UA.IE&&1!=d||d!=c(a).length?-1:0},this.exec=function(a){var b,d=this.fm,e=d.options.url,f=c(a),g=$.Deferred(),h="",i="";if(this.disabled())return g.reject();if(d.oldAPI)return d.error("errCmdNoSupport"),g.reject();for(i=$.param(d.options.customData||{}),i&&(i="&"+i),e+=-1===e.indexOf("?")?"?":"&",b=0;b<f.length;b++)h+='<iframe class="downloader" id="downloader-'+f[b].hash+'" style="display:none" src="'+e+"cmd=file&target="+f[b].hash+"&download=1"+i+'"/>';return $(h).appendTo("body").ready(function(){setTimeout(function(){$(h).each(function(){$("#"+$(this).attr("id")).remove()})},d.UA.Firefox?2e4+1e4*b:1e3)}),d.trigger("download",{files:f}),g.resolve(a)}},elFinder.prototype.commands.duplicate=function(){var a=this.fm;this.getstate=function(b){var b=this.files(b),c=b.length;return!this._disabled&&c&&a.cwd().write&&$.map(b,function(a){return a.phash&&a.read?a:null}).length==c?0:-1},this.exec=function(a){var b=this.fm,c=this.files(a),d=c.length,e=$.Deferred().fail(function(a){a&&b.error(a)});return!d||this._disabled?e.reject():($.each(c,function(a,c){return c.read&&b.file(c.phash).write?void 0:!e.reject(["errCopy",c.name,"errPerm"])}),"rejected"==e.state()?e:b.request({data:{cmd:"duplicate",targets:this.hashes(a)},notify:{type:"copy",cnt:d}}))}},elFinder.prototype.commands.edit=function(){var a=this,b=this.fm,c=(b.res("mimes","text")||[],function(a){return $.map(a,function(a){})}),d=function(c,d,e){var f=$.Deferred(),g=$('<textarea class="elfinder-file-edit" rows="20" id="'+c+'-ta">'+b.escape(e)+"</textarea>"),h=function(){g.editor&&g.editor.save(g[0],g.editor.instance),f.resolve(g.getContent()),g.elfinderdialog("close")},i=function(){f.reject(),g.elfinderdialog("close")},j={title:d.name,width:a.options.dialogWidth||450,buttons:{},close:function(){g.editor&&g.editor.close(g[0],g.editor.instance),$(this).elfinderdialog("destroy")},open:function(){b.disable(),g.focus(),g[0].setSelectionRange&&g[0].setSelectionRange(0,0),g.editor&&g.editor.load(g[0])}};return g.getContent=function(){return g.val()},$.each(a.options.editors||[],function(a,b){return-1!==$.inArray(d.mime,b.mimes||[])&&"function"==typeof b.load&&"function"==typeof b.save?(g.editor={load:b.load,save:b.save,close:"function"==typeof b.close?b.close:function(){},instance:null},!1):void 0}),g.editor||g.keydown(function(a){var b,c,d=a.keyCode;a.stopPropagation(),9==d&&(a.preventDefault(),this.setSelectionRange&&(b=this.value,c=this.selectionStart,this.value=b.substr(0,c)+"	"+b.substr(this.selectionEnd),c+=1,this.setSelectionRange(c,c))),(a.ctrlKey||a.metaKey)&&((81==d||87==d)&&(a.preventDefault(),i()),83==d&&(a.preventDefault(),h()))}),j.buttons[b.i18n("Save")]=h,j.buttons[b.i18n("Cancel")]=i,b.dialog(g,j).attr("id",c),f.promise()},e=function(a){var c,e=a.hash,f=(b.options,$.Deferred()),g=(b.url(e)||b.options.url,"edit-"+b.namespace+"-"+a.hash),h=b.getUI().find("#"+g);return h.length?(h.elfinderdialog("toTop"),f.resolve()):a.read&&a.write?(b.request({data:{cmd:"get",target:e},notify:{type:"openfile",cnt:1},syncOnFail:!0}).done(function(c){d(g,a,c.content).done(function(a){b.request({options:{type:"post"},data:{cmd:"put",target:e,content:a},notify:{type:"save",cnt:1},syncOnFail:!0}).fail(function(a){f.reject(a)}).done(function(a){a.changed&&a.changed.length&&b.change(a),f.resolve(a)})})}).fail(function(a){f.reject(a)}),f.promise()):(c=["errOpen",a.name,"errPerm"],b.error(c),f.reject(c))};this.shortcuts=[{pattern:"ctrl+e"}],this.init=function(){this.onlyMimes=this.options.mimes||[]},this.getstate=function(a){var a=this.files(a),b=a.length;return!this._disabled&&b&&c(a).length==b?0:-1},this.exec=function(a){var b,d=c(this.files(a)),f=[];if(this.disabled())return $.Deferred().reject();for(;b=d.shift();)f.push(e(b));return f.length?$.when.apply(null,f):$.Deferred().reject()}},elFinder.prototype.commands.extract=function(){var a=this,b=a.fm,c=[],d=function(a){return $.map(a,function(a){return a.read&&-1!==$.inArray(a.mime,c)?a:null})};this.disableOnSearch=!0,b.bind("open reload",function(){c=b.option("archivers").extract||[],a.change()}),this.getstate=function(a){var a=this.files(a),b=a.length;return!this._disabled&&b&&this.fm.cwd().write&&d(a).length==b?0:-1},this.exec=function(a){var d,e,f,g=this.files(a),h=$.Deferred(),i=g.length,j=!1,k=!1,l=$.map(b.files(a),function(a){return a.name}),m={};$.map(b.files(a),function(a){m[a.name]=a});var n=function(a){switch(a){case"overwrite_all":j=!0;break;case"omit_all":k=!0}},o=function(a){a.read&&b.file(a.phash).write?-1===$.inArray(a.mime,c)?(e=["errExtract",a.name,"errNoArchive"],b.error(e),h.reject(e)):b.request({data:{cmd:"extract",target:a.hash},notify:{type:"extract",cnt:1},syncOnFail:!0}).fail(function(a){"rejected"!=h.state()&&h.reject(a)}).done(function(){}):(e=["errExtract",a.name,"errPerm"],b.error(e),h.reject(e))},p=function(a,c){var e=a[c],g=e.name.replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/gi,""),q=$.inArray(g,l)>=0;q&&"directory"!=m[g].mime?b.confirm({title:b.i18n("ntfextract"),text:b.i18n(["errExists",g,"confirmRepl"]),accept:{label:"btnYes",callback:function(b){if(f=b?"overwrite_all":"overwrite",n(f),j||k){if(j){for(d=0;i>d;d++)o(a[d]);h.resolve()}}else"overwrite"==f&&o(e),i>c+1?p(a,c+1):h.resolve()}},reject:{label:"btnNo",callback:function(b){f=b?"omit_all":"omit",n(f),!j&&!k&&i>c+1?p(a,c+1):k&&h.resolve()}},cancel:{label:"btnCancel",callback:function(){h.resolve()}},all:i>1}):(o(e),i>c+1?p(a,c+1):h.resolve())};return this.enabled()&&i&&c.length?(i>0&&p(g,0),h):h.reject()}},elFinder.prototype.commands.forward=function(){this.alwaysEnabled=!0,this.updateOnSelect=!0,this.shortcuts=[{pattern:"ctrl+right"}],this.getstate=function(){return this.fm.history.canForward()?0:-1},this.exec=function(){return this.fm.history.forward()}},elFinder.prototype.commands.getfile=function(){var a=this,b=this.fm,c=function(b){var c=a.options;return b=$.map(b,function(a){return"directory"!=a.mime||c.folders?a:null}),c.multiple||1==b.length?b:[]};this.alwaysEnabled=!0,this.callback=b.options.getFileCallback,this._disabled="function"==typeof this.callback,this.getstate=function(a){var a=this.files(a),b=a.length;return this.callback&&b&&c(a).length==b?0:-1},this.exec=function(b){var c,d,e,f=this.fm,g=this.options,h=this.files(b),i=h.length,j=f.option("url"),k=f.option("tmbUrl"),l=$.Deferred().done(function(b){f.trigger("getfile",{files:b}),a.callback(b,f),"close"==g.oncomplete?f.hide():"destroy"==g.oncomplete&&f.destroy()}),m=function(){return g.onlyURL?g.multiple?$.map(h,function(a){return a.url}):h[0].url:g.multiple?h:h[0]},n=[];if(-1==this.getstate())return l.reject();for(c=0;i>c;c++){if(d=h[c],"directory"==d.mime&&!g.folders)return l.reject();d.baseUrl=j,d.url=f.url(d.hash),d.path=f.path(d.hash),d.tmb&&1!=d.tmb&&(d.tmb=k+d.tmb),d.width||d.height||(d.dim?(e=d.dim.split("x"),d.width=e[0],d.height=e[1]):-1!==d.mime.indexOf("image")&&n.push(f.request({data:{cmd:"dim",target:d.hash},notify:{type:"dim",cnt:1,hideCnt:!0},preventDefault:!0}).done(function(a){if(a.dim){var b=a.dim.split("x"),c=f.file(this.hash);c.width=this.width=b[0],c.height=this.height=b[1]}}.bind(d))))}return n.length?($.when.apply(null,n).always(function(){l.resolve(m(h))}),l):l.resolve(m(h))}},elFinder.prototype.commands.help=function(){var a,b=this.fm,c=this,d='<div class="elfinder-help-link"> <a href="{url}" target="_blank">{link}</a></div>',e='<div class="elfinder-help-team"><div>{author}</div>{work}</div>',f=/\{url\}/,g=/\{link\}/,h=/\{author\}/,i=/\{work\}/,j="replace",k="ui-priority-primary",l="ui-priority-secondary",m="elfinder-help-license",n='<li class="ui-state-default ui-corner-top"><a href="#{id}">{title}</a></li>',o=['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">','<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">'],p='<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}</div> {descrip}</div>',q='<div class="elfinder-help-separator"/>',r=function(){o.push('<div id="about" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"/>'),o.push("<h3>elFinder</h3>"),o.push('<div class="'+k+'">'+b.i18n("webfm")+"</div>"),o.push('<div class="'+l+'">'+b.i18n("ver")+": "+b.version+", "+b.i18n("protocolver")+': <span id="apiver"></span></div>'),o.push('<div class="'+l+'">jQuery/jQuery UI: '+$().jquery+"/"+$.ui.version+"</div>"),o.push(q),o.push(d[j](f,"http://elfinder.org/")[j](g,b.i18n("homepage"))),o.push(d[j](f,"https://github.com/Studio-42/elFinder/wiki")[j](g,b.i18n("docs"))),o.push(d[j](f,"https://github.com/Studio-42/elFinder")[j](g,b.i18n("github"))),o.push(d[j](f,"http://twitter.com/elrte_elfinder")[j](g,b.i18n("twitter"))),o.push(q),o.push('<div class="'+k+'">'+b.i18n("team")+"</div>"),o.push(e[j](h,'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;')[j](i,b.i18n("chiefdev"))),o.push(e[j](h,"Troex Nevelin &lt;troex@fury.scancode.ru&gt;")[j](i,b.i18n("maintainer"))),o.push(e[j](h,"Alexey Sukhotin &lt;strogg@yandex.ru&gt;")[j](i,b.i18n("contributor"))),o.push(e[j](h,"Naoki Sawada &lt;hypweb@gmail.com&gt;")[j](i,b.i18n("contributor"))),b.i18[b.lang].translator&&o.push(e[j](h,b.i18[b.lang].translator)[j](i,b.i18n("translator")+" ("+b.i18[b.lang].language+")")),o.push(q),o.push('<div class="'+m+'">'+b.i18n("icons")+': Pixelmixer, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue</a></div>'),o.push(q),o.push('<div class="'+m+'">Licence: BSD Licence</div>'),o.push('<div class="'+m+'">Copyright © 2009-2011, Studio 42</div>'),o.push('<div class="'+m+'">„ …'+b.i18n("dontforget")+" ”</div>"),o.push("</div>")
},s=function(){var a=b.shortcuts();o.push('<div id="shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),a.length?(o.push('<div class="ui-widget-content elfinder-help-shortcuts">'),$.each(a,function(a,b){o.push(p.replace(/\{pattern\}/,b[0]).replace(/\{descrip\}/,b[1]))}),o.push("</div>")):o.push('<div class="elfinder-help-disabled">'+b.i18n("shortcutsof")+"</div>"),o.push("</div>")},t=function(){o.push('<div id="help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">'),o.push('<a href="http://elfinder.org/forum/" target="_blank" class="elfinder-dont-panic"><span>DON\'T PANIC</span></a>'),o.push("</div>")};this.alwaysEnabled=!0,this.updateOnSelect=!1,this.state=0,this.shortcuts=[{pattern:"f1",description:this.title}],setTimeout(function(){var d=c.options.view||["about","shortcuts","help"];$.each(d,function(a,c){o.push(n[j](/\{id\}/,c)[j](/\{title\}/,b.i18n(c)))}),o.push("</ul>"),-1!==$.inArray("about",d)&&r(),-1!==$.inArray("shortcuts",d)&&s(),-1!==$.inArray("help",d)&&t(),o.push("</div>"),a=$(o.join("")),b.one("load",function(){a.find("#apiver").text(b.api)}),a.find(".ui-tabs-nav li").hover(function(){$(this).toggleClass("ui-state-hover")}).children().click(function(b){var c=$(this);b.preventDefault(),b.stopPropagation(),c.is(".ui-tabs-selected")||(c.parent().addClass("ui-tabs-selected ui-state-active").siblings().removeClass("ui-tabs-selected").removeClass("ui-state-active"),a.find(".ui-tabs-panel").hide().filter(c.attr("href")).show())}).filter(":first").click()},200),this.getstate=function(){return 0},this.exec=function(){this.dialog||(this.dialog=this.fm.dialog(a,{title:this.title,width:530,autoOpen:!1,destroyOnClose:!1})),this.dialog.elfinderdialog("open").find(".ui-tabs-nav li a:first").click()}},elFinder.prototype.commands.home=function(){this.title="Home",this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}],this.getstate=function(){var a=this.fm.root(),b=this.fm.cwd().hash;return a&&b&&a!=b?0:-1},this.exec=function(){return this.fm.exec("open",this.fm.root())}},elFinder.prototype.commands.info=function(){var a=this.fm,b="elfinder-info-spinner",c={calc:a.i18n("calc"),size:a.i18n("size"),unknown:a.i18n("unknown"),path:a.i18n("path"),aliasfor:a.i18n("aliasfor"),modify:a.i18n("modify"),perms:a.i18n("perms"),locked:a.i18n("locked"),dim:a.i18n("dim"),kind:a.i18n("kind"),files:a.i18n("files"),folders:a.i18n("folders"),items:a.i18n("items"),yes:a.i18n("yes"),no:a.i18n("no"),link:a.i18n("link")};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}</div><table class="elfinder-info-tb">{content}</table>',itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",row:"<tr><td>{label} : </td><td>{value}</td></tr>",spinner:'<span>{text}</span> <span class="'+b+'"/>'},this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+i"}],this.init=function(){$.each(c,function(b,d){c[b]=a.i18n(d)})},this.getstate=function(){return 0},this.exec=function(a){var d=this.files(a);d.length||(d=this.files([this.fm.cwd().hash]));var e,f,g,h,i,j=this.fm,k=this.options,l=this.tpl,m=l.row,n=d.length,o=[],p=l.main,q="{label}",r="{value}",s={title:this.title,width:"auto",close:function(){$(this).elfinderdialog("destroy")}},t=[],u=function(a){w.find("."+b).parent().text(a)},v=j.namespace+"-info-"+$.map(d,function(a){return a.hash}).join("-"),w=j.getUI().find("#"+v);if(!n)return $.Deferred().reject();if(w.length)return w.elfinderdialog("toTop"),$.Deferred().resolve();if(1==n){if(g=d[0],p=p.replace("{class}",j.mime2class(g.mime)),h=l.itemTitle.replace("{name}",j.escape(g.i18||g.name)).replace("{kind}",j.mime2kind(g)),g.tmb&&(f=j.option("tmbUrl")+g.tmb),g.read?"directory"!=g.mime||g.alias?e=j.formatSize(g.size):(e=l.spinner.replace("{text}",c.calc),t.push(g.hash)):e=c.unknown,o.push(m.replace(q,c.size).replace(r,e)),g.alias&&o.push(m.replace(q,c.aliasfor).replace(r,g.alias)),o.push(m.replace(q,c.path).replace(r,j.escape(j.path(g.hash,!0)))),g.read){var x;if(k.nullUrlDirLinkSelf&&"directory"==g.mime&&null===g.url){var y=window.location;x=y.pathname+y.search+"#elf_"+g.hash}else x=j.url(g.hash);o.push(m.replace(q,c.link).replace(r,'<a href="'+x+'" target="_blank">'+g.name+"</a>"))}g.dim?o.push(m.replace(q,c.dim).replace(r,g.dim)):-1!==g.mime.indexOf("image")&&(g.width&&g.height?o.push(m.replace(q,c.dim).replace(r,g.width+"x"+g.height)):(o.push(m.replace(q,c.dim).replace(r,l.spinner.replace("{text}",c.calc))),j.request({data:{cmd:"dim",target:g.hash},preventDefault:!0}).fail(function(){u(c.unknown)}).done(function(a){if(u(a.dim||c.unknown),a.dim){var b=a.dim.split("x"),d=j.file(g.hash);d.width=b[0],d.height=b[1]}}))),o.push(m.replace(q,c.modify).replace(r,j.formatDate(g))),o.push(m.replace(q,c.perms).replace(r,j.formatPermissions(g))),o.push(m.replace(q,c.locked).replace(r,g.locked?c.yes:c.no))}else p=p.replace("{class}","elfinder-cwd-icon-group"),h=l.groupTitle.replace("{items}",c.items).replace("{num}",n),i=$.map(d,function(a){return"directory"==a.mime?1:null}).length,i?(o.push(m.replace(q,c.kind).replace(r,i==n?c.folders:c.folders+" "+i+", "+c.files+" "+(n-i))),o.push(m.replace(q,c.size).replace(r,l.spinner.replace("{text}",c.calc))),t=$.map(d,function(a){return a.hash})):(e=0,$.each(d,function(a,b){var c=parseInt(b.size);c>=0&&e>=0?e+=c:e="unknown"}),o.push(m.replace(q,c.kind).replace(r,c.files)),o.push(m.replace(q,c.size).replace(r,j.formatSize(e))));p=p.replace("{title}",h).replace("{content}",o.join("")),w=j.dialog(p,s),w.attr("id",v),f&&$("<img/>").load(function(){w.find(".elfinder-cwd-icon").css("background",'url("'+f+'") center center no-repeat')}).attr("src",f),t.length&&j.request({data:{cmd:"size",targets:t},preventDefault:!0}).fail(function(){u(c.unknown)}).done(function(a){var b=parseInt(a.size);u(b>=0?j.formatSize(b):c.unknown)})}},elFinder.prototype.commands.mkdir=function(){this.disableOnSearch=!0,this.updateOnSelect=!1,this.mime="directory",this.prefix="untitled folder",this.exec=$.proxy(this.fm.res("mixin","make"),this),this.shortcuts=[{pattern:"ctrl+shift+n"}],this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1}},elFinder.prototype.commands.mkfile=function(){this.disableOnSearch=!0,this.updateOnSelect=!1,this.mime="text/plain",this.prefix="untitled file.txt",this.exec=$.proxy(this.fm.res("mixin","make"),this),this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1}},elFinder.prototype.commands.netmount=function(){var a=this;this.alwaysEnabled=!0,this.updateOnSelect=!1,this.drivers=[],this.handlers={load:function(){this.drivers=this.fm.netDrivers}},this.getstate=function(){return this.drivers.length?0:-1},this.exec=function(){var b=a.fm,c=$.Deferred(),d=function(){var d={protocol:$("<select/>"),host:$('<input type="text"/>'),port:$('<input type="text"/>'),path:$('<input type="text" value="/"/>'),user:$('<input type="text"/>'),pass:$('<input type="password"/>')},e={title:b.i18n("netMountDialogTitle"),resizable:!1,modal:!0,destroyOnClose:!0,close:function(){delete a.dialog,"pending"==c.state()&&c.reject()},buttons:{}},f=$('<table class="elfinder-info-tb elfinder-netmount-tb"/>');return $.each(a.drivers,function(a,c){d.protocol.append('<option value="'+c+'">'+b.i18n(c)+"</option>")}),$.each(d,function(a,c){"protocol"!=a&&c.addClass("ui-corner-all"),f.append($("<tr/>").append($("<td>"+b.i18n(a)+"</td>")).append($("<td/>").append(c)))}),e.buttons[b.i18n("btnMount")]=function(){var b={cmd:"netmount"};return $.each(d,function(a,c){var d=$.trim(c.val());d&&(b[a]=d)}),b.host?(a.fm.request({data:b,notify:{type:"netmount",cnt:1}}).done(function(){c.resolve()}).fail(function(a){c.reject(a)}),void a.dialog.elfinderdialog("close")):a.fm.trigger("error",{error:"errNetMountHostReq"})},e.buttons[b.i18n("btnCancel")]=function(){a.dialog.elfinderdialog("close")},b.dialog(f,e)};return a.dialog||(a.dialog=d()),c.promise()}},elFinder.prototype.commands.open=function(){this.alwaysEnabled=!0,this._handlers={dblclick:function(a){a.preventDefault(),this.exec()},"select enable disable reload":function(a){this.update("disable"==a.type?-1:void 0)}},this.shortcuts=[{pattern:"ctrl+down numpad_enter"+("mac"!=this.fm.OS&&" enter")}],this.getstate=function(a){var a=this.files(a),b=a.length;return 1==b?0:b&&$.map(a,function(a){return"directory"==a.mime?null:a}).length==b?0:-1},this.exec=function(a){var b,c,d,e,f=this.fm,g=$.Deferred().fail(function(a){a&&f.error(a)}),h=this.files(a),i=h.length;if(!i)return g.reject();if(1==i&&(b=h[0])&&"directory"==b.mime)return b&&!b.read?g.reject(["errOpen",b.name,"errPerm"]):f.request({data:{cmd:"open",target:b.thash||b.hash},notify:{type:"open",cnt:1,hideCnt:!0},syncOnFail:!0});if(h=$.map(h,function(a){return"directory"!=a.mime?a:null}),i!=h.length)return g.reject();for(i=h.length;i--;){if(b=h[i],!b.read)return g.reject(["errOpen",b.name,"errPerm"]);(c=f.url(b.hash))||(c=f.options.url,c=c+(-1===c.indexOf("?")?"?":"&")+(f.oldAPI?"cmd=open&current="+b.phash:"cmd=file")+"&target="+b.hash),b.dim?(d=b.dim.split("x"),e="width="+(parseInt(d[0])+20)+",height="+(parseInt(d[1])+20)):e="width="+parseInt(2*$(window).width()/3)+",height="+parseInt(2*$(window).height()/3);var j=window.open("","new_window",e+",top=50,left=50,scrollbars=yes,resizable=yes");if(!j)return g.reject("errPopup");var k=document.createElement("form");k.action=f.options.url,k.method="GET",k.target="new_window",k.style.display="none";var l=$.extend({},f.options.customData,{cmd:"file",target:b.hash,"X-Csrf-Token":$.ajaxSettings.headers["X-Csrf-Token"]});$.each(l,function(a,b){var c=document.createElement("input");c.name=a,c.value=b,k.appendChild(c)}),document.body.appendChild(k),k.submit()}return g.resolve(a)}},elFinder.prototype.commands.paste=function(){this.updateOnSelect=!1,this.handlers={changeclipboard:function(){this.update()}},this.shortcuts=[{pattern:"ctrl+v shift+insert"}],this.getstate=function(a){if(this._disabled)return-1;if(a){if($.isArray(a)){if(1!=a.length)return-1;a=this.fm.file(a[0])}}else a=this.fm.cwd();return this.fm.clipboard().length&&"directory"==a.mime&&a.write?0:-1},this.exec=function(a){var b,c,d=this,e=d.fm,a=a?this.files(a)[0]:e.cwd(),f=e.clipboard(),g=f.length,h=g?f[0].cut:!1,i=h?"errMove":"errCopy",j=[],k=[],l=$.Deferred().fail(function(a){a&&e.error(a)}),m=function(a){return a.length&&e._commands.duplicate?e.exec("duplicate",a):$.Deferred().resolve()},n=function(b){var c=$.Deferred(),f=[],g=function(a,b){for(var c=[],d=a.length;d--;)-1!==$.inArray(a[d].name,b)&&c.unshift(d);return c},i=function(a){var d=f[a],g=b[d],j=a==f.length-1;g&&e.confirm({title:e.i18n(h?"moveFiles":"copyFiles"),text:e.i18n(["errExists",g.name,"confirmRepl"]),all:!j,accept:{label:"btnYes",callback:function(c){j||c?k(b):i(++a)}},reject:{label:"btnNo",callback:function(c){var d;if(c)for(d=f.length;a<d--;)b[f[d]].remove=!0;else b[f[a]].remove=!0;j||c?k(b):i(++a)}},cancel:{label:"btnCancel",callback:function(){c.resolve()}}})},j=function(a){f=g(b,a),f.length?i(0):k(b)},k=function(b){var d,b=$.map(b,function(a){return a.remove?null:a}),f=b.length;return f?(d=b[0].phash,b=$.map(b,function(a){return a.hash}),void e.request({data:{cmd:"paste",dst:a.hash,targets:b,cut:h?1:0,src:d},notify:{type:h?"move":"copy",cnt:f}}).always(function(){c.resolve(),e.unlockfiles({files:b})})):c.resolve()};return d._disabled||!b.length?c.resolve():(e.oldAPI?k(b):e.option("copyOverwrite")?a.hash==e.cwd().hash?j($.map(e.files(),function(b){return b.phash==a.hash?b.name:null})):e.request({data:{cmd:"ls",target:a.hash},notify:{type:"prepare",cnt:1,hideCnt:!0},preventFail:!0}).always(function(a){j(a.list||[])}):k(b),c)};return g&&a&&"directory"==a.mime?a.write?(b=e.parents(a.hash),$.each(f,function(d,g){return g.read?h&&g.locked?!l.reject(["errLocked",g.name]):-1!==$.inArray(g.hash,b)?!l.reject(["errCopyInItself",g.name]):(c=e.parents(g.hash),c.pop(),-1!==$.inArray(a.hash,c)&&$.map(c,function(b){var c=e.file(b);return c.phash==a.hash&&c.name==g.name?c:null}).length?!l.reject(["errReplByChild",g.name]):void(g.phash==a.hash?k.push(g.hash):j.push({hash:g.hash,phash:g.phash,name:g.name}))):!l.reject([i,f[0].name,"errPerm"])}),"rejected"==l.state()?l:$.when(m(k),n(j)).always(function(){h&&e.clipboard([])})):l.reject([i,f[0].name,"errPerm"]):l.reject()}},elFinder.prototype.commands.quicklook=function(){var a,b,c,d,e=this,f=e.fm,g=0,h=1,i=2,j=g,k="elfinder-quicklook-navbar-icon",l="elfinder-quicklook-fullscreen",m=function(a){$(document).trigger($.Event("keydown",{keyCode:a,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1}))},n=function(a){return{opacity:0,width:20,height:"list"==f.view?1:20,top:a.offset().top+"px",left:a.offset().left+"px"}},o=function(){var c=$(window);return{opacity:1,width:a,height:b,top:parseInt((c.height()-b)/2+c.scrollTop()),left:parseInt((c.width()-a)/2+c.scrollLeft())}},p=function(a){var b=document.createElement(a.substr(0,a.indexOf("/"))),c=!1;try{c=b.canPlayType&&b.canPlayType(a)}catch(d){}return c&&""!==c&&"no"!=c},q=$('<div class="elfinder-quicklook-title"/>'),r=$("<div/>"),s=$('<div class="elfinder-quicklook-info"/>'),t=$('<div class="'+k+" "+k+'-fullscreen"/>').mousedown(function(a){var b=e.window,d=b.is("."+l),g="scroll."+f.namespace,h=$(window);a.stopPropagation(),d?(b.css(b.data("position")).unbind("mousemove"),h.unbind(g).trigger(e.resize).unbind(e.resize),u.unbind("mouseenter").unbind("mousemove")):(b.data("position",{left:b.css("left"),top:b.css("top"),width:b.width(),height:b.height()}).css({width:"100%",height:"100%"}),$(window).bind(g,function(){b.css({left:parseInt($(window).scrollLeft())+"px",top:parseInt($(window).scrollTop())+"px"})}).bind(e.resize,function(){e.preview.trigger("changesize")}).trigger(g).trigger(e.resize),b.bind("mousemove",function(){u.stop(!0,!0).show().delay(3e3).fadeOut("slow")}).mousemove(),u.mouseenter(function(){u.stop(!0,!0).show()}).mousemove(function(a){a.stopPropagation()})),u.attr("style","").draggable(d?"destroy":{}),b.toggleClass(l),$(this).toggleClass(k+"-fullscreen-off"),$.fn.resizable&&c.add(b).resizable(d?"enable":"disable").removeClass("ui-state-disabled")}),u=$('<div class="elfinder-quicklook-navbar"/>').append($('<div class="'+k+" "+k+'-prev"/>').mousedown(function(){m(37)})).append(t).append($('<div class="'+k+" "+k+'-next"/>').mousedown(function(){m(39)})).append('<div class="elfinder-quicklook-navbar-separator"/>').append($('<div class="'+k+" "+k+'-close"/>').mousedown(function(){e.window.trigger("close")}));this.resize="resize."+f.namespace,this.info=$('<div class="elfinder-quicklook-info-wrapper"/>').append(r).append(s),this.preview=$('<div class="elfinder-quicklook-preview ui-helper-clearfix"/>').bind("change",function(){e.info.attr("style","").hide(),r.removeAttr("class").attr("style",""),s.html("")}).bind("update",function(a){var b,c=e.fm,d=(e.preview,a.file),f='<div class="elfinder-quicklook-info-data">{value}</div>';d?(!d.read&&a.stopImmediatePropagation(),e.window.data("hash",d.hash),e.preview.unbind("changesize").trigger("change").children().remove(),q.html(c.escape(d.name)),s.html(f.replace(/\{value\}/,d.name)+f.replace(/\{value\}/,c.mime2kind(d))+("directory"==d.mime?"":f.replace(/\{value\}/,c.formatSize(d.size)))+f.replace(/\{value\}/,c.i18n("modify")+": "+c.formatDate(d))),r.addClass("elfinder-cwd-icon ui-corner-all "+c.mime2class(d.mime)),d.tmb&&$("<img/>").hide().appendTo(e.preview).load(function(){r.css("background",'url("'+b+'") center center no-repeat'),$(this).remove()}).attr("src",b=c.tmb(d.hash)),e.info.delay(100).fadeIn(10)):a.stopImmediatePropagation()}),this.window=$('<div class="ui-helper-reset ui-widget elfinder-quicklook" style="position:absolute"/>').click(function(a){a.stopPropagation()}).append($('<div class="elfinder-quicklook-titlebar"/>').append(q).append($('<span class="ui-icon ui-icon-circle-close"/>').mousedown(function(a){a.stopPropagation(),e.window.trigger("close")}))).append(this.preview.add(u)).append(e.info.hide()).draggable({handle:"div.elfinder-quicklook-titlebar"}).bind("open",function(){var a,b=e.window,c=e.value;e.closed()&&c&&(a=d.find("#"+c.hash)).length&&(u.attr("style",""),j=h,a.trigger("scrolltoview"),b.css(n(a)).show().animate(o(),550,function(){j=i,e.update(1,e.value)}))}).bind("close",function(){var a=e.window,b=e.preview.trigger("change"),c=(e.value,d.find("#"+a.data("hash"))),f=function(){j=g,a.hide(),b.children().remove(),e.update(0,e.value)};e.opened()&&(j=h,a.is("."+l)&&t.mousedown(),c.length?a.animate(n(c),500,f):f())}),this.alwaysEnabled=!0,this.value=null,this.handlers={select:function(){this.update(void 0,this.fm.selectedFiles()[0])},error:function(){e.window.is(":visible")&&e.window.data("hash","").trigger("close")},"searchshow searchhide":function(){this.opened()&&this.window.trigger("close")}},this.shortcuts=[{pattern:"space"}],this.support={audio:{ogg:p('audio/ogg; codecs="vorbis"'),mp3:p("audio/mpeg;"),wav:p('audio/wav; codecs="1"'),m4a:p("audio/x-m4a;")||p("audio/aac;")},video:{ogg:p('video/ogg; codecs="theora"'),webm:p('video/webm; codecs="vp8, vorbis"'),mp4:p('video/mp4; codecs="avc1.42E01E"')||p('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')}},this.closed=function(){return j==g},this.opened=function(){return j==i},this.init=function(){var g=this.options,h=this.window,i=this.preview;a=g.width>0?parseInt(g.width):450,b=g.height>0?parseInt(g.height):300,f.one("load",function(){c=f.getUI(),d=f.getUI("cwd"),h.appendTo("body").zIndex(100+c.zIndex()),$(document).keydown(function(a){27==a.keyCode&&e.opened()&&h.trigger("close")}),$.fn.resizable&&h.resizable({handles:"se",minWidth:350,minHeight:120,resize:function(){i.trigger("changesize")}}),e.change(function(){e.opened()&&(e.value?i.trigger($.Event("update",{file:e.value})):h.trigger("close"))}),$.each(f.commands.quicklook.plugins||[],function(a,b){"function"==typeof b&&new b(e)}),i.bind("update",function(){e.info.show()})})},this.getstate=function(){return 1==this.fm.selected().length?j==i?1:0:-1},this.exec=function(){this.enabled()&&this.window.trigger(this.opened()?"close":"open")},this.hideinfo=function(){this.info.stop(!0).hide()}},elFinder.prototype.commands.quicklook.plugins=[function(a){var b=["image/jpeg","image/png","image/gif"],c=a.preview;$.each(navigator.mimeTypes,function(a,c){var d=c.type;0===d.indexOf("image/")&&$.inArray(d,b)&&b.push(d)}),c.bind("update",function(d){var e,f=d.file;-1!==$.inArray(f.mime,b)&&(d.stopImmediatePropagation(),e=$("<img/>").hide().appendTo(c).load(function(){setTimeout(function(){var b=(e.width()/e.height()).toFixed(2);c.bind("changesize",function(){var a,d,f=parseInt(c.width()),g=parseInt(c.height());b<(f/g).toFixed(2)?(d=g,a=Math.floor(d*b)):(a=f,d=Math.floor(a/b)),e.width(a).height(d).css("margin-top",g>d?Math.floor((g-d)/2):0)}).trigger("changesize"),a.hideinfo(),e.fadeIn(100)},1)}).attr("src",a.fm.url(f.hash)))})},function(a){var b=["text/html","application/xhtml+xml"],c=a.preview,d=a.fm;c.bind("update",function(e){var f,g=e.file;-1!==$.inArray(g.mime,b)&&(e.stopImmediatePropagation(),c.one("change",function(){"pending"==f.state()&&f.reject()}),f=d.request({data:{cmd:"get",target:g.hash,current:g.phash},preventDefault:!0}).done(function(b){a.hideinfo(),doc=$('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(c)[0].contentWindow.document,doc.open(),doc.write(b.content),doc.close()}))})},function(a){var b=a.fm,c=b.res("mimes","text"),d=a.preview;d.bind("update",function(e){var f,g=e.file,h=g.mime;(0===h.indexOf("text/")||-1!==$.inArray(h,c))&&(e.stopImmediatePropagation(),d.one("change",function(){"pending"==f.state()&&f.reject()}),f=b.request({data:{cmd:"get",target:g.hash},preventDefault:!0}).done(function(c){a.hideinfo(),$('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text">'+b.escape(c.content)+"</pre></div>").appendTo(d)}))})},function(a){var b=a.fm,c="application/pdf",d=a.preview,e=!1;b.UA.Safari&&"mac"==b.OS||b.UA.IE?e=!0:$.each(navigator.plugins,function(a,b){$.each(b,function(a,b){return b.type==c?!(e=!0):void 0})}),e&&d.bind("update",function(e){var f,g=e.file;g.mime==c&&(e.stopImmediatePropagation(),d.one("change",function(){f.unbind("load").remove()}),f=$('<iframe class="elfinder-quicklook-preview-pdf"/>').hide().appendTo(d).load(function(){a.hideinfo(),f.show()}).attr("src",b.url(g.hash)))})},function(a){var b=a.fm,c="application/x-shockwave-flash",d=a.preview,e=!1;$.each(navigator.plugins,function(a,b){$.each(b,function(a,b){return b.type==c?!(e=!0):void 0})}),e&&d.bind("update",function(e){var f,g=e.file;g.mime==c&&(e.stopImmediatePropagation(),a.hideinfo(),d.append(f=$('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+b.url(g.hash)+'" quality="high" type="application/x-shockwave-flash" />')))})},function(a){var b,c=a.preview,d=!!a.options.autoplay,e={"audio/mpeg":"mp3","audio/mpeg3":"mp3","audio/mp3":"mp3","audio/x-mpeg3":"mp3","audio/x-mp3":"mp3","audio/x-wav":"wav","audio/wav":"wav","audio/x-m4a":"m4a","audio/aac":"m4a","audio/mp4":"m4a","audio/x-mp4":"m4a","audio/ogg":"ogg"};c.bind("update",function(f){var g=f.file,h=e[g.mime];a.support.audio[h]&&(f.stopImmediatePropagation(),b=$('<audio class="elfinder-quicklook-preview-audio" controls preload="auto" autobuffer><source src="'+a.fm.url(g.hash)+'" /></audio>').appendTo(c),d&&b[0].play())}).bind("change",function(){b&&b.parent().length&&(b[0].pause(),b.remove(),b=null)})},function(a){var b,c=a.preview,d=!!a.options.autoplay,e={"video/mp4":"mp4","video/x-m4v":"mp4","video/ogg":"ogg","application/ogg":"ogg","video/webm":"webm"};c.bind("update",function(f){var g=f.file,h=e[g.mime];a.support.video[h]&&(f.stopImmediatePropagation(),a.hideinfo(),b=$('<video class="elfinder-quicklook-preview-video" controls preload="auto" autobuffer><source src="'+a.fm.url(g.hash)+'" /></video>').appendTo(c),d&&b[0].play())}).bind("change",function(){b&&b.parent().length&&(b[0].pause(),b.remove(),b=null)})},function(a){var b,c=a.preview,d=[];$.each(navigator.plugins,function(a,b){$.each(b,function(a,b){(0===b.type.indexOf("audio/")||0===b.type.indexOf("video/"))&&d.push(b.type)})}),c.bind("update",function(e){var f,g=e.file,h=g.mime;-1!==$.inArray(g.mime,d)&&(e.stopImmediatePropagation(),(f=0===h.indexOf("video/"))&&a.hideinfo(),b=$('<embed src="'+a.fm.url(g.hash)+'" type="'+h+'" class="elfinder-quicklook-preview-'+(f?"video":"audio")+'"/>').appendTo(c))}).bind("change",function(){b&&b.parent().length&&(b.remove(),b=null)})}],elFinder.prototype.commands.reload=function(){this.alwaysEnabled=!0,this.updateOnSelect=!0,this.shortcuts=[{pattern:"ctrl+shift+r f5"}],this.getstate=function(){return 0},this.exec=function(){var a=this.fm,b=a.sync(),c=setTimeout(function(){a.notify({type:"reload",cnt:1,hideCnt:!0}),b.always(function(){a.notify({type:"reload",cnt:-1})})},a.notifyDelay);return b.always(function(){clearTimeout(c),a.trigger("reload")})}},elFinder.prototype.commands.rename=function(){this.shortcuts=[{pattern:"f2"+("mac"==this.fm.OS?" enter":"")}],this.getstate=function(){var a=this.fm.selectedFiles();return this._disabled||1!=a.length||!a[0].phash||a[0].locked?-1:0},this.exec=function(){var a=this.fm,b=a.getUI("cwd"),c=a.selected(),d=c.length,e=a.file(c.shift()),f=".elfinder-cwd-filename",g=$.Deferred().fail(function(c){var d=h.parent(),g=a.escape(e.name);d.length?(h.remove(),d.html(g)):(b.find("#"+e.hash).find(f).html(g),setTimeout(function(){b.find("#"+e.hash).click()},50)),c&&a.error(c)}).always(function(){a.enable()}),h=$('<input type="text"/>').keydown(function(a){a.stopPropagation(),a.stopImmediatePropagation(),a.keyCode==$.ui.keyCode.ESCAPE?g.reject():a.keyCode==$.ui.keyCode.ENTER&&h.blur()}).mousedown(function(a){a.stopPropagation()}).dblclick(function(a){a.stopPropagation(),a.preventDefault()}).blur(function(){var b=$.trim(h.val()),c=h.parent();if(c.length){if(h[0].setSelectionRange&&h[0].setSelectionRange(0,0),b==e.name)return g.reject();if(!b)return g.reject("errInvName");if(a.fileByName(b,e.phash))return g.reject(["errExists",b]);c.html(a.escape(b)),a.lockfiles({files:[e.hash]}),a.request({data:{cmd:"rename",target:e.hash,name:b},notify:{type:"rename",cnt:1}}).fail(function(){g.reject(),a.sync()}).done(function(a){g.resolve(a)}).always(function(){a.unlockfiles({files:[e.hash]})})}}),i=b.find("#"+e.hash).find(f).empty().append(h.val(e.name)),j=h.val().replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/gi,"");return this.disabled()?g.reject():!e||d>1||!i.length?g.reject("errCmdParams",this.title):e.locked?g.reject(["errLocked",e.name]):(a.one("select",function(){h.parent().length&&e&&-1===$.inArray(e.hash,a.selected())&&h.blur()}),h.select().focus(),h[0].setSelectionRange&&h[0].setSelectionRange(0,j.length),g)}},elFinder.prototype.commands.resize=function(){this.updateOnSelect=!1,this.getstate=function(){this.fm.selectedFiles()},this.exec=function(a){var b,c,d=this.fm,e=this.files(a),f=$.Deferred(),g=function(a,b){var c=$('<div class="elfinder-dialog-resize"/>'),e='<input type="text" size="5"/>',g='<div class="elfinder-resize-row"/>',h='<div class="elfinder-resize-label"/>',i=$('<div class="elfinder-resize-control"/>'),j=$('<div class="elfinder-resize-preview"/>'),k=$('<div class="elfinder-resize-spinner">'+d.i18n("ntfloadimg")+"</div>"),l=$('<div class="elfinder-resize-handle"/>'),m=$('<div class="elfinder-resize-handle"/>'),n=$('<div class="elfinder-resize-uiresize"/>'),o=$('<div class="elfinder-resize-uicrop"/>'),p='<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>',q='<div class="ui-state-default elfinder-button"/>',r='<span class="ui-widget-content elfinder-toolbar-button-separator"/>',s=$('<div class="elfinder-resize-rotate"/>'),t=$(q).attr("title",d.i18n("rotate-cw")).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-l"/>').click(function(){R-=90,_.update(R)})),u=$(q).attr("title",d.i18n("rotate-ccw")).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-r"/>').click(function(){R+=90,_.update(R)})),v=$("<span />"),w=$('<div class="ui-state-default ui-corner-all elfinder-resize-reset"><span class="ui-icon ui-icon-arrowreturnthick-1-w"/></div>'),x=$('<div class="elfinder-resize-type"/>').append('<input type="radio" name="type" id="'+b+'-resize" value="resize" checked="checked" /><label for="'+b+'-resize">'+d.i18n("resize")+"</label>").append('<input type="radio" name="type" id="'+b+'-crop" value="crop" /><label for="'+b+'-crop">'+d.i18n("crop")+"</label>").append('<input type="radio" name="type" id="'+b+'-rotate" value="rotate" /><label for="'+b+'-rotate">'+d.i18n("rotate")+"</label>"),y=$("input",x).attr("disabled","disabled").change(function(){var a=$("input:checked",x).val();X(),ab(!0),bb(!0),cb(!0),"resize"==a?(n.show(),s.hide(),o.hide(),ab()):"crop"==a?(s.hide(),n.hide(),o.show(),bb()):"rotate"==a&&(n.hide(),o.hide(),s.show(),cb())}),z=$('<input type="checkbox" checked="checked"/>').change(function(){M=!!z.prop("checked"),Y.fixHeight(),ab(!0),ab()}),A=$(e).change(function(){var a=parseInt(A.val()),b=parseInt(M?Math.round(a/I):B.val());a>0&&b>0&&(Y.updateView(a,b),B.val(b))}),B=$(e).change(function(){var a=parseInt(B.val()),b=parseInt(M?Math.round(a*I):A.val());b>0&&a>0&&(Y.updateView(b,a),A.val(b))}),C=$(e).change(function(){Z.updateView()}),D=$(e).change(function(){Z.updateView()}),E=$(e).change(function(){Z.updateView()}),F=$(e).change(function(){Z.updateView()}),G=$('<input type="text" size="3" maxlength="3" value="0" />').change(function(){_.update()}),H=$('<div class="elfinder-resize-rotate-slider"/>').slider({min:0,max:359,value:G.val(),animate:!0,change:function(a,b){b.value!=H.slider("value")&&_.update(b.value)},slide:function(a,b){_.update(b.value,!1)}}),I=1,J=1,K=0,L=0,M=!0,N=0,O=0,P=0,Q=0,R=0,S=$("<img/>").load(function(){k.remove(),K=S.width(),L=S.height(),I=K/L,Y.updateView(K,L),l.append(S.show()).show(),A.val(K),B.val(L);var a=Math.min(N,O)/Math.sqrt(Math.pow(K,2)+Math.pow(L,2));P=K*a,Q=L*a,y.button("enable"),i.find("input,select").removeAttr("disabled").filter(":text").keydown(function(a){var b,c=a.keyCode;return a.stopPropagation(),c>=37&&40>=c||c==$.ui.keyCode.BACKSPACE||c==$.ui.keyCode.DELETE||65==c&&(a.ctrlKey||a.metaKey)||27==c?void 0:(9==c&&(b=$(this).parent()[a.shiftKey?"prev":"next"](".elfinder-resize-row").children(":text"),b.length?b.focus():$(this).parent().parent().find(":text:"+(a.shiftKey?"last":"first")).focus()),13==c?void d.confirm({title:$("input:checked",x).val(),text:"confirmReq",accept:{label:"btnApply",callback:function(){db()}},cancel:{label:"btnCancel",callback:function(){}}}):void(c>=48&&57>=c||c>=96&&105>=c||a.preventDefault()))}).filter(":first").focus(),ab(),w.hover(function(){w.toggleClass("ui-state-hover")}).click(X)}).error(function(){k.text("Unable to load image").css("background","transparent")}),T=$("<div/>"),U=$("<img/>"),V=$("<div/>"),W=$("<img/>"),X=function(){A.val(K),B.val(L),Y.updateView(K,L)},Y={update:function(){A.val(Math.round(S.width()/J)),B.val(Math.round(S.height()/J))},updateView:function(a,b){a>N||b>O?a/N>b/O?(J=N/a,S.width(N).height(Math.ceil(b*J))):(J=O/b,S.height(O).width(Math.ceil(a*J))):S.width(a).height(b),J=S.width()/a,v.text("1 : "+(1/J).toFixed(2)),Y.updateHandle()},updateHandle:function(){l.width(S.width()).height(S.height())},fixWidth:function(){var a,b;M&&(b=B.val(),b=Math.round(b*I),Y.updateView(a,b),A.val(a))},fixHeight:function(){var a,b;M&&(a=A.val(),b=Math.round(a/I),Y.updateView(a,b),B.val(b))}},Z={update:function(){E.val(Math.round((m.data("w")||m.width())/J)),F.val(Math.round((m.data("h")||m.height())/J)),C.val(Math.round(((m.data("x")||m.offset().left)-U.offset().left)/J)),D.val(Math.round(((m.data("y")||m.offset().top)-U.offset().top)/J))},updateView:function(){var a=parseInt(C.val())*J+U.offset().left,b=parseInt(D.val())*J+U.offset().top,c=E.val()*J,d=F.val()*J;m.data({x:a,y:b,w:c,h:d}),m.width(Math.round(c)),m.height(Math.round(d)),V.width(m.width()),V.height(m.height()),m.offset({left:Math.round(a),top:Math.round(b)})},resize_update:function(){m.data({w:null,h:null}),Z.update(),V.width(m.width()),V.height(m.height())},drag_update:function(){m.data({x:null,y:null}),Z.update()}},_={mouseStartAngle:0,imageStartAngle:0,imageBeingRotated:!1,update:function(a,b){"undefined"==typeof a&&(R=a=parseInt(G.val())),"undefined"==typeof b&&(b=!0),!b||d.UA.Opera||d.UA.ltIE8?W.rotate(a):W.animate({rotate:a+"deg"}),a%=360,0>a&&(a+=360),G.val(parseInt(a)),H.slider("value",G.val())},execute:function(a){if(_.imageBeingRotated){var b=_.getCenter(W),c=a.pageX-b[0],d=a.pageY-b[1],e=Math.atan2(d,c),f=e-_.mouseStartAngle+_.imageStartAngle;return f=Math.round(180*parseFloat(f)/Math.PI),a.shiftKey&&(f=15*Math.round((f+6)/15)),W.rotate(f),f%=360,0>f&&(f+=360),G.val(f),H.slider("value",G.val()),!1}},start:function(a){_.imageBeingRotated=!0;var b=_.getCenter(W),c=a.pageX-b[0],d=a.pageY-b[1];return _.mouseStartAngle=Math.atan2(d,c),_.imageStartAngle=parseFloat(W.rotate())*Math.PI/180,$(document).mousemove(_.execute),!1},stop:function(){return _.imageBeingRotated?($(document).unbind("mousemove",_.execute),setTimeout(function(){_.imageBeingRotated=!1},10),!1):void 0},getCenter:function(){var a=W.rotate();W.rotate(0);var b=W.offset(),c=b.left+W.width()/2,d=b.top+W.height()/2;return W.rotate(a),Array(c,d)}},ab=function(a){$.fn.resizable&&(a?(l.filter(":ui-resizable").resizable("destroy"),l.hide()):(l.show(),l.resizable({alsoResize:S,aspectRatio:M,resize:Y.update,stop:Y.fixHeight})))},bb=function(a){$.fn.draggable&&$.fn.resizable&&(a?(m.filter(":ui-resizable").resizable("destroy"),m.filter(":ui-draggable").draggable("destroy"),T.hide()):(U.width(S.width()).height(S.height()),V.width(S.width()).height(S.height()),m.width(U.width()).height(U.height()).offset(U.offset()).resizable({containment:T,resize:Z.resize_update,handles:"all"}).draggable({handle:V,containment:U,drag:Z.drag_update}),T.show().width(S.width()).height(S.height()),Z.update()))
},cb=function(a){$.fn.draggable&&$.fn.resizable&&(a?W.hide():W.show().width(P).height(Q).css("margin-top",(O-Q)/2+"px").css("margin-left",(N-P)/2+"px"))},db=function(){var b,e,g,h,i,j=$("input:checked",x).val();if("resize"==j)b=parseInt(A.val())||0,e=parseInt(B.val())||0;else if("crop"==j)b=parseInt(E.val())||0,e=parseInt(F.val())||0,g=parseInt(C.val())||0,h=parseInt(D.val())||0;else if("rotate"==j){if(b=K,e=L,i=parseInt(G.val())||0,0>i||i>360)return d.error("Invalid rotate degree");if(0==i||360==i)return d.error("Image dose not rotated")}if("rotate"!=j){if(0>=b||0>=e)return d.error("Invalid image size");if(b==K&&e==L)return d.error("Image size not changed")}c.elfinderdialog("close"),d.request({data:{cmd:"resize",target:a.hash,width:b,height:e,x:g,y:h,degree:i,mode:j},notify:{type:"resize",cnt:1}}).fail(function(a){f.reject(a)}).done(function(){f.resolve()})},eb={},fb="elfinder-resize-handle-hline",gb="elfinder-resize-handle-vline",hb="elfinder-resize-handle-point",ib=d.url(a.hash);W.mousedown(_.start),$(document).mouseup(_.stop),n.append($(g).append($(h).text(d.i18n("width"))).append(A).append(w)).append($(g).append($(h).text(d.i18n("height"))).append(B)).append($(g).append($("<label/>").text(d.i18n("aspectRatio")).prepend(z))).append($(g).append(d.i18n("scale")+" ").append(v)),o.append($(g).append($(h).text("X")).append(C)).append($(g).append($(h).text("Y")).append(D)).append($(g).append($(h).text(d.i18n("width"))).append(E)).append($(g).append($(h).text(d.i18n("height"))).append(F)),s.append($(g).append($(h).text(d.i18n("rotate"))).append($('<div style="float:left; width: 130px;">').append($('<div style="float:left;">').append(G).append($("<span/>").text(d.i18n("degree")))).append($(p).append(t).append($(r)).append(u))).append(H)),c.append(x),i.append($(g)).append(n).append(o.hide()).append(s.hide()).find("input,select").attr("disabled","disabled"),l.append('<div class="'+fb+" "+fb+'-top"/>').append('<div class="'+fb+" "+fb+'-bottom"/>').append('<div class="'+gb+" "+gb+'-left"/>').append('<div class="'+gb+" "+gb+'-right"/>').append('<div class="'+hb+" "+hb+'-e"/>').append('<div class="'+hb+" "+hb+'-se"/>').append('<div class="'+hb+" "+hb+'-s"/>'),j.append(k).append(l.hide()).append(S.hide()),m.css("position","absolute").append('<div class="'+fb+" "+fb+'-top"/>').append('<div class="'+fb+" "+fb+'-bottom"/>').append('<div class="'+gb+" "+gb+'-left"/>').append('<div class="'+gb+" "+gb+'-right"/>').append('<div class="'+hb+" "+hb+'-n"/>').append('<div class="'+hb+" "+hb+'-e"/>').append('<div class="'+hb+" "+hb+'-s"/>').append('<div class="'+hb+" "+hb+'-w"/>').append('<div class="'+hb+" "+hb+'-ne"/>').append('<div class="'+hb+" "+hb+'-se"/>').append('<div class="'+hb+" "+hb+'-sw"/>').append('<div class="'+hb+" "+hb+'-nw"/>'),j.append(T.css("position","absolute").hide().append(U).append(m.append(V))),j.append(W.hide()),j.css("overflow","hidden"),c.append(j).append(i),eb[d.i18n("btnApply")]=db,eb[d.i18n("btnCancel")]=function(){c.elfinderdialog("close")},d.dialog(c,{title:a.name,width:650,resizable:!1,destroyOnClose:!0,buttons:eb,open:function(){j.zIndex(1+$(this).parent().zIndex())}}).attr("id",b),d.UA.ltIE8&&$(".elfinder-dialog").css("filter",""),w.css("left",A.position().left+A.width()+12),V.css({opacity:.2,"background-color":"#fff",position:"absolute"}),m.css("cursor","move"),m.find(".elfinder-resize-handle-point").css({"background-color":"#fff",opacity:.5,"border-color":"#000"}),W.css("cursor","pointer"),x.buttonset(),N=j.width()-(l.outerWidth()-l.width()),O=j.height()-(l.outerHeight()-l.height()),S.attr("src",ib+(-1===ib.indexOf("?")?"?":"&")+"_="+Math.random()),U.attr("src",S.attr("src")),W.attr("src",S.attr("src"))};return e.length&&-1!==e[0].mime.indexOf("image/")?(b="resize-"+d.namespace+"-"+e[0].hash,c=d.getUI().find("#"+b),c.length?(c.elfinderdialog("toTop"),f.resolve()):(g(e[0],b),f)):f.reject()}},function(a){var b=function(a,b){var c=0;for(c in b)if("undefined"!=typeof a[b[c]])return b[c];return a[b[c]]="",b[c]};if(a.cssHooks.rotate={get:function(b){return a(b).rotate()},set:function(b,c){return a(b).rotate(c),c}},a.cssHooks.transform={get:function(a){var c=b(a.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return a.style[c]},set:function(a,c){var d=b(a.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return a.style[d]=c,c}},a.fn.rotate=function(a){if("undefined"==typeof a){if(window.opera){var b=this.css("transform").match(/rotate\((.*?)\)/);return b&&b[1]?Math.round(180*parseFloat(b[1])/Math.PI):0}var b=this.css("transform").match(/rotate\((.*?)\)/);return b&&b[1]?parseInt(b[1]):0}return this.css("transform",this.css("transform").replace(/none|rotate\(.*?\)/,"")+"rotate("+parseInt(a)+"deg)"),this},a.fx.step.rotate=function(b){0==b.state&&(b.start=a(b.elem).rotate(),b.now=b.start),a(b.elem).rotate(b.now)},"undefined"==typeof window.addEventListener&&"undefined"==typeof document.getElementsByClassName){var c=function(a){for(var b=a,c=b.offsetLeft,d=b.offsetTop;b.offsetParent&&(b=b.offsetParent,b==document.body||"static"==b.currentStyle.position);)b!=document.body&&b!=document.documentElement&&(c-=b.scrollLeft,d-=b.scrollTop),c+=b.offsetLeft,d+=b.offsetTop;return{x:c,y:d}},d=function(a){if("static"==a.currentStyle.position){var b=c(a);a.style.position="absolute",a.style.left=b.x+"px",a.style.top=b.y+"px"}},e=function(a,b){var c,e=1,f=1,g=1,h=1;if("undefined"!=typeof a.style.msTransform)return!0;d(a),c=b.match(/rotate\((.*?)\)/);var i=c&&c[1]?parseInt(c[1]):0;i%=360,0>i&&(i=360+i);var j=i*Math.PI/180,k=Math.cos(j),l=Math.sin(j);e*=k,f*=-l,g*=l,h*=k,a.style.filter=(a.style.filter||"").replace(/progid:DXImageTransform\.Microsoft\.Matrix\([^)]*\)/,"")+("progid:DXImageTransform.Microsoft.Matrix(M11="+e+",M12="+f+",M21="+g+",M22="+h+",FilterType='bilinear',sizingMethod='auto expand')");var m=parseInt(a.style.width||a.width||0),n=parseInt(a.style.height||a.height||0),j=i*Math.PI/180,o=Math.abs(Math.cos(j)),p=Math.abs(Math.sin(j)),q=(m-(m*o+n*p))/2,r=(n-(m*p+n*o))/2;return a.style.marginLeft=Math.floor(q)+"px",a.style.marginTop=Math.floor(r)+"px",!0},f=a.cssHooks.transform.set;a.cssHooks.transform.set=function(a,b){return f.apply(this,[a,b]),e(a,b),b}}}(jQuery),elFinder.prototype.commands.rm=function(){this.shortcuts=[{pattern:"delete ctrl+backspace"}],this.getstate=function(a){var b=this.fm;return a=a||b.selected(),!this._disabled&&a.length&&$.map(a,function(a){var c=b.file(a);return c&&c.phash&&!c.locked?a:null}).length==a.length?0:-1},this.exec=function(a){var b=this,c=this.fm,d=$.Deferred().fail(function(a){a&&c.error(a)}),e=this.files(a),f=e.length,g=c.cwd().hash,h=!1;return!f||this._disabled?d.reject():($.each(e,function(a,b){return b.phash?b.locked?!d.reject(["errLocked",b.name]):void(b.hash==g&&(h=c.root(b.hash))):!d.reject(["errRm",b.name,"errPerm"])}),"pending"==d.state()&&(e=this.hashes(a),c.confirm({title:b.title,text:"confirmRm",accept:{label:"btnRm",callback:function(){c.lockfiles({files:e}),c.request({data:{cmd:"rm",targets:e},notify:{type:"rm",cnt:f},preventFail:!0}).fail(function(a){d.reject(a)}).done(function(a){d.done(a),h&&c.exec("open",h)}).always(function(){c.unlockfiles({files:e})})}},cancel:{label:"btnCancel",callback:function(){d.reject()}}})),d)}},elFinder.prototype.commands.search=function(){this.title="Find files",this.options={ui:"searchbutton"},this.alwaysEnabled=!0,this.updateOnSelect=!1,this.getstate=function(){return 0},this.exec=function(a){var b=this.fm;return"string"==typeof a&&a?(b.trigger("searchstart",{query:a}),b.request({data:{cmd:"search",q:a},notify:{type:"search",cnt:1,hideCnt:!0}})):(b.getUI("toolbar").find("."+b.res("class","searchbtn")+" :text").focus(),$.Deferred().reject())}},elFinder.prototype.commands.sort=function(){this.options={ui:"sortbutton"},this.getstate=function(){return 0},this.exec=function(a,b){var c=this.fm,b=$.extend({type:c.sortType,order:c.sortOrder,stick:c.sortStickFolders},b);return this.fm.setSort(b.type,b.order,b.stick),$.Deferred().resolve()}},elFinder.prototype.commands.up=function(){this.alwaysEnabled=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+up"}],this.getstate=function(){return this.fm.cwd().phash?0:-1},this.exec=function(){return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash):$.Deferred().reject()}},elFinder.prototype.commands.upload=function(){var a=this.fm.res("class","hover");this.disableOnSearch=!0,this.updateOnSelect=!1,this.shortcuts=[{pattern:"ctrl+u"}],this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1},this.exec=function(b){var c,d,e,f,g,h,i=this.fm,j=function(a){d.elfinderdialog("close"),i.upload(a).fail(function(a){c.reject(a)}).done(function(a){c.resolve(a)})};return this.disabled()?$.Deferred().reject():b&&(b.input||b.files)?i.upload(b):(c=$.Deferred(),e=$('<input type="file" multiple="true"/>').change(function(){j({input:e[0]})}),f=$('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+i.i18n("selectForUpload")+"</span></div>").append($("<form/>").append(e)).hover(function(){f.toggleClass(a)}),d=$('<div class="elfinder-upload-dialog-wrapper"/>').append(f),h=$('<div class="ui-corner-all elfinder-upload-dropbox" contenteditable=true></div>').on("paste drop",function(a){var b,c=a.originalEvent||a,d=[];if(c.clipboardData&&c.clipboardData.items&&c.clipboardData.items.length){for(var e=0;e<c.clipboardData.items.length;e++)"file"==c.clipboardData.items[e].kind&&(b=c.clipboardData.items[e].getAsFile(),d.push(b));if(d.length)return void j({files:d,type:"files"})}var f=c.target;setTimeout(function(){if(f.innerHTML){var a=f.innerHTML.replace(/<br[^>]*>/gi," "),b=a.match(/<[^>]+>/)?"html":"text";f.innerHTML="",j({files:[a],type:b})}},1)}).on("dragenter mouseover",function(){h.addClass(a)}).on("dragleave mouseout",function(){h.removeClass(a)}),i.dragUpload?(g=$('<div class="ui-corner-all elfinder-upload-dropbox">'+i.i18n("dropFiles")+"</div>").prependTo(d).after('<div class="elfinder-upload-dialog-or">'+i.i18n("or")+"</div>").after(h).after("<div>"+i.i18n("dropFilesBrowser")+"</div>").after('<div class="elfinder-upload-dialog-or">'+i.i18n("or")+"</div>")[0],g.addEventListener("dragenter",function(b){b.stopPropagation(),b.preventDefault(),$(g).addClass(a)},!1),g.addEventListener("dragleave",function(b){b.stopPropagation(),b.preventDefault(),$(g).removeClass(a)},!1),g.addEventListener("dragover",function(b){b.stopPropagation(),b.preventDefault(),$(g).addClass(a)},!1),g.addEventListener("drop",function(a){a.stopPropagation(),a.preventDefault();var b=!1,c="";a.dataTransfer&&a.dataTransfer.items&&a.dataTransfer.items.length?(b=a.dataTransfer.items,c="data"):a.dataTransfer&&a.dataTransfer.files&&a.dataTransfer.files.length?(b=a.dataTransfer.files,c="files"):a.dataTransfer.getData("text/html")?(b=[a.dataTransfer.getData("text/html")],c="html"):a.dataTransfer.getData("text")&&(b=[a.dataTransfer.getData("text")],c="text"),b&&j({files:b,type:c})},!1)):$("<div>"+i.i18n("dropFilesBrowser")+"</div>").append(h).prependTo(d).after('<div class="elfinder-upload-dialog-or">'+i.i18n("or")+"</div>")[0],i.dialog(d,{title:this.title,modal:!0,resizable:!1,destroyOnClose:!0}),c)}},elFinder.prototype.commands.view=function(){this.value=this.fm.viewType,this.alwaysEnabled=!0,this.updateOnSelect=!1,this.options={ui:"viewbutton"},this.getstate=function(){return 0},this.exec=function(){var a=this.fm.storage("view","list"==this.value?"icons":"list");this.fm.viewchange(),this.update(void 0,a)}},elFinder&&elFinder.prototype&&"object"==typeof elFinder.prototype.i18&&(elFinder.prototype.i18.ru={translator:'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;',language:"Русский язык",direction:"ltr",dateFormat:"d M Y H:i",fancyDateFormat:"$1 H:i",messages:{error:"Ошибка",errUnknown:"Неизвестная ошибка.",errUnknownCmd:"Неизвестная комманда.",errJqui:"Отсутствуют необходимые компоненты jQuery UI - selectable, draggable и droppable.",errNode:"Отсутствует DOM элемент для инициализации elFinder.",errURL:"Некорректная настройка. Необходимо указать URL сервера.",errAccess:"Доступ запрещен.",errConnect:"Не удалось соединиться с сервером.",errAbort:"Соединение прервано.",errTimeout:"Таймаут соединения.",errNotFound:"Сервер не найден.",errResponse:"Некорректный ответ сервера.",errConf:"Некорректная настройка сервера.",errJSON:"Модуль PHP JSON не установлен.",errNoVolumes:"Отсутствуют корневые директории достуные для чтения.",errCmdParams:'Некорректные параметры комманды "$1".',errDataNotJSON:"Данные не формате JSON.",errDataEmpty:"Данные отсутствуют.",errCmdReq:"Для запроса к серверу необходимо указать имя комманды.",errOpen:'Не удалось открыть "$1".',errNotFolder:"Объект не является папкой.",errNotFile:"Объект не является файлом.",errRead:'Ошибка чтения "$1".',errWrite:'Ошибка записи "$1".',errPerm:"Доступ запрещен.",errLocked:'"$1" защищен и не может быть переименован, перемещен или удален.',errExists:'В папке уже существует объект с именем "$1".',errInvName:"Недопустимое имя файла.",errFolderNotFound:"Папка не найдена.",errFileNotFound:"Файл не найден.",errTrgFolderNotFound:'Целевая папка "$1" не найдена.',errPopup:"Браузер заблокировал открытие нового окна. Чтобы окрыть файл, измените настройки браузера.",errMkdir:'Ошибка создания папки "$1".',errMkfile:'Ошибка создания файла "$1".',errRename:'Ошибка переименования "$1".',errCopyFrom:'Копирование из корневой директории "$1" запрещено.',errCopyTo:'Копирование в корневую директорию "$1" запрещено.',errUploadCommon:"Ошибка загрузки файлов.",errUpload:'Ошибка загрузки "$1".',errUploadNoFiles:"Отсутствуют загруженые файлы.",errMaxSize:"Превышен допустимый размер загружаемых файлов.",errFileMaxSize:"Размер файла превышает допустимый.",errUploadMime:"Недопустимый тип файла.",errUploadTransfer:'Ошибка передачи файла "$1".',errSave:'Ошибка сохранения "$1".',errCopy:'Ошибка копирования "$1".',errMove:'Ошибка перемещения "$1".',errCopyInItself:'Невозможно скопировать "$1" в самого себя.',errRm:'Ошибка удаления "$1".',errExtract:'Ошибка извлечения файлов из архива "$1".',errArchive:"Ошибка создания архива.",errArcType:"Неподдерживаемый тип архива.",errNoArchive:"Файл не является архивом допустимого типа.",errCmdNoSupport:"Сервер не поддерживает эту комманду.",errReplByChild:'Невозможно заменить папку "$1" содержащимся в ней объектом.',errArcSymlinks:"По соображениям безопасности запрещена распаковка архивов, содержащих ссылки (symlinks) или файлы с недопустимыми именами.",errArcMaxSize:"Размер файлов в архиве превышает максимально разрешенный.",errResize:'Не удалось изменить размер "$1".',errUsupportType:"Неподдерживаемый тип файла.",errNotUTF8Content:'Файл "$1" содержит текст в кодировке отличной от UTF-8 и не может быть отредактирован.',errNetMount:'Не удалось подключить "$1".',errNetMountNoDriver:"Неподдерживаемый протокол.",errNetMountFailed:"Ошибка монтирования.",errNetMountHostReq:"Host required.",errSessionExpires:"Сессия была завершена так как превышено время отсутствия активности",errCreatingTempDir:'Ошибка при создании временной директории: "$1"',errFtpDownloadFile:'Ошибка при скачивании файла с FTP: "$1"',errFtpUploadFile:'Ошибка при загрузке файла на FTP: "$1"',errFtpMkdir:'Ошибка при создании директории на FTP: "$1"',errArchiveExec:'Ошибка при выполнении архивации: "$1"',errExtractExec:'Ошибка при выполнении распаковки: "$1"',errUploadFile:'Невозможно загрузить файл "$1"',errUploadFileSize:"Превышен допустимый размер загружаемого файла.",cmdarchive:"Создать архив",cmdback:"Назад",cmdcopy:"Копировать",cmdcut:"Вырезать",cmddownload:"Скачать",cmdduplicate:"Сделать копию",cmdedit:"Редактировать",cmdextract:"Распаковать архив",cmdforward:"Вперед",cmdgetfile:"Выбрать",cmdhelp:"О программе",cmdhome:"Домой",cmdinfo:"Свойства",cmdmkdir:"Новая папка",cmdmkfile:"Новый файл",cmdopen:"Открыть",cmdpaste:"Вставить",cmdquicklook:"Быстрый просмотр",cmdreload:"Обновить",cmdrename:"Переименовать",cmdrm:"Удалить",cmdsearch:"Поиск",cmdup:"Наверх",cmdupload:"Загрузить файлы",cmdview:"Вид",cmdresize:"Размер изображения",cmdsort:"Сортировать",btnClose:"Закрыть",btnSave:"Сохранить",btnRm:"Удалить",btnCancel:"Отмена",btnApply:"Применить",btnNo:"Нет",btnYes:"Да",btnMount:"Подключить",ntfopen:"Открытие папки",ntffile:"Открытие файла",ntfreload:"Обновление текущей папки",ntfmkdir:"Создание папки",ntfmkfile:"Создание файла",ntfrm:"Удаление файлов",ntfcopy:"Копирование файлов",ntfmove:"Перемещение файлов",ntfprepare:"Подготовка к копированию",ntfrename:"Переименование файлов",ntfupload:"Загрузка файлов",ntfdownload:"Скачивание файлов",ntfsave:"Сохранение файлов",ntfarchive:"Создание архива",ntfextract:"Распаковка архива",ntfsearch:"Поиск файлов",ntfsmth:"Занят важным делом",ntfnetmount:"Монтирую сетевой диск",dateUnknown:"Незвестно",Today:"Сегодня",Yesterday:"Вчера",Jan:"Янв",Feb:"Фев",Mar:"Мар",Apr:"Апр",May:"Май",Jun:"Июнь",Jul:"Июль",Aug:"Авг",Sep:"Сен",Oct:"Окт",Nov:"Ноя",Dec:"Дек",January:"Январь",February:"Февраль",March:"Март",April:"Апрель",June:"Июнь",July:"Июль",August:"Август",September:"Сентябрь",October:"Октябрь",November:"Ноябрь",December:"Декабрь",Sunday:"Воскресенье",Monday:"Понедельник",Tuesday:"Вторник",Wednesday:"Среда",Thursday:"Четверг",Friday:"Пятница",Saturday:"Суббота",Sun:"Вск",Mon:"Пнд",Tue:"Втр",Wed:"Срд",Thu:"Чтв",Fri:"Птн",Sat:"Сбт",sortname:"по имени",sortkind:"по типу",sortsize:"по размеру",sortdate:"по дате",sortFoldersFirst:"Папки в начале",confirmReq:"Необходимо подтверждение.",confirmRm:"Хотите удалить файлы?<br>Действие необратимо.",confirmRepl:"Заменить старый файл новым?",apllyAll:"для всех",name:"Имя файла",size:"Размер",perms:"Доступ",modify:"Изменен",kind:"Тип",read:"чтение",write:"запись",noaccess:"нет доступа",and:"и",unknown:"неизвестно",selectall:"Выбрать все файлы",selectfiles:"Выбрать файл(ы)",selectffile:"Выбрать первый файл",selectlfile:"Выбрать последний файл",viewlist:"В виде списка",viewicons:"В виде иконок",places:"Избранное",calc:"вычисляю",path:"Путь",aliasfor:"Указывает на",locked:"Защита",dim:"Разрешение",files:"Файлы",folders:"Папки",items:"Объекты",yes:"да",no:"нет",link:"Ссылка",searcresult:"Результаты поиска",selected:"выбрано",about:"О программе",shortcuts:"Горячие клавиши",help:"Помощь",webfm:"Файловый менеджер для web",ver:"Версия",protocolver:"версия протокола",homepage:"Сайт проекта",docs:"Документация",github:"Fork us on Github",twitter:"Follow us in twitter",facebook:"Join us on facebook",team:"Авторы",chiefdev:"ведущий разработчик",developer:"разработчик",contributor:"участник",maintainer:"сопровождение проекта",translator:"переводчик",icons:"Иконки",dontforget:"и не забудьте взять свое полотенце",shortcutsof:"Горячие клавиши отключены",dropFiles:"Бросить файлы",or:"или",selectForUpload:"Выбрать файлы для загрузки",moveFiles:"Перемещение файлов",copyFiles:"Копирование файлов",rmFromPlaces:"Удалить из избранного","untitled folder":"новая папка","untitled file.txt":"новый файл.txt",aspectRatio:"Сохранять пропорции",scale:"Масштаб",width:"Ширина",height:"Высота",resize:"Размер",crop:"Кадрировать",rotate:"Поворот","rotate-cw":"Поворот на 90 градусов по часовой стрелке","rotate-ccw":"Поворот на 90 градусов против часовой стрелке",degree:"°",netMountDialogTitle:"Подключить сетевой диск",protocol:"Протокол",host:"Хост",port:"Порт",user:"Пользователь",pass:"Пароль",kindUnknown:"Неизвестный",kindFolder:"Папка",kindAlias:"Ссылка",kindAliasBroken:"Битая ссылка",kindApp:"Приложение",kindPostscript:"Документ Postscript",kindMsOffice:"Документ Microsoft Office",kindMsWord:"Документ Microsoft Word",kindMsExcel:"Документ Microsoft Excel",kindMsPP:"Презентация Microsoft Powerpoint",kindOO:"Документ Open Office",kindAppFlash:"Приложение Flash",kindPDF:"Документ PDF",kindTorrent:"Файл Bittorrent",kind7z:"Архив 7z",kindTAR:"Архив TAR",kindGZIP:"Архив GZIP",kindBZIP:"Архив BZIP",kindZIP:"Архив ZIP",kindRAR:"Архив RAR",kindJAR:"Файл Java JAR",kindTTF:"Шрифт True Type",kindOTF:"Шрифт Open Type",kindRPM:"Пакет RPM",kindText:"Текстовый документ",kindTextPlain:"Простой текст",kindPHP:"Исходник PHP",kindCSS:"Таблицы стилей CSS",kindHTML:"Документ HTML",kindJS:"Исходник Javascript",kindRTF:"Rich Text Format",kindC:"Исходник C",kindCHeader:"Заголовочный файл C",kindCPP:"Исходник C++",kindCPPHeader:"Заголовочный файл C++",kindShell:"Unix shell script",kindPython:"Исходник Python",kindJava:"Исходник Java",kindRuby:"Исходник Ruby",kindPerl:"Исходник Perl",kindSQL:"Исходник SQL",kindXML:"XML document",kindAWK:"Исходник AWK",kindCSV:"Текст с разделителями",kindDOCBOOK:"Документ Docbook XML",kindImage:"Изображение",kindBMP:"Изображение BMP",kindJPEG:"Изображение JPEG",kindGIF:"Изображение GIF",kindPNG:"Изображение PNG",kindTIFF:"Изображение TIFF",kindTGA:"Изображение TGA",kindPSD:"Изображение Adobe Photoshop",kindXBITMAP:"Изображение X bitmap",kindPXM:"Изображение Pixelmator",kindAudio:"Аудио файл",kindAudioMPEG:"Аудио MPEG",kindAudioMPEG4:"Аудио MPEG-4",kindAudioMIDI:"Аудио MIDI",kindAudioOGG:"Аудио Ogg Vorbis",kindAudioWAV:"Аудио WAV",AudioPlaylist:"Плейлист MP3",kindVideo:"Видео файл",kindVideoDV:"Видео DV",kindVideoMPEG:"Видео MPEG",kindVideoMPEG4:"Видео MPEG-4",kindVideoAVI:"Видео AVI",kindVideoMOV:"Видео Quick Time",kindVideoWM:"Видео Windows Media",kindVideoFlash:"Видео Flash",kindVideoMKV:"Видео Matroska",kindVideoOGG:"Видео Ogg",volume_files:"Файлы "}});